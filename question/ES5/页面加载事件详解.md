# é¡µé¢åŠ è½½äº‹ä»¶è¯¦è§£

## ğŸ¯ æ ¸å¿ƒç­”æ¡ˆ

**DOMContentLoaded å…ˆæ‰§è¡Œï¼Œwindow.onload åæ‰§è¡Œï¼**

```
é¡µé¢åŠ è½½é¡ºåºï¼š

1. å¼€å§‹è§£æ HTML
2. æ„å»º DOM æ ‘
3. ğŸ”” DOMContentLoaded äº‹ä»¶è§¦å‘  â† å…ˆ
4. ç»§ç»­åŠ è½½å›¾ç‰‡ã€æ ·å¼è¡¨ç­‰èµ„æº
5. æ‰€æœ‰èµ„æºåŠ è½½å®Œæˆ
6. ğŸ”” window.onload äº‹ä»¶è§¦å‘     â† å
```

---

## ğŸ“– è¯¦ç»†è§£é‡Š

### DOMContentLoadedï¼ˆDOM åŠ è½½å®Œæˆï¼‰

```javascript
/**
 * DOMContentLoaded äº‹ä»¶
 * 
 * è§¦å‘æ—¶æœºï¼šHTML æ–‡æ¡£è¢«å®Œå…¨è§£æï¼ŒDOM æ ‘æ„å»ºå®Œæˆ
 * 
 * ä¸ç­‰å¾…ï¼š
 * âŒ æ ·å¼è¡¨ï¼ˆCSSï¼‰
 * âŒ å›¾ç‰‡
 * âŒ iframe
 * âŒ å…¶ä»–å¤–éƒ¨èµ„æº
 * 
 * ç­‰å¾…ï¼š
 * âœ… HTML è§£æå®Œæˆ
 * âœ… åŒæ­¥è„šæœ¬æ‰§è¡Œå®Œæˆ
 */

document.addEventListener('DOMContentLoaded', () => {
  console.log('ğŸ”” DOMContentLoaded è§¦å‘');
  console.log('DOM æ ‘å·²æ„å»ºå®Œæˆ');
  
  // æ­¤æ—¶å¯ä»¥å®‰å…¨åœ°æ“ä½œ DOM
  const element = document.getElementById('app');
  element.textContent = 'Hello';
  
  // ä½†å›¾ç‰‡å¯èƒ½è¿˜åœ¨åŠ è½½
  const img = document.querySelector('img');
  console.log('å›¾ç‰‡åŠ è½½å®Œæˆ?', img.complete);  // å¯èƒ½æ˜¯ false
});
```

### window.onloadï¼ˆæ‰€æœ‰èµ„æºåŠ è½½å®Œæˆï¼‰

```javascript
/**
 * window.onload äº‹ä»¶
 * 
 * è§¦å‘æ—¶æœºï¼šé¡µé¢æ‰€æœ‰èµ„æºéƒ½åŠ è½½å®Œæˆ
 * 
 * åŒ…æ‹¬ï¼š
 * âœ… HTML æ–‡æ¡£
 * âœ… æ‰€æœ‰æ ·å¼è¡¨ï¼ˆCSSï¼‰
 * âœ… æ‰€æœ‰å›¾ç‰‡
 * âœ… æ‰€æœ‰ iframe
 * âœ… æ‰€æœ‰å¤–éƒ¨èµ„æº
 */

window.addEventListener('load', () => {
  console.log('ğŸ”” window.onload è§¦å‘');
  console.log('æ‰€æœ‰èµ„æºåŠ è½½å®Œæˆ');
  
  // æ­¤æ—¶æ‰€æœ‰å›¾ç‰‡éƒ½å·²åŠ è½½
  const img = document.querySelector('img');
  console.log('å›¾ç‰‡åŠ è½½å®Œæˆ?', img.complete);  // true
  console.log('å›¾ç‰‡å°ºå¯¸:', img.width, 'x', img.height);
});

// æˆ–ä½¿ç”¨
window.onload = function() {
  console.log('æ‰€æœ‰èµ„æºåŠ è½½å®Œæˆ');
};
```

---

## â±ï¸ å®Œæ•´çš„é¡µé¢åŠ è½½æ—¶é—´çº¿

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    é¡µé¢åŠ è½½æµç¨‹                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

0ms    å¼€å§‹åŠ è½½ HTML
  â†“
50ms   è§£æ HTMLï¼Œæ„å»º DOM æ ‘
  â†“
  â”‚    é‡åˆ° <script src="app.js">
  â”‚    â†’ æš‚åœ HTML è§£æ
  â”‚    â†’ ä¸‹è½½å¹¶æ‰§è¡Œ app.js
  â”‚    â†’ ç»§ç»­è§£æ HTML
  â†“
100ms  é‡åˆ° <link href="style.css">
  â”‚    â†’ å¹¶è¡Œä¸‹è½½ CSSï¼ˆä¸é˜»å¡ HTML è§£æï¼‰
  â†“
150ms  é‡åˆ° <img src="logo.png">
  â”‚    â†’ å¹¶è¡Œä¸‹è½½å›¾ç‰‡ï¼ˆä¸é˜»å¡ HTML è§£æï¼‰
  â†“
200ms  HTML è§£æå®Œæˆï¼ŒDOM æ ‘æ„å»ºå®Œæˆ
  â†“
  ğŸ”” DOMContentLoaded äº‹ä»¶è§¦å‘ â† è¿™æ—¶å€™ï¼
  â†“
250ms  CSS ä¸‹è½½å®Œæˆ
  â”‚    â†’ æ„å»º CSSOM
  â†“
300ms  å›¾ç‰‡ä¸‹è½½å®Œæˆ
  â†“
350ms  æ‰€æœ‰èµ„æºåŠ è½½å®Œæˆ
  â†“
  ğŸ”” window.onload äº‹ä»¶è§¦å‘ â† è¿™æ—¶å€™ï¼
```

---

## ğŸ” è¯¦ç»†å¯¹æ¯”

### è§¦å‘æ¡ä»¶å¯¹æ¯”

```javascript
/**
 * ä¸¤ä¸ªäº‹ä»¶çš„è§¦å‘æ¡ä»¶
 */

const eventComparison = {
  // DOMContentLoaded
  domContentLoaded: {
    trigger: 'DOM æ ‘æ„å»ºå®Œæˆ',
    
    waitFor: [
      'âœ… HTML å®Œå…¨è§£æ',
      'âœ… åŒæ­¥çš„ <script> æ‰§è¡Œå®Œæˆ',
      'âœ… defer è„šæœ¬æ‰§è¡Œå®Œæˆ'
    ],
    
    notWaitFor: [
      'âŒ æ ·å¼è¡¨ï¼ˆCSSï¼‰',
      'âŒ å›¾ç‰‡',
      'âŒ iframe',
      'âŒ async è„šæœ¬',
      'âŒ å­—ä½“'
    ],
    
    timing: 'é€šå¸¸åœ¨ 200-500ms'
  },
  
  // window.onload
  windowOnload: {
    trigger: 'æ‰€æœ‰èµ„æºåŠ è½½å®Œæˆ',
    
    waitFor: [
      'âœ… HTML',
      'âœ… CSS',
      'âœ… å›¾ç‰‡',
      'âœ… iframe',
      'âœ… æ‰€æœ‰è„šæœ¬ï¼ˆåŒ…æ‹¬ asyncï¼‰',
      'âœ… å­—ä½“',
      'âœ… æ‰€æœ‰å¤–éƒ¨èµ„æº'
    ],
    
    timing: 'é€šå¸¸åœ¨ 1-5 ç§’ï¼ˆå–å†³äºèµ„æºå¤šå°‘ï¼‰'
  }
};
```

### ä»£ç å¯¹æ¯”

```html
<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="style.css">  <!-- 1MBï¼Œéœ€è¦ 2 ç§’ -->
  <script>
    // è®°å½•å¼€å§‹æ—¶é—´
    const startTime = Date.now();
    
    // DOMContentLoadedï¼ˆå…ˆè§¦å‘ï¼‰
    document.addEventListener('DOMContentLoaded', () => {
      console.log('1ï¸âƒ£ DOMContentLoaded è§¦å‘');
      console.log('   è€—æ—¶:', Date.now() - startTime, 'ms');
      console.log('   DOM å…ƒç´ :', document.getElementById('app') ? 'âœ… å­˜åœ¨' : 'âŒ ä¸å­˜åœ¨');
      
      const img = document.querySelector('img');
      console.log('   å›¾ç‰‡åŠ è½½?', img.complete);  // å¯èƒ½æ˜¯ false
    });
    
    // window.onloadï¼ˆåè§¦å‘ï¼‰
    window.addEventListener('load', () => {
      console.log('2ï¸âƒ£ window.onload è§¦å‘');
      console.log('   è€—æ—¶:', Date.now() - startTime, 'ms');
      
      const img = document.querySelector('img');
      console.log('   å›¾ç‰‡åŠ è½½?', img.complete);  // true
      console.log('   å›¾ç‰‡å°ºå¯¸:', img.width, 'x', img.height);
    });
  </script>
</head>
<body>
  <div id="app">Hello</div>
  <img src="large-image.jpg" alt="å¤§å›¾">  <!-- 5MBï¼Œéœ€è¦ 5 ç§’ -->
</body>
</html>

<!-- 
  è¾“å‡ºç¤ºä¾‹ï¼š
  
  1ï¸âƒ£ DOMContentLoaded è§¦å‘
     è€—æ—¶: 200 ms
     DOM å…ƒç´ : âœ… å­˜åœ¨
     å›¾ç‰‡åŠ è½½? false  â† å›¾ç‰‡è¿˜åœ¨åŠ è½½ä¸­
  
  2ï¸âƒ£ window.onload è§¦å‘
     è€—æ—¶: 5200 ms
     å›¾ç‰‡åŠ è½½? true   â† æ‰€æœ‰èµ„æºéƒ½åŠ è½½å®Œæˆ
     å›¾ç‰‡å°ºå¯¸: 1920 x 1080
-->
```

---

## ğŸ¨ å®é™…åº”ç”¨åœºæ™¯

### åœºæ™¯1ï¼šå°½å¿«æ“ä½œ DOMï¼ˆä½¿ç”¨ DOMContentLoadedï¼‰

```javascript
/**
 * éœ€è¦å°½å¿«åˆå§‹åŒ– UI é€»è¾‘
 */

document.addEventListener('DOMContentLoaded', () => {
  console.log('DOM å‡†å¤‡å¥½äº†ï¼Œç«‹å³åˆå§‹åŒ–');
  
  // âœ… å¯ä»¥æ“ä½œ DOM
  const button = document.getElementById('submit');
  button.addEventListener('click', handleSubmit);
  
  // âœ… å¯ä»¥åˆå§‹åŒ–åº”ç”¨
  initApp();
  
  // âœ… å¯ä»¥ç»‘å®šäº‹ä»¶
  setupEventListeners();
  
  // âš ï¸ ä½†å›¾ç‰‡å¯èƒ½è¿˜æ²¡åŠ è½½å®Œ
  // å¦‚æœéœ€è¦å›¾ç‰‡å°ºå¯¸ï¼Œç”¨ img.onload
});

/**
 * ä¼˜åŠ¿ï¼š
 * - æ›´å¿«ï¼ˆä¸ç­‰å¾…å›¾ç‰‡ã€CSSï¼‰
 * - ç”¨æˆ·æ›´å¿«çœ‹åˆ°å¯äº¤äº’çš„é¡µé¢
 * - å¤§å¤šæ•° JS æ¡†æ¶åœ¨è¿™ä¸ªæ—¶æœºåˆå§‹åŒ–
 */
```

### åœºæ™¯2ï¼šéœ€è¦å®Œæ•´èµ„æºï¼ˆä½¿ç”¨ window.onloadï¼‰

```javascript
/**
 * éœ€è¦ç­‰å¾…æ‰€æœ‰èµ„æºåŠ è½½å®Œæˆ
 */

window.addEventListener('load', () => {
  console.log('æ‰€æœ‰èµ„æºéƒ½å‡†å¤‡å¥½äº†');
  
  // âœ… å›¾ç‰‡å·²åŠ è½½ï¼Œå¯ä»¥è·å–å°ºå¯¸
  const images = document.querySelectorAll('img');
  images.forEach(img => {
    console.log('å›¾ç‰‡å°ºå¯¸:', img.width, 'x', img.height);
  });
  
  // âœ… å¯ä»¥åšå›¾ç‰‡å¤„ç†
  processImages();
  
  // âœ… å¯ä»¥è®¡ç®—å¸ƒå±€ï¼ˆä¾èµ–å›¾ç‰‡å°ºå¯¸ï¼‰
  calculateLayout();
  
  // âœ… å¯ä»¥æ˜¾ç¤ºåŠ è½½å®Œæˆæç¤º
  hideLoadingSpinner();
});

/**
 * ä½¿ç”¨åœºæ™¯ï¼š
 * - å›¾ç‰‡ç”»å»Šï¼ˆéœ€è¦çŸ¥é“å›¾ç‰‡å°ºå¯¸ï¼‰
 * - Canvas å¤„ç†å›¾ç‰‡
 * - æ€§èƒ½ç›‘æ§ï¼ˆå®Œæ•´åŠ è½½æ—¶é—´ï¼‰
 * - ç§»é™¤ loading åŠ¨ç”»
 */
```

---

## ğŸ”„ å…¶ä»–é¡µé¢åŠ è½½äº‹ä»¶

### å®Œæ•´çš„äº‹ä»¶é¡ºåº

```javascript
/**
 * é¡µé¢åŠ è½½çš„æ‰€æœ‰å…³é”®äº‹ä»¶ï¼ˆæŒ‰é¡ºåºï¼‰
 */

// 1ï¸âƒ£ readystatechange (loading)
document.addEventListener('readystatechange', () => {
  console.log('readyState:', document.readyState);
});
// readyState: loading â†’ interactive â†’ complete

// 2ï¸âƒ£ DOMContentLoaded
document.addEventListener('DOMContentLoaded', () => {
  console.log('2ï¸âƒ£ DOMContentLoaded');
  console.log('   readyState:', document.readyState); // 'interactive'
});

// 3ï¸âƒ£ readystatechange (complete)
// (ä¼šåœ¨ window.onload ä¹‹å‰è§¦å‘)

// 4ï¸âƒ£ window.onload
window.addEventListener('load', () => {
  console.log('4ï¸âƒ£ window.onload');
  console.log('   readyState:', document.readyState); // 'complete'
});

// 5ï¸âƒ£ é¡µé¢å¸è½½ç›¸å…³
window.addEventListener('beforeunload', (e) => {
  console.log('5ï¸âƒ£ beforeunloadï¼ˆé¡µé¢å³å°†å¸è½½ï¼‰');
  
  // å¯ä»¥æ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†
  e.preventDefault();
  e.returnValue = '';  // Chrome éœ€è¦
});

window.addEventListener('unload', () => {
  console.log('6ï¸âƒ£ unloadï¼ˆé¡µé¢æ­£åœ¨å¸è½½ï¼‰');
  // å‘é€ç»Ÿè®¡æ•°æ®ç­‰
});

/**
 * å®Œæ•´æ—¶é—´çº¿ï¼š
 * 
 * 0ms    â†’ readystatechange (loading)
 * 200ms  â†’ DOMContentLoaded
 *        â†’ readystatechange (interactive)
 * 2000ms â†’ readystatechange (complete)
 *        â†’ window.onload
 * ...    â†’ ç”¨æˆ·å…³é—­é¡µé¢
 *        â†’ beforeunload
 *        â†’ unload
 */
```

### document.readyState

```javascript
/**
 * document.readyState æœ‰ä¸‰ä¸ªçŠ¶æ€
 */

const readyStates = {
  loading: {
    meaning: 'æ–‡æ¡£æ­£åœ¨åŠ è½½',
    timing: 'é¡µé¢åˆšå¼€å§‹åŠ è½½',
    example: 'HTML æ­£åœ¨è§£æä¸­'
  },
  
  interactive: {
    meaning: 'DOM æ ‘å·²æ„å»ºï¼Œä½†èµ„æºä»åœ¨åŠ è½½',
    timing: 'DOMContentLoaded ä¹‹å',
    example: 'DOM å¯ä»¥æ“ä½œï¼Œä½†å›¾ç‰‡è¿˜åœ¨åŠ è½½'
  },
  
  complete: {
    meaning: 'æ‰€æœ‰èµ„æºåŠ è½½å®Œæˆ',
    timing: 'window.onload ä¹‹å‰',
    example: 'åŒ…æ‹¬å›¾ç‰‡ã€CSS ç­‰æ‰€æœ‰èµ„æº'
  }
};

// æ£€æŸ¥å½“å‰çŠ¶æ€
console.log('å½“å‰çŠ¶æ€:', document.readyState);

// ç›‘å¬çŠ¶æ€å˜åŒ–
document.addEventListener('readystatechange', () => {
  console.log('çŠ¶æ€å˜ä¸º:', document.readyState);
  
  if (document.readyState === 'interactive') {
    console.log('DOM å¯ç”¨');
  }
  
  if (document.readyState === 'complete') {
    console.log('æ‰€æœ‰èµ„æºåŠ è½½å®Œæˆ');
  }
});
```

---

## â±ï¸ è¯¦ç»†æ—¶é—´çº¿ï¼ˆå®Œæ•´ç¤ºä¾‹ï¼‰

### HTML é¡µé¢

```html
<!DOCTYPE html>
<html>
<head>
  <title>åŠ è½½äº‹ä»¶æµ‹è¯•</title>
  <link rel="stylesheet" href="style.css">  <!-- éœ€è¦ 500ms -->
  <script>
    const startTime = Date.now();
    
    function log(event) {
      const time = Date.now() - startTime;
      console.log(`[${time}ms] ${event}`);
    }
    
    log('â±ï¸ è„šæœ¬å¼€å§‹æ‰§è¡Œ');
    log('readyState: ' + document.readyState);  // loading
  </script>
</head>
<body>
  <h1>åŠ è½½äº‹ä»¶æµ‹è¯•</h1>
  <img src="image1.jpg" alt="å›¾1">  <!-- éœ€è¦ 1000ms -->
  <img src="image2.jpg" alt="å›¾2">  <!-- éœ€è¦ 2000ms -->
  
  <script>
    log('â±ï¸ body ä¸­çš„è„šæœ¬æ‰§è¡Œ');
    
    // 1. DOMContentLoaded
    document.addEventListener('DOMContentLoaded', () => {
      log('ğŸ”” 1ï¸âƒ£ DOMContentLoaded');
      log('   readyState: ' + document.readyState);  // interactive
      
      // DOM å·²å‡†å¤‡å¥½
      const h1 = document.querySelector('h1');
      log('   h1 å†…å®¹: ' + h1.textContent);
      
      // å›¾ç‰‡å¯èƒ½è¿˜æ²¡åŠ è½½å®Œ
      const images = document.querySelectorAll('img');
      let loaded = 0;
      images.forEach(img => {
        if (img.complete) loaded++;
      });
      log(`   å›¾ç‰‡åŠ è½½è¿›åº¦: ${loaded}/${images.length}`);
    });
    
    // 2. readystatechange
    document.addEventListener('readystatechange', () => {
      log('ğŸ“„ readystatechange: ' + document.readyState);
    });
    
    // 3. window.onload
    window.addEventListener('load', () => {
      log('ğŸ”” 2ï¸âƒ£ window.onload');
      log('   readyState: ' + document.readyState);  // complete
      
      // æ‰€æœ‰èµ„æºéƒ½åŠ è½½å®Œæˆ
      const images = document.querySelectorAll('img');
      images.forEach((img, i) => {
        log(`   å›¾ç‰‡${i + 1}: ${img.width}x${img.height}`);
      });
    });
    
    log('â±ï¸ è„šæœ¬æ‰§è¡Œç»“æŸ');
  </script>
</body>
</html>

<!--
  å…¸å‹è¾“å‡ºï¼š
  
  [0ms]    â±ï¸ è„šæœ¬å¼€å§‹æ‰§è¡Œ
  [0ms]    readyState: loading
  [5ms]    â±ï¸ body ä¸­çš„è„šæœ¬æ‰§è¡Œ
  [5ms]    â±ï¸ è„šæœ¬æ‰§è¡Œç»“æŸ
  [200ms]  ğŸ“„ readystatechange: interactive
  [200ms]  ğŸ”” 1ï¸âƒ£ DOMContentLoaded
  [200ms]     readyState: interactive
  [200ms]     h1 å†…å®¹: åŠ è½½äº‹ä»¶æµ‹è¯•
  [200ms]     å›¾ç‰‡åŠ è½½è¿›åº¦: 0/2  â† å›¾ç‰‡è¿˜æ²¡åŠ è½½å®Œ
  [2500ms] ğŸ“„ readystatechange: complete
  [2500ms] ğŸ”” 2ï¸âƒ£ window.onload
  [2500ms]    readyState: complete
  [2500ms]    å›¾ç‰‡1: 800x600
  [2500ms]    å›¾ç‰‡2: 1024x768  â† æ‰€æœ‰å›¾ç‰‡éƒ½åŠ è½½å®Œäº†
-->
```

---

## ğŸš€ è„šæœ¬åŠ è½½å¯¹äº‹ä»¶çš„å½±å“

### åŒæ­¥è„šæœ¬ï¼ˆé˜»å¡ DOMContentLoadedï¼‰

```html
<head>
  <script>
    // åŒæ­¥è„šæœ¬ä¼šé˜»å¡ HTML è§£æ
    // DOMContentLoaded å¿…é¡»ç­‰å¾…å®ƒæ‰§è¡Œå®Œæˆ
  </script>
  
  <script src="large-lib.js"></script>
  <!-- 
    å¦‚æœè¿™ä¸ªè„šæœ¬éœ€è¦ 3 ç§’ä¸‹è½½å’Œæ‰§è¡Œ
    DOMContentLoaded å°±è¦ç­‰å¾… 3 ç§’
  -->
</head>
<body>
  <!-- DOMContentLoaded å¿…é¡»ç­‰å¾…ä¸Šé¢çš„è„šæœ¬ -->
</body>

<!--
  æ—¶é—´çº¿ï¼š
  0ms    â†’ å¼€å§‹è§£æ
  0ms    â†’ é‡åˆ° scriptï¼Œå¼€å§‹ä¸‹è½½
  3000ms â†’ è„šæœ¬ä¸‹è½½å¹¶æ‰§è¡Œå®Œæˆ
  3000ms â†’ ç»§ç»­è§£æ HTML
  3100ms â†’ DOMContentLoaded  â† ç­‰å¾…äº†è„šæœ¬
  3500ms â†’ window.onload
-->
```

### async è„šæœ¬ï¼ˆä¸é˜»å¡ DOMContentLoadedï¼‰

```html
<head>
  <script async src="analytics.js"></script>
  <!-- async è„šæœ¬ä¸é˜»å¡ HTML è§£æ -->
  <!-- ä¹Ÿä¸é˜»å¡ DOMContentLoaded -->
</head>
<body>
  <div id="app">Content</div>
</body>

<!--
  æ—¶é—´çº¿ï¼š
  0ms    â†’ å¼€å§‹è§£æ + å¹¶è¡Œä¸‹è½½ analytics.js
  200ms  â†’ HTML è§£æå®Œæˆ
  200ms  â†’ DOMContentLoaded  â† ä¸ç­‰ async è„šæœ¬
  2000ms â†’ analytics.js ä¸‹è½½å®Œæˆå¹¶æ‰§è¡Œ
  2000ms â†’ window.onload
-->
```

### defer è„šæœ¬ï¼ˆé˜»å¡ DOMContentLoadedï¼‰

```html
<head>
  <script defer src="app.js"></script>
  <!-- defer è„šæœ¬åœ¨ DOMContentLoaded ä¹‹å‰æ‰§è¡Œ -->
</head>
<body>
  <div id="app">Content</div>
</body>

<!--
  æ—¶é—´çº¿ï¼š
  0ms    â†’ å¼€å§‹è§£æ + å¹¶è¡Œä¸‹è½½ app.js
  200ms  â†’ HTML è§£æå®Œæˆ
  200ms  â†’ ç­‰å¾… defer è„šæœ¬
  500ms  â†’ app.js æ‰§è¡Œå®Œæˆ
  500ms  â†’ DOMContentLoaded  â† ç­‰å¾…äº† defer è„šæœ¬
  800ms  â†’ window.onload
-->
```

### å¯¹æ¯”æ€»ç»“

```javascript
const scriptComparison = {
  // åŒæ­¥è„šæœ¬ <script src="...">
  sync: {
    htmlParsing: 'âŒ é˜»å¡ HTML è§£æ',
    domContentLoaded: 'âŒ é˜»å¡ DOMContentLoaded',
    execution: 'ç«‹å³ä¸‹è½½å¹¶æ‰§è¡Œ'
  },
  
  // async è„šæœ¬ <script async src="...">
  async: {
    htmlParsing: 'âœ… ä¸é˜»å¡ HTML è§£æ',
    domContentLoaded: 'âœ… ä¸é˜»å¡ DOMContentLoaded',
    execution: 'ä¸‹è½½å®Œæˆåç«‹å³æ‰§è¡Œï¼ˆå¯èƒ½åœ¨ DOMContentLoaded ä¹‹å‰æˆ–ä¹‹åï¼‰'
  },
  
  // defer è„šæœ¬ <script defer src="...">
  defer: {
    htmlParsing: 'âœ… ä¸é˜»å¡ HTML è§£æ',
    domContentLoaded: 'âŒ é˜»å¡ DOMContentLoaded',
    execution: 'åœ¨ DOMContentLoaded ä¹‹å‰æ‰§è¡Œï¼ˆä¿è¯é¡ºåºï¼‰'
  }
};
```

---

## ğŸ’¡ jQuery çš„ ready äº‹ä»¶

### $(document).ready()

```javascript
/**
 * jQuery çš„ ready ç­‰åŒäº DOMContentLoaded
 */

// jQuery
$(document).ready(function() {
  console.log('jQuery readyï¼ˆç­‰åŒäº DOMContentLoadedï¼‰');
});

// ç®€å†™
$(function() {
  console.log('jQuery ready ç®€å†™');
});

// åŸç”Ÿç­‰ä»·å†™æ³•
document.addEventListener('DOMContentLoaded', () => {
  console.log('åŸç”Ÿ DOMContentLoaded');
});

/**
 * æ³¨æ„ï¼š
 * $(window).load() ç­‰åŒäº window.onload
 */
$(window).on('load', function() {
  console.log('ç­‰åŒäº window.onload');
});
```

---

## ğŸ¯ æœ€ä½³å®è·µ

### æ¨èä½¿ç”¨ DOMContentLoaded

```javascript
/**
 * å¤§å¤šæ•°æƒ…å†µä¸‹ä½¿ç”¨ DOMContentLoaded
 */

// âœ… æ¨è
document.addEventListener('DOMContentLoaded', () => {
  // åˆå§‹åŒ–åº”ç”¨
  initApp();
  
  // ç»‘å®šäº‹ä»¶
  setupEventListeners();
  
  // å¯¹äºå›¾ç‰‡ï¼Œå•ç‹¬å¤„ç†
  const images = document.querySelectorAll('img');
  images.forEach(img => {
    if (img.complete) {
      handleImage(img);
    } else {
      img.addEventListener('load', () => handleImage(img));
    }
  });
});

/**
 * åŸå› ï¼š
 * - æ›´å¿«ï¼ˆç”¨æˆ·æ›´æ—©çœ‹åˆ°å¯äº¤äº’é¡µé¢ï¼‰
 * - å¤§å¤šæ•°æ“ä½œä¸éœ€è¦ç­‰å¾…å›¾ç‰‡
 * - å¯ä»¥é’ˆå¯¹ç‰¹å®šèµ„æºå•ç‹¬å¤„ç†
 */
```

### ä½•æ—¶ä½¿ç”¨ window.onload

```javascript
/**
 * åªåœ¨å¿…è¦æ—¶ä½¿ç”¨ window.onload
 */

// ä½¿ç”¨åœºæ™¯
const useOnload = {
  scenario1: 'éœ€è¦çŸ¥é“æ‰€æœ‰å›¾ç‰‡å°ºå¯¸',
  scenario2: 'ä¾èµ–å¤–éƒ¨èµ„æºçš„è®¡ç®—',
  scenario3: 'æ€§èƒ½ç›‘æ§ï¼ˆå®Œæ•´åŠ è½½æ—¶é—´ï¼‰',
  scenario4: 'canvas å¤„ç†å›¾ç‰‡'
};

// ç¤ºä¾‹
window.addEventListener('load', () => {
  // æ€§èƒ½ç›‘æ§
  const loadTime = performance.timing.loadEventEnd - 
                   performance.timing.navigationStart;
  console.log('é¡µé¢å®Œå…¨åŠ è½½è€—æ—¶:', loadTime, 'ms');
  
  // ä¸ŠæŠ¥ç»Ÿè®¡
  analytics.send('page_load_time', loadTime);
});
```

---

## ğŸ§ª å®é™…æµ‹è¯•

### æµ‹è¯•é¡µé¢

```html
<!DOCTYPE html>
<html>
<head>
  <title>äº‹ä»¶é¡ºåºæµ‹è¯•</title>
  <style>
    body { font-family: monospace; }
    .log { background: #f0f0f0; padding: 10px; margin: 5px 0; }
    .time { color: #0066cc; font-weight: bold; }
    .event { color: #cc0000; }
  </style>
  <script>
    const startTime = performance.now();
    const logs = [];
    
    function log(message) {
      const time = (performance.now() - startTime).toFixed(2);
      logs.push({ time, message });
      console.log(`[${time}ms] ${message}`);
    }
    
    log('1ï¸âƒ£ HEAD ä¸­çš„è„šæœ¬æ‰§è¡Œ');
    log('   readyState: ' + document.readyState);
  </script>
</head>
<body>
  <h1>é¡µé¢åŠ è½½äº‹ä»¶é¡ºåºæµ‹è¯•</h1>
  <div id="log-container"></div>
  
  <!-- å¤§å›¾ç‰‡ï¼ˆæ¨¡æ‹Ÿæ…¢é€ŸåŠ è½½ï¼‰ -->
  <img src="https://via.placeholder.com/2000x2000" alt="å¤§å›¾">
  
  <script>
    log('2ï¸âƒ£ BODY ä¸­çš„è„šæœ¬æ‰§è¡Œ');
    
    // DOMContentLoaded
    document.addEventListener('DOMContentLoaded', () => {
      log('ğŸ”” 3ï¸âƒ£ DOMContentLoaded è§¦å‘');
      log('   readyState: ' + document.readyState);
      log('   DOM æ˜¯å¦å¯ç”¨: ' + (document.getElementById('log-container') ? 'YES' : 'NO'));
      
      const img = document.querySelector('img');
      log('   å›¾ç‰‡æ˜¯å¦åŠ è½½: ' + (img.complete ? 'YES' : 'NO'));
    });
    
    // readystatechange
    document.addEventListener('readystatechange', () => {
      log('ğŸ“„ readystatechange: ' + document.readyState);
    });
    
    // window.onload
    window.addEventListener('load', () => {
      log('ğŸ”” 4ï¸âƒ£ window.onload è§¦å‘');
      log('   readyState: ' + document.readyState);
      
      const img = document.querySelector('img');
      log('   å›¾ç‰‡æ˜¯å¦åŠ è½½: ' + (img.complete ? 'YES' : 'NO'));
      log('   å›¾ç‰‡å°ºå¯¸: ' + img.width + 'x' + img.height);
      
      // æ˜¾ç¤ºæ‰€æœ‰æ—¥å¿—
      displayLogs();
    });
    
    function displayLogs() {
      const container = document.getElementById('log-container');
      container.innerHTML = '<h2>äº‹ä»¶æ—¥å¿—ï¼š</h2>';
      
      logs.forEach(({ time, message }) => {
        const div = document.createElement('div');
        div.className = 'log';
        div.innerHTML = `<span class="time">[${time}ms]</span> <span class="event">${message}</span>`;
        container.appendChild(div);
      });
    }
  </script>
</body>
</html>
```

---

## ğŸ“Š æ€§èƒ½ç›‘æ§

### Performance API

```javascript
/**
 * ä½¿ç”¨ Performance API ç²¾ç¡®æµ‹é‡
 */

window.addEventListener('load', () => {
  const timing = performance.timing;
  
  console.log('=== é¡µé¢åŠ è½½æ—¶é—´åˆ†æ ===');
  
  // 1. DOM è§£ææ—¶é—´
  const domParsing = timing.domInteractive - timing.domLoading;
  console.log('DOM è§£æ:', domParsing, 'ms');
  
  // 2. DOMContentLoaded æ—¶é—´
  const domContentLoaded = timing.domContentLoadedEventEnd - timing.navigationStart;
  console.log('DOMContentLoaded:', domContentLoaded, 'ms');
  
  // 3. å®Œæ•´åŠ è½½æ—¶é—´
  const pageLoad = timing.loadEventEnd - timing.navigationStart;
  console.log('é¡µé¢å®Œå…¨åŠ è½½:', pageLoad, 'ms');
  
  // 4. é¦–æ¬¡æ¸²æŸ“
  const firstPaint = performance.getEntriesByType('paint')
    .find(entry => entry.name === 'first-paint');
  console.log('é¦–æ¬¡æ¸²æŸ“:', firstPaint?.startTime.toFixed(2), 'ms');
  
  // 5. é¦–æ¬¡å†…å®¹æ¸²æŸ“
  const firstContentfulPaint = performance.getEntriesByType('paint')
    .find(entry => entry.name === 'first-contentful-paint');
  console.log('é¦–æ¬¡å†…å®¹æ¸²æŸ“:', firstContentfulPaint?.startTime.toFixed(2), 'ms');
});

/**
 * å…¸å‹è¾“å‡ºï¼š
 * 
 * DOM è§£æ: 150 ms
 * DOMContentLoaded: 200 ms
 * é¡µé¢å®Œå…¨åŠ è½½: 2500 ms
 * é¦–æ¬¡æ¸²æŸ“: 180 ms
 * é¦–æ¬¡å†…å®¹æ¸²æŸ“: 200 ms
 */
```

---

## ğŸ¨ å®ç”¨å·¥å…·å‡½æ•°

### é€šç”¨çš„ DOM Ready å‡½æ•°

```javascript
/**
 * è·¨æµè§ˆå™¨çš„ DOM ready å‡½æ•°
 */
function domReady(callback) {
  if (document.readyState === 'loading') {
    // DOM è¿˜åœ¨åŠ è½½ï¼Œç›‘å¬ DOMContentLoaded
    document.addEventListener('DOMContentLoaded', callback);
  } else {
    // DOM å·²ç»åŠ è½½å®Œæˆï¼Œç«‹å³æ‰§è¡Œ
    callback();
  }
}

// ä½¿ç”¨
domReady(() => {
  console.log('DOM å·²å‡†å¤‡å¥½');
  initApp();
});

/**
 * ä¸ºä»€ä¹ˆè¦æ£€æŸ¥ readyStateï¼Ÿ
 * 
 * å¦‚æœè„šæœ¬æ˜¯åŠ¨æ€æ’å…¥çš„ï¼Œå¯èƒ½åœ¨ DOMContentLoaded ä¹‹åæ‰æ‰§è¡Œ
 * æ­¤æ—¶ç›‘å¬ DOMContentLoaded æ— æ•ˆï¼ˆäº‹ä»¶å·²ç»è§¦å‘è¿‡äº†ï¼‰
 * å¿…é¡»ç«‹å³æ‰§è¡Œå›è°ƒ
 */
```

### ç­‰å¾…ç‰¹å®šèµ„æº

```javascript
/**
 * ç­‰å¾…ç‰¹å®šå›¾ç‰‡åŠ è½½å®Œæˆ
 */
function waitForImage(selector) {
  return new Promise((resolve) => {
    const img = document.querySelector(selector);
    
    if (!img) {
      resolve(null);
      return;
    }
    
    if (img.complete) {
      resolve(img);
    } else {
      img.addEventListener('load', () => resolve(img));
      img.addEventListener('error', () => resolve(null));
    }
  });
}

// ä½¿ç”¨
document.addEventListener('DOMContentLoaded', async () => {
  console.log('DOM å‡†å¤‡å¥½äº†');
  
  // ç­‰å¾…ç‰¹å®šå›¾ç‰‡
  const heroImage = await waitForImage('#hero-image');
  if (heroImage) {
    console.log('ä¸»å›¾åŠ è½½å®Œæˆ:', heroImage.width, 'x', heroImage.height);
    animateHeroImage(heroImage);
  }
});
```

---

## ğŸ“‹ å¸¸è§è¯¯åŒº

### è¯¯åŒº1ï¼šè®¤ä¸º window.onload æ›´æ—©

```javascript
// âŒ é”™è¯¯ç†è§£
window.onload = function() {
  // ä»¥ä¸ºè¿™é‡Œæœ€æ—©æ‰§è¡Œ
  initApp();
};

// âœ… å®é™…ä¸Š DOMContentLoaded æ›´æ—©
document.addEventListener('DOMContentLoaded', () => {
  // è¿™é‡Œå…ˆæ‰§è¡Œï¼
  initApp();
});
```

### è¯¯åŒº2ï¼šæ··æ·† readyState å’Œäº‹ä»¶

```javascript
// âŒ é”™è¯¯
if (document.readyState === 'complete') {
  // ä»¥ä¸ºç­‰åŒäº DOMContentLoaded
}

// âœ… æ­£ç¡®ç†è§£
const states = {
  loading: 'HTML æ­£åœ¨è§£æ',
  interactive: 'DOM æ„å»ºå®Œæˆï¼ˆDOMContentLoaded æ—¶åˆ»ï¼‰',
  complete: 'æ‰€æœ‰èµ„æºåŠ è½½å®Œæˆï¼ˆwindow.onload æ—¶åˆ»ï¼‰'
};
```

### è¯¯åŒº3ï¼šé‡å¤ç»‘å®š onload

```javascript
// âŒ é”™è¯¯ï¼šä¼šè¦†ç›–
window.onload = function() {
  console.log('ç¬¬ä¸€ä¸ª');
};

window.onload = function() {
  console.log('ç¬¬äºŒä¸ª');  // åªä¼šæ‰§è¡Œè¿™ä¸ª
};

// âœ… æ­£ç¡®ï¼šä½¿ç”¨ addEventListener
window.addEventListener('load', () => {
  console.log('ç¬¬ä¸€ä¸ª');
});

window.addEventListener('load', () => {
  console.log('ç¬¬äºŒä¸ª');  // éƒ½ä¼šæ‰§è¡Œ
});
```

---

## ğŸ“Š æ€»ç»“å¯¹æ¯”è¡¨

### äº‹ä»¶å¯¹æ¯”

| äº‹ä»¶ | è§¦å‘æ—¶æœº | ç­‰å¾…èµ„æº | å…¸å‹è€—æ—¶ | ä½¿ç”¨åœºæ™¯ |
|------|---------|---------|---------|---------|
| **DOMContentLoaded** | DOM æ ‘æ„å»ºå®Œæˆ | HTMLã€åŒæ­¥/defer è„šæœ¬ | 200-500ms | â­ åˆå§‹åŒ–åº”ç”¨ï¼ˆæ¨èï¼‰ |
| **window.onload** | æ‰€æœ‰èµ„æºåŠ è½½å®Œæˆ | æ‰€æœ‰ï¼ˆå›¾ç‰‡ã€CSS ç­‰ï¼‰ | 1-5ç§’ | å›¾ç‰‡å¤„ç†ã€å®Œæ•´åŠ è½½ç»Ÿè®¡ |
| **readystatechange** | çŠ¶æ€å˜åŒ– | æ ¹æ®çŠ¶æ€ä¸åŒ | - | ç›‘æ§åŠ è½½è¿‡ç¨‹ |

### å¿«é€Ÿå†³ç­–

```
éœ€æ±‚                        â†’  ä½¿ç”¨äº‹ä»¶
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
æ“ä½œ DOMã€ç»‘å®šäº‹ä»¶          â†’  DOMContentLoaded
åˆå§‹åŒ– JS åº”ç”¨              â†’  DOMContentLoaded
éœ€è¦å›¾ç‰‡å°ºå¯¸                â†’  window.onload
Canvas å¤„ç†å›¾ç‰‡             â†’  window.onload
æ€§èƒ½ç»Ÿè®¡ï¼ˆå®Œæ•´åŠ è½½æ—¶é—´ï¼‰    â†’  window.onload
ç§»é™¤ loading åŠ¨ç”»           â†’  window.onload
```

---

## ğŸ’¡ ç°ä»£æ¡†æ¶çš„å¤„ç†

### Reactã€Vue ç­‰æ¡†æ¶

```javascript
/**
 * ç°ä»£æ¡†æ¶é€šå¸¸åœ¨ DOMContentLoaded æ—¶åˆå§‹åŒ–
 */

// React
import React from 'react';
import ReactDOM from 'react-dom';

// é€šå¸¸ç›´æ¥æ‰§è¡Œï¼ˆscript åœ¨ body åº•éƒ¨æˆ– deferï¼‰
ReactDOM.render(<App />, document.getElementById('root'));

// æˆ–æ˜ç¡®ç­‰å¾… DOM
document.addEventListener('DOMContentLoaded', () => {
  ReactDOM.render(<App />, document.getElementById('root'));
});

// Vue
import { createApp } from 'vue';

// ç›´æ¥ mountï¼ˆå¦‚æœ script åœ¨åº•éƒ¨ï¼‰
createApp(App).mount('#app');

// æˆ–ç­‰å¾… DOM
document.addEventListener('DOMContentLoaded', () => {
  createApp(App).mount('#app');
});

/**
 * ä¸ºä»€ä¹ˆä¸ç”¨ window.onloadï¼Ÿ
 * 
 * - å¤ªæ…¢ï¼ˆè¦ç­‰æ‰€æœ‰å›¾ç‰‡ï¼‰
 * - å¤§å¤šæ•°åº”ç”¨ä¸éœ€è¦ç­‰å›¾ç‰‡
 * - ç”¨æˆ·ä½“éªŒæ›´å¥½ï¼ˆæ›´å¿«çœ‹åˆ°å¯äº¤äº’é¡µé¢ï¼‰
 */
```

---

## ğŸ“š æ€»ç»“

### æ ¸å¿ƒè¦ç‚¹

1. **æ‰§è¡Œé¡ºåº**
   ```
   DOMContentLoadedï¼ˆå…ˆï¼‰â†’ window.onloadï¼ˆåï¼‰
   ```

2. **è§¦å‘æ¡ä»¶**
   ```
   DOMContentLoaded: DOM æ ‘æ„å»ºå®Œæˆ
   window.onload: æ‰€æœ‰èµ„æºåŠ è½½å®Œæˆ
   ```

3. **æ—¶é—´å·®å¼‚**
   ```
   DOMContentLoaded: ~200-500ms
   window.onload: ~1-5ç§’ï¼ˆå–å†³äºèµ„æºï¼‰
   ```

4. **ä½¿ç”¨å»ºè®®**
   ```
   90% çš„åœºæ™¯ç”¨ DOMContentLoaded
   åªåœ¨éœ€è¦å®Œæ•´èµ„æºæ—¶ç”¨ window.onload
   ```

### è®°å¿†å£è¯€

```
DOMContentLoaded â†’ DOM å‡†å¤‡å¥½ï¼ˆå¿«ï¼‰
window.onload    â†’ æ‰€æœ‰èµ„æºå¥½ï¼ˆæ…¢ï¼‰

DOM â†’ éª¨æ¶æ­å¥½ï¼ˆå¯ä»¥è£…ä¿®ï¼‰
Load â†’ å®¶å…·é½å…¨ï¼ˆå®Œå…¨è£…ä¿®å¥½ï¼‰
```

æ–‡æ¡£ä½ç½®ï¼š`é¡µé¢åŠ è½½äº‹ä»¶è¯¦è§£.md`

åŒ…å«ï¼šå®Œæ•´äº‹ä»¶é¡ºåºã€è„šæœ¬å½±å“ã€å®é™…æµ‹è¯•ã€æœ€ä½³å®è·µï¼ğŸ‰
