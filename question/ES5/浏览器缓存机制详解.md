# æµè§ˆå™¨ç¼“å­˜æœºåˆ¶è¯¦è§£

## ğŸ¯ æ ¸å¿ƒé—®é¢˜ï¼šé…é¢æ˜¯å¦‚ä½•è®¡ç®—çš„ï¼Ÿ

### ç®€çŸ­å›ç­”

**Service Worker ç¼“å­˜å’Œ HTTP ç¼“å­˜ï¼ˆå¼ºç¼“å­˜ã€åå•†ç¼“å­˜ï¼‰æ˜¯åˆ†å¼€è®¡ç®—çš„ï¼**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          æµè§ˆå™¨å­˜å‚¨é…é¢ï¼ˆå…±äº«é…é¢ï¼‰              â”‚
â”‚                 çº¦ 10-20GB                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚  âœ… Service Worker (Cache Storage)              â”‚
â”‚     â””â”€ çº¦ 5GB                                   â”‚
â”‚                                                 â”‚
â”‚  âœ… IndexedDB                                   â”‚
â”‚     â””â”€ çº¦ 3GB                                   â”‚
â”‚                                                 â”‚
â”‚  âœ… LocalStorage / SessionStorage               â”‚
â”‚     â””â”€ çº¦ 10MB                                  â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       HTTP ç¼“å­˜ï¼ˆç‹¬ç«‹ï¼Œä¸è®¡å…¥é…é¢ï¼‰              â”‚
â”‚                 çº¦ 300-500MB                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚  âŒ å¼ºç¼“å­˜ï¼ˆMemory Cache + Disk Cacheï¼‰         â”‚
â”‚     â””â”€ æµè§ˆå™¨è‡ªåŠ¨ç®¡ç†ï¼Œä¸å ç”¨é…é¢                â”‚
â”‚                                                 â”‚
â”‚  âŒ åå•†ç¼“å­˜                                    â”‚
â”‚     â””â”€ å±äº HTTP ç¼“å­˜çš„ä¸€éƒ¨åˆ†                   â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š ä¸‰ç§ç¼“å­˜å¯¹æ¯”

| ç¼“å­˜ç±»å‹ | å­˜å‚¨ä½ç½® | é…é¢è®¡ç®— | å¤§å°é™åˆ¶ | ç®¡ç†æ–¹å¼ |
|---------|---------|---------|---------|---------|
| **HTTP å¼ºç¼“å­˜/åå•†ç¼“å­˜** | æµè§ˆå™¨è‡ªåŠ¨ç®¡ç† | âŒ ä¸è®¡å…¥é…é¢ | ~300-500MB | æµè§ˆå™¨è‡ªåŠ¨ |
| **Service Worker ç¼“å­˜** | Cache Storage API | âœ… è®¡å…¥é…é¢ | å–å†³äºé…é¢ | å¼€å‘è€…æ§åˆ¶ |
| **IndexedDB** | æµè§ˆå™¨æ•°æ®åº“ | âœ… è®¡å…¥é…é¢ | å–å†³äºé…é¢ | å¼€å‘è€…æ§åˆ¶ |

---

## 1ï¸âƒ£ HTTP ç¼“å­˜ï¼ˆå¼ºç¼“å­˜ + åå•†ç¼“å­˜ï¼‰

### ä»€ä¹ˆæ˜¯ HTTP ç¼“å­˜ï¼Ÿ

HTTP ç¼“å­˜æ˜¯æµè§ˆå™¨**è‡ªåŠ¨ç®¡ç†**çš„ç¼“å­˜ï¼Œç”± HTTP å“åº”å¤´æ§åˆ¶ã€‚

```
HTTP ç¼“å­˜
â”œâ”€ å¼ºç¼“å­˜ï¼ˆä¸å‘è¯·æ±‚ï¼‰
â”‚  â”œâ”€ Memory Cacheï¼ˆå†…å­˜ç¼“å­˜ï¼‰
â”‚  â””â”€ Disk Cacheï¼ˆç£ç›˜ç¼“å­˜ï¼‰
â””â”€ åå•†ç¼“å­˜ï¼ˆå‘è¯·æ±‚ï¼Œä½†å¯èƒ½è¿”å› 304ï¼‰
```

### å¼ºç¼“å­˜

```http
# å“åº”å¤´æ§åˆ¶
Cache-Control: max-age=31536000, public
Expires: Wed, 21 Oct 2025 07:28:00 GMT
```

```javascript
/**
 * å¼ºç¼“å­˜æµç¨‹
 */
const strongCache = {
  request1: {
    action: 'ç¬¬ä¸€æ¬¡è¯·æ±‚ /app.js',
    response: 'æœåŠ¡å™¨è¿”å›æ–‡ä»¶ + Cache-Control: max-age=3600',
    cache: 'æµè§ˆå™¨ç¼“å­˜åˆ°æœ¬åœ°ï¼ˆMemory/Disk Cacheï¼‰'
  },
  
  request2: {
    action: '1å°æ—¶å†…å†æ¬¡è¯·æ±‚ /app.js',
    check: 'æ£€æŸ¥ç¼“å­˜æ˜¯å¦è¿‡æœŸï¼Ÿ',
    result: 'æœªè¿‡æœŸ â†’ ç›´æ¥ä»ç¼“å­˜è¯»å–ï¼ˆä¸å‘ç½‘ç»œè¯·æ±‚ï¼‰',
    status: '200 OK (from disk cache) æˆ– (from memory cache)',
    time: '< 10msï¼ˆéå¸¸å¿«ï¼‰'
  }
};
```

### åå•†ç¼“å­˜

```http
# ç¬¬ä¸€æ¬¡å“åº”
ETag: "abc123"
Last-Modified: Mon, 01 Nov 2025 10:00:00 GMT

# ç¬¬äºŒæ¬¡è¯·æ±‚
If-None-Match: "abc123"
If-Modified-Since: Mon, 01 Nov 2025 10:00:00 GMT

# æœåŠ¡å™¨å“åº”
304 Not Modifiedï¼ˆæ–‡ä»¶æœªæ”¹å˜ï¼Œä½¿ç”¨ç¼“å­˜ï¼‰
```

```javascript
/**
 * åå•†ç¼“å­˜æµç¨‹
 */
const negotiationCache = {
  request1: {
    action: 'ç¬¬ä¸€æ¬¡è¯·æ±‚',
    response: 'æœåŠ¡å™¨è¿”å› ETag: "abc123"',
    cache: 'æµè§ˆå™¨ç¼“å­˜æ–‡ä»¶'
  },
  
  request2: {
    action: 'ç¼“å­˜è¿‡æœŸï¼Œå†æ¬¡è¯·æ±‚',
    header: 'å‘é€ If-None-Match: "abc123"',
    serverCheck: 'æœåŠ¡å™¨æ£€æŸ¥æ–‡ä»¶æ˜¯å¦æ”¹å˜',
    
    scenario1: {
      condition: 'æ–‡ä»¶æœªæ”¹å˜',
      response: '304 Not Modifiedï¼ˆä¸è¿”å›æ–‡ä»¶å†…å®¹ï¼‰',
      action: 'æµè§ˆå™¨ä½¿ç”¨æœ¬åœ°ç¼“å­˜',
      benefit: 'èŠ‚çœå¸¦å®½ï¼ˆåªä¼ è¾“å“åº”å¤´ï¼‰'
    },
    
    scenario2: {
      condition: 'æ–‡ä»¶å·²æ”¹å˜',
      response: '200 OK + æ–°æ–‡ä»¶ + æ–° ETag',
      action: 'æµè§ˆå™¨æ›´æ–°ç¼“å­˜'
    }
  }
};
```

### HTTP ç¼“å­˜çš„å­˜å‚¨ä½ç½®

```javascript
/**
 * HTTP ç¼“å­˜å­˜å‚¨åœ¨å“ªé‡Œï¼Ÿ
 */
const httpCacheLocation = {
  // Memory Cacheï¼ˆå†…å­˜ç¼“å­˜ï¼‰
  memoryCache: {
    location: 'RAMï¼ˆå†…å­˜ï¼‰',
    size: '~50-200 MB',
    speed: 'æå¿«ï¼ˆ<1msï¼‰',
    persistence: 'å…³é—­æ ‡ç­¾é¡µå°±æ¸…é™¤',
    priority: 'ä¼˜å…ˆæ£€æŸ¥è¿™é‡Œ',
    quota: 'âŒ ä¸è®¡å…¥ Storage API é…é¢'
  },
  
  // Disk Cacheï¼ˆç£ç›˜ç¼“å­˜ï¼‰
  diskCache: {
    location: 'ç£ç›˜æ–‡ä»¶ç³»ç»Ÿ',
    path: {
      chrome: '~/Library/Caches/Google/Chrome/Default/Cache/ (Mac)',
      windows: 'C:\\Users\\<username>\\AppData\\Local\\Google\\Chrome\\User Data\\Default\\Cache'
    },
    size: '~300-500 MB',
    speed: 'å¿«ï¼ˆ10-50msï¼‰',
    persistence: 'é•¿æœŸä¿å­˜',
    priority: 'Memory Cache æœªå‘½ä¸­æ—¶æ£€æŸ¥',
    quota: 'âŒ ä¸è®¡å…¥ Storage API é…é¢'
  }
};
```

---

## 2ï¸âƒ£ Service Worker ç¼“å­˜ï¼ˆCache Storageï¼‰

### ä»€ä¹ˆæ˜¯ Cache Storageï¼Ÿ

Cache Storage æ˜¯**å¼€å‘è€…é€šè¿‡ä»£ç ä¸»åŠ¨æ§åˆ¶**çš„ç¼“å­˜ï¼Œä½¿ç”¨ Cache APIã€‚

```javascript
/**
 * Service Worker ç¼“å­˜ç¤ºä¾‹
 */
self.addEventListener('fetch', (event) => {
  event.respondWith(
    caches.open('my-cache').then(cache => {
      return cache.match(event.request).then(response => {
        return response || fetch(event.request);
      });
    })
  );
});
```

### Cache Storage çš„å­˜å‚¨ä½ç½®

```javascript
const cacheStorageLocation = {
  location: 'ç‹¬ç«‹çš„å­˜å‚¨ç©ºé—´ï¼ˆä¸æ˜¯ HTTP Cacheï¼‰',
  path: {
    chrome: '~/Library/Application Support/Google/Chrome/Default/Service Worker/CacheStorage/',
    windows: 'C:\\Users\\<username>\\AppData\\Local\\Google\\Chrome\\User Data\\Default\\Service Worker\\CacheStorage'
  },
  size: 'å–å†³äºé…é¢ï¼ˆé€šå¸¸å‡  GBï¼‰',
  management: 'å¼€å‘è€…é€šè¿‡ Cache API æ§åˆ¶',
  quota: 'âœ… è®¡å…¥ Storage API é…é¢ï¼ˆä¸ IndexedDB å…±äº«ï¼‰'
};
```

---

## ğŸ” é…é¢è®¡ç®—è¯¦è§£

### æŸ¥è¯¢å­˜å‚¨é…é¢

```javascript
async function checkStorageQuota() {
  const estimate = await navigator.storage.estimate();
  
  console.log('=== å­˜å‚¨é…é¢ä¿¡æ¯ ===');
  console.log('æ€»é…é¢:', (estimate.quota / 1024 / 1024 / 1024).toFixed(2), 'GB');
  console.log('å·²ä½¿ç”¨:', (estimate.usage / 1024 / 1024).toFixed(2), 'MB');
  console.log('ä½¿ç”¨ç‡:', (estimate.usage / estimate.quota * 100).toFixed(2), '%');
  
  // è¯¦ç»†åˆ†ç±»ï¼ˆChrome æ”¯æŒï¼‰
  if (estimate.usageDetails) {
    console.log('\n=== è¯¦ç»†ä½¿ç”¨æƒ…å†µ ===');
    for (const [type, bytes] of Object.entries(estimate.usageDetails)) {
      console.log(type + ':', (bytes / 1024 / 1024).toFixed(2), 'MB');
    }
  }
  
  return estimate;
}

// è¿è¡Œ
await checkStorageQuota();

/**
 * å…¸å‹è¾“å‡ºï¼š
 * 
 * === å­˜å‚¨é…é¢ä¿¡æ¯ ===
 * æ€»é…é¢: 12.00 GB          â† æµè§ˆå™¨åˆ†é…ç»™æ‰€æœ‰ç½‘ç«™çš„æ€»é…é¢
 * å·²ä½¿ç”¨: 45.23 MB
 * ä½¿ç”¨ç‡: 0.37 %
 * 
 * === è¯¦ç»†ä½¿ç”¨æƒ…å†µ ===
 * caches: 30.50 MB        â† Service Worker ç¼“å­˜ï¼ˆè®¡å…¥é…é¢ï¼‰
 * indexedDB: 14.73 MB     â† IndexedDBï¼ˆè®¡å…¥é…é¢ï¼‰
 * 
 * æ³¨æ„ï¼šHTTP ç¼“å­˜ï¼ˆå¼ºç¼“å­˜/åå•†ç¼“å­˜ï¼‰ä¸åœ¨è¿™é‡Œæ˜¾ç¤ºï¼
 */
```

### ä»€ä¹ˆè®¡å…¥é…é¢ï¼Œä»€ä¹ˆä¸è®¡å…¥ï¼Ÿ

```javascript
const quotaBreakdown = {
  // âœ… è®¡å…¥ Storage API é…é¢
  counted: {
    cacheStorage: 'Service Worker ä½¿ç”¨çš„ Cache API',
    indexedDB: 'IndexedDB æ•°æ®åº“',
    localStorage: 'LocalStorageï¼ˆä½†å¾ˆå°ï¼Œçº¦ 10MBï¼‰',
    sessionStorage: 'SessionStorageï¼ˆä½†å¾ˆå°ï¼‰',
    fileSystem: 'File System APIï¼ˆå¦‚æœä½¿ç”¨ï¼‰'
  },
  
  // âŒ ä¸è®¡å…¥ Storage API é…é¢
  notCounted: {
    httpCache: 'HTTP ç¼“å­˜ï¼ˆå¼ºç¼“å­˜ã€åå•†ç¼“å­˜ï¼‰',
    memoryCache: 'å†…å­˜ç¼“å­˜',
    diskCache: 'ç£ç›˜ç¼“å­˜ï¼ˆæµè§ˆå™¨è‡ªåŠ¨ç®¡ç†çš„ï¼‰',
    cookies: 'Cookieï¼ˆå¾ˆå°ï¼Œçº¦ 4KBï¼‰'
  }
};
```

---

## ğŸ”„ ç¼“å­˜ä¹‹é—´çš„å…³ç³»

### ç¼“å­˜æŸ¥æ‰¾é¡ºåº

```javascript
/**
 * æµè§ˆå™¨è¯·æ±‚èµ„æºæ—¶çš„ç¼“å­˜æŸ¥æ‰¾é¡ºåº
 */
const cacheCheckOrder = {
  step1: {
    name: 'Service Worker ç¼“å­˜',
    check: 'caches.match(request)',
    hit: 'è¿”å›ç¼“å­˜ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰',
    miss: 'ç»§ç»­ä¸‹ä¸€æ­¥'
  },
  
  step2: {
    name: 'Memory Cache',
    check: 'æ£€æŸ¥å†…å­˜ä¸­çš„ç¼“å­˜',
    hit: 'è¿”å›ç¼“å­˜ï¼ˆæå¿«ï¼Œ<1msï¼‰',
    miss: 'ç»§ç»­ä¸‹ä¸€æ­¥'
  },
  
  step3: {
    name: 'Disk Cacheï¼ˆå¼ºç¼“å­˜ï¼‰',
    check: 'æ£€æŸ¥ Cache-Controlã€Expires',
    hit: 'è¿”å›ç¼“å­˜ï¼ˆfrom disk cacheï¼‰',
    miss: 'ç»§ç»­ä¸‹ä¸€æ­¥'
  },
  
  step4: {
    name: 'åå•†ç¼“å­˜',
    check: 'å‘é€è¯·æ±‚ï¼Œæºå¸¦ ETag / Last-Modified',
    hit: 'æœåŠ¡å™¨è¿”å› 304ï¼Œä½¿ç”¨æœ¬åœ°ç¼“å­˜',
    miss: 'æœåŠ¡å™¨è¿”å› 200ï¼Œä¸‹è½½æ–°èµ„æº'
  },
  
  step5: {
    name: 'ç½‘ç»œè¯·æ±‚',
    action: 'ä»æœåŠ¡å™¨ä¸‹è½½èµ„æº'
  }
};
```

### å¯è§†åŒ–æµç¨‹

```
ç”¨æˆ·è¯·æ±‚ /app.js
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Service Worker æ‹¦æˆª  â”‚
â”‚    caches.match()       â”‚ â† è®¡å…¥é…é¢
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ å‘½ä¸­ï¼Ÿ
     â”œâ”€ æ˜¯ â†’ è¿”å›ï¼ˆç»“æŸï¼‰
     â””â”€ å¦ â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Memory Cache         â”‚
â”‚    æµè§ˆå™¨è‡ªåŠ¨æ£€æŸ¥        â”‚ â† ä¸è®¡å…¥é…é¢
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ å‘½ä¸­ï¼Ÿ
     â”œâ”€ æ˜¯ â†’ è¿”å›ï¼ˆç»“æŸï¼‰
     â””â”€ å¦ â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Disk Cache (å¼ºç¼“å­˜)  â”‚
â”‚    æ£€æŸ¥ Cache-Control    â”‚ â† ä¸è®¡å…¥é…é¢
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ æœªè¿‡æœŸï¼Ÿ
     â”œâ”€ æ˜¯ â†’ è¿”å›ï¼ˆç»“æŸï¼‰
     â””â”€ å¦ â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. åå•†ç¼“å­˜             â”‚
â”‚    å‘è¯·æ±‚ (If-None-Match)â”‚ â† ä¸è®¡å…¥é…é¢
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 304ï¼Ÿ
     â”œâ”€ æ˜¯ â†’ ä½¿ç”¨ç¼“å­˜ï¼ˆç»“æŸï¼‰
     â””â”€ å¦ â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. ç½‘ç»œè¯·æ±‚             â”‚
â”‚    ä¸‹è½½æ–°èµ„æº            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—‚ï¸ è¯¦ç»†å¯¹æ¯”

### 1. HTTP å¼ºç¼“å­˜ï¼ˆä¸è®¡å…¥é…é¢ï¼‰

```javascript
/**
 * HTTP å¼ºç¼“å­˜ç‰¹ç‚¹
 */
const strongCache = {
  // æ§åˆ¶æ–¹å¼ï¼šHTTP å“åº”å¤´
  control: {
    'Cache-Control': 'max-age=31536000, public',
    'Expires': 'Wed, 21 Oct 2025 07:28:00 GMT'
  },
  
  // å­˜å‚¨ä½ç½®
  storage: {
    memoryCache: 'å†…å­˜ï¼ˆå…³é—­æ ‡ç­¾é¡µå³æ¸…é™¤ï¼‰',
    diskCache: 'ç£ç›˜ï¼ˆæµè§ˆå™¨ç¼“å­˜ç›®å½•ï¼‰'
  },
  
  // å¤§å°é™åˆ¶
  size: {
    typical: '300-500 MB',
    management: 'æµè§ˆå™¨è‡ªåŠ¨ç®¡ç†ï¼ˆLRU ç®—æ³•ï¼‰',
    note: 'ç”¨æˆ·æ¸…ç†"æµè§ˆå™¨ç¼“å­˜"æ—¶ä¼šè¢«æ¸…é™¤'
  },
  
  // é…é¢è®¡ç®—
  quota: 'âŒ ä¸è®¡å…¥ Storage API çš„é…é¢',
  
  // ä¼˜ç¼ºç‚¹
  pros: [
    'å®Œå…¨è‡ªåŠ¨ï¼Œæ— éœ€ä»£ç ',
    'ä¸å ç”¨é…é¢',
    'é€Ÿåº¦å¿«'
  ],
  cons: [
    'æ— æ³•ç²¾ç¡®æ§åˆ¶',
    'ç”¨æˆ·æ¸…ç†ç¼“å­˜ä¼šä¸¢å¤±',
    'ç¦»çº¿ä¸å¯ç”¨ï¼ˆæ—  Service Workerï¼‰'
  ]
};
```

**å®é™…ä¾‹å­**ï¼š

```javascript
// æœåŠ¡å™¨ç«¯è®¾ç½®å¼ºç¼“å­˜
app.get('/app.js', (req, res) => {
  res.setHeader('Cache-Control', 'max-age=31536000'); // 1å¹´
  res.sendFile('app.js');
});

// æµè§ˆå™¨è¡Œä¸ºï¼š
// ç¬¬1æ¬¡è¯·æ±‚: 200 OK (from server) - ä¸‹è½½æ–‡ä»¶ï¼Œç¼“å­˜åˆ° Disk Cache
// ç¬¬2æ¬¡è¯·æ±‚: 200 OK (from disk cache) - ç›´æ¥è¯»ç¼“å­˜ï¼Œä¸å‘ç½‘ç»œè¯·æ±‚
// 
// âŒ è¿™ä¸ªç¼“å­˜ä¸è®¡å…¥ Storage API é…é¢
// âŒ å¼€å‘è€…æ— æ³•é€šè¿‡ Cache API è®¿é—®
```

### 2. HTTP åå•†ç¼“å­˜ï¼ˆä¸è®¡å…¥é…é¢ï¼‰

```javascript
/**
 * åå•†ç¼“å­˜ç‰¹ç‚¹
 */
const negotiationCache = {
  // æ§åˆ¶æ–¹å¼ï¼šHTTP å“åº”å¤´
  control: {
    response: {
      'ETag': '"abc123"',
      'Last-Modified': 'Mon, 01 Nov 2025 10:00:00 GMT'
    },
    request: {
      'If-None-Match': '"abc123"',
      'If-Modified-Since': 'Mon, 01 Nov 2025 10:00:00 GMT'
    }
  },
  
  // å­˜å‚¨ä½ç½®
  storage: 'Disk Cacheï¼ˆä¸å¼ºç¼“å­˜å…±äº«ï¼‰',
  
  // é…é¢è®¡ç®—
  quota: 'âŒ ä¸è®¡å…¥ Storage API çš„é…é¢',
  
  // ç‰¹ç‚¹
  features: {
    validation: 'æ¯æ¬¡éƒ½å‘è¯·æ±‚éªŒè¯',
    bandwidth: 'å¦‚æœæœªæ”¹å˜ï¼Œåªè¿”å› 304ï¼ˆèŠ‚çœå¸¦å®½ï¼‰',
    offline: 'âŒ ç¦»çº¿ä¸å¯ç”¨ï¼ˆéœ€è¦ç½‘ç»œéªŒè¯ï¼‰'
  }
};
```

**å®é™…ä¾‹å­**ï¼š

```javascript
// æœåŠ¡å™¨ç«¯
app.get('/api/data', (req, res) => {
  const etag = '"v1.0.0"';
  
  // æ£€æŸ¥å®¢æˆ·ç«¯ ETag
  if (req.headers['if-none-match'] === etag) {
    return res.status(304).end(); // æœªæ”¹å˜ï¼Œè¿”å› 304
  }
  
  // æ”¹å˜äº†ï¼Œè¿”å›æ–°æ•°æ®
  res.setHeader('ETag', etag);
  res.setHeader('Cache-Control', 'no-cache'); // å…è®¸ç¼“å­˜ï¼Œä½†éœ€éªŒè¯
  res.json({ data: 'content' });
});

// æµè§ˆå™¨è¡Œä¸ºï¼š
// ç¬¬1æ¬¡: 200 OK - ä¸‹è½½ + ç¼“å­˜
// ç¬¬2æ¬¡: å‘è¯·æ±‚éªŒè¯ â†’ 304 Not Modified â†’ ä½¿ç”¨ç¼“å­˜
// 
// âŒ ä»ç„¶ä¸è®¡å…¥ Storage API é…é¢
```

### 3. Service Worker ç¼“å­˜ï¼ˆè®¡å…¥é…é¢ï¼‰

```javascript
/**
 * Service Worker ç¼“å­˜ç‰¹ç‚¹
 */
const serviceWorkerCache = {
  // æ§åˆ¶æ–¹å¼ï¼šJavaScript ä»£ç 
  control: 'Cache API (caches.open, cache.put)',
  
  // å­˜å‚¨ä½ç½®
  storage: 'Cache Storageï¼ˆç‹¬ç«‹å­˜å‚¨ç©ºé—´ï¼‰',
  
  // é…é¢è®¡ç®—
  quota: 'âœ… è®¡å…¥ Storage API çš„é…é¢',
  
  // ç‰¹ç‚¹
  features: {
    programmatic: 'å®Œå…¨é€šè¿‡ä»£ç æ§åˆ¶',
    offline: 'âœ… æ”¯æŒç¦»çº¿è®¿é—®',
    precision: 'ç²¾ç¡®æ§åˆ¶ç¼“å­˜å†…å®¹å’Œç­–ç•¥',
    persistence: 'ç”¨æˆ·æ¸…ç†"æµè§ˆå™¨ç¼“å­˜"æ—¶ä¸ä¼šè¢«æ¸…é™¤ï¼ˆé™¤éä¸“é—¨æ¸…ç†ï¼‰'
  },
  
  // ä¸å…¶ä»–å­˜å‚¨å…±äº«é…é¢
  sharedWith: ['IndexedDB', 'LocalStorage']
};
```

**å®é™…ä¾‹å­**ï¼š

```javascript
// Service Worker ä¸­
self.addEventListener('install', (event) => {
  event.waitUntil(
    caches.open('app-cache-v1').then(cache => {
      return cache.addAll([
        '/',
        '/app.js',
        '/styles.css'
      ]);
    })
  );
});

// è¿™äº›ç¼“å­˜ï¼š
// âœ… è®¡å…¥ Storage API é…é¢
// âœ… å¯ä»¥é€šè¿‡ navigator.storage.estimate() æŸ¥çœ‹
// âœ… å¯ä»¥ç²¾ç¡®æ§åˆ¶
// âœ… æ”¯æŒç¦»çº¿è®¿é—®
```

---

## ğŸ“ å®é™…æµ‹è¯•å¯¹æ¯”

### æµ‹è¯•ä»£ç 

```javascript
/**
 * æµ‹è¯•ï¼šç¼“å­˜åŒä¸€æ–‡ä»¶ä¸¤æ¬¡ï¼Œé…é¢å¦‚ä½•å˜åŒ–ï¼Ÿ
 */
async function testCacheQuota() {
  // æŸ¥è¯¢åˆå§‹é…é¢
  const before = await navigator.storage.estimate();
  console.log('åˆå§‹ä½¿ç”¨:', (before.usage / 1024 / 1024).toFixed(2), 'MB');
  
  // åœºæ™¯1ï¼šé€šè¿‡ Service Worker ç¼“å­˜
  const cache = await caches.open('test-cache');
  const response = await fetch('/large-file.js'); // å‡è®¾ 5MB
  await cache.put('/large-file.js', response);
  
  const after1 = await navigator.storage.estimate();
  const increase1 = after1.usage - before.usage;
  console.log('Service Worker ç¼“å­˜å:', (after1.usage / 1024 / 1024).toFixed(2), 'MB');
  console.log('å¢åŠ äº†:', (increase1 / 1024 / 1024).toFixed(2), 'MB'); // âœ… çº¦ 5MB
  
  // åœºæ™¯2ï¼šå†æ¬¡é€šè¿‡æµè§ˆå™¨ HTTP ç¼“å­˜è¯·æ±‚åŒä¸€æ–‡ä»¶
  const response2 = await fetch('/large-file.js');
  // æµè§ˆå™¨ä¼šç¼“å­˜åˆ° Disk Cache
  
  const after2 = await navigator.storage.estimate();
  const increase2 = after2.usage - after1.usage;
  console.log('HTTP ç¼“å­˜å:', (after2.usage / 1024 / 1024).toFixed(2), 'MB');
  console.log('å¢åŠ äº†:', (increase2 / 1024 / 1024).toFixed(2), 'MB'); // âŒ çº¦ 0MBï¼ˆä¸è®¡å…¥ï¼‰
  
  return {
    serviceWorkerCacheCounted: increase1 > 0, // true
    httpCacheCounted: increase2 > 0           // false
  };
}

/**
 * ç»“æœï¼š
 * 
 * Service Worker ç¼“å­˜: âœ… é…é¢ +5MB
 * HTTP ç¼“å­˜:           âŒ é…é¢ +0MB
 * 
 * ç»“è®ºï¼šä¸¤è€…åˆ†å¼€è®¡ç®—ï¼
 */
```

---

## ğŸ’¡ å®é™…åº”ç”¨å»ºè®®

### åˆç†ä½¿ç”¨ç¼“å­˜

```javascript
/**
 * æœ€ä½³å®è·µï¼šæ··åˆä½¿ç”¨
 */
const bestPractice = {
  // 1. é•¿æœŸä¸å˜çš„èµ„æº â†’ HTTP å¼ºç¼“å­˜
  staticAssets: {
    strategy: 'HTTP Cache-Control',
    example: 'Cache-Control: max-age=31536000',
    resources: ['vendor.js', 'logo.png', 'fonts/'],
    benefit: 'ä¸å ç”¨é…é¢ï¼Œè‡ªåŠ¨ç®¡ç†'
  },
  
  // 2. éœ€è¦ç¦»çº¿è®¿é—®çš„èµ„æº â†’ Service Worker
  offlineResources: {
    strategy: 'Cache API',
    example: 'caches.open().then(cache => cache.add())',
    resources: ['index.html', 'app.js', 'offline.html'],
    benefit: 'æ”¯æŒç¦»çº¿ï¼Œç²¾ç¡®æ§åˆ¶'
  },
  
  // 3. API æ•°æ® â†’ æ ¹æ®éœ€æ±‚
  apiData: {
    shortLived: 'HTTP åå•†ç¼“å­˜ï¼ˆno-cache + ETagï¼‰',
    offline: 'Service Worker + IndexedDB',
    realtime: 'ä¸ç¼“å­˜ï¼ˆNetwork Onlyï¼‰'
  }
};
```

### é¿å…é‡å¤ç¼“å­˜

```javascript
/**
 * âš ï¸ é¿å…åŒä¸€èµ„æºè¢«ç¼“å­˜ä¸¤æ¬¡
 */

// âŒ ä¸å¥½çš„åšæ³•
// 1. æœåŠ¡å™¨è®¾ç½®äº†å¼ºç¼“å­˜
res.setHeader('Cache-Control', 'max-age=3600');

// 2. Service Worker åˆç¼“å­˜äº†åŒä¸€èµ„æº
cache.put('/app.js', response);

// ç»“æœï¼šåŒä¸€æ–‡ä»¶è¢«ç¼“å­˜ä¸¤æ¬¡ï¼
// - HTTP Cache: çº¦ 1MBï¼ˆä¸è®¡å…¥é…é¢ï¼‰
// - Cache Storage: çº¦ 1MBï¼ˆè®¡å…¥é…é¢ï¼‰
// 
// æµªè´¹ï¼


// âœ… å¥½çš„åšæ³•ï¼šåˆ†å·¥æ˜ç¡®

// æ–¹æ¡ˆAï¼šä½¿ç”¨ Service Workerï¼ŒæœåŠ¡å™¨ä¸è®¾ç½®å¼ºç¼“å­˜
res.setHeader('Cache-Control', 'no-cache'); // ä¸ä½¿ç”¨ HTTP ç¼“å­˜
// Service Worker è´Ÿè´£ç¼“å­˜

// æ–¹æ¡ˆBï¼šä½¿ç”¨ HTTP ç¼“å­˜ï¼ŒService Worker åªåšè·¯ç”±
if (request.url.includes('/static/')) {
  // é™æ€èµ„æºï¼šè®©æµè§ˆå™¨è‡ªç„¶ç¼“å­˜ï¼ˆHTTP Cacheï¼‰
  return fetch(request);
} else {
  // åŠ¨æ€èµ„æºï¼šä½¿ç”¨ Service Worker ç¼“å­˜
  return caches.match(request) || fetch(request);
}
```

---

## ğŸ¯ 30GB çš„è¯¯è§£

### ä¸ºä»€ä¹ˆä¼šæœ‰ 30GB çš„è¯´æ³•ï¼Ÿ

```javascript
/**
 * å¯èƒ½çš„è¯¯è§£æ¥æº
 */
const misconceptions = {
  misunderstanding1: {
    wrong: 'Service Worker å¯ä»¥ç¼“å­˜ 30GB',
    reality: 'ç†è®ºä¸Šé…é¢å¯èƒ½è¾¾åˆ°å‡ å GBï¼ˆå–å†³äºç£ç›˜ç©ºé—´ï¼‰',
    but: 'å•ä¸ªç½‘ç«™é€šå¸¸é™åˆ¶åœ¨ æ€»é…é¢çš„ 10-20%ï¼ˆçº¦ 2-5GBï¼‰',
    conclusion: 'å®é™…å¾ˆéš¾è¾¾åˆ° 30GB'
  },
  
  misunderstanding2: {
    wrong: 'HTTP ç¼“å­˜ + Service Worker ç¼“å­˜ = 30GB',
    reality: 'å®ƒä»¬æ˜¯åˆ†å¼€ç®¡ç†çš„',
    http_cache: '~300-500MBï¼ˆæµè§ˆå™¨è‡ªåŠ¨ç®¡ç†ï¼‰',
    sw_cache: 'å–å†³äºé…é¢ï¼ˆ2-5GBï¼‰',
    total: 'ä¸æ˜¯ç®€å•ç›¸åŠ '
  }
};
```

### å®é™…é™åˆ¶

```javascript
async function getRealLimits() {
  const estimate = await navigator.storage.estimate();
  
  const limits = {
    // æ€»é…é¢ï¼ˆæ‰€æœ‰ç½‘ç«™å…±äº«ï¼‰
    totalQuota: (estimate.quota / 1024 / 1024 / 1024).toFixed(2) + ' GB',
    
    // å½“å‰ç½‘ç«™å¯èƒ½çš„æœ€å¤§ä½¿ç”¨
    // Chrome: çº¦æ€»é…é¢çš„ 10-20%
    siteMax: ((estimate.quota * 0.15) / 1024 / 1024 / 1024).toFixed(2) + ' GB',
    
    // HTTP ç¼“å­˜ï¼ˆç‹¬ç«‹ï¼‰
    httpCache: 'çº¦ 300-500 MBï¼ˆæµè§ˆå™¨è‡ªåŠ¨ç®¡ç†ï¼‰',
    
    // å®é™…å»ºè®®
    recommended: '50-500 MBï¼ˆService Worker + IndexedDBï¼‰'
  };
  
  console.log('=== å®é™…é™åˆ¶ ===');
  console.table(limits);
  
  return limits;
}

await getRealLimits();

/**
 * å…¸å‹è¾“å‡ºï¼ˆå¯ç”¨ç£ç›˜ 200GB çš„æƒ…å†µï¼‰ï¼š
 * 
 * æ€»é…é¢:      120.00 GB  (æ‰€æœ‰ç½‘ç«™å…±äº«)
 * å•ç«™æœ€å¤§:     18.00 GB  (ç†è®ºæœ€å¤§å€¼)
 * HTTPç¼“å­˜:      0.30 GB  (ç‹¬ç«‹ç®¡ç†)
 * å»ºè®®ä½¿ç”¨:      0.20 GB  (200MBï¼Œåˆç†èŒƒå›´)
 */
```

---

## ğŸ”§ é…é¢ç®¡ç†æœ€ä½³å®è·µ

### 1. ç›‘æ§é…é¢ä½¿ç”¨

```javascript
/**
 * å®šæœŸç›‘æ§é…é¢
 */
class QuotaMonitor {
  async monitor() {
    const estimate = await navigator.storage.estimate();
    const usagePercent = (estimate.usage / estimate.quota * 100).toFixed(2);
    
    console.log('ğŸ“Š é…é¢ç›‘æ§:');
    console.log('Service Worker + IndexedDB:', 
      (estimate.usage / 1024 / 1024).toFixed(2), 'MB'
    );
    console.log('ä½¿ç”¨ç‡:', usagePercent, '%');
    
    // åˆ†ç±»ç»Ÿè®¡
    if (estimate.usageDetails) {
      console.log('\nè¯¦ç»†:');
      console.log('  Cache Storage:', 
        (estimate.usageDetails.caches / 1024 / 1024).toFixed(2), 'MB'
      );
      console.log('  IndexedDB:', 
        (estimate.usageDetails.indexedDB / 1024 / 1024).toFixed(2), 'MB'
      );
    }
    
    // å‘Šè­¦
    if (usagePercent > 80) {
      console.warn('âš ï¸ é…é¢ä½¿ç”¨è¶…è¿‡ 80%ï¼Œå»ºè®®æ¸…ç†');
      await this.cleanup();
    }
  }
  
  async cleanup() {
    // æ¸…ç† Service Worker ç¼“å­˜
    const cacheNames = await caches.keys();
    for (const name of cacheNames) {
      if (name.includes('-old-')) {
        await caches.delete(name);
      }
    }
    
    console.log('âœ… æ¸…ç†å®Œæˆ');
  }
}

// æ¯10åˆ†é’Ÿç›‘æ§ä¸€æ¬¡
const monitor = new QuotaMonitor();
setInterval(() => monitor.monitor(), 10 * 60 * 1000);
```

### 2. ä¼˜å…ˆçº§ç¼“å­˜

```javascript
/**
 * åªç¼“å­˜é‡è¦èµ„æº
 */
const cachePriority = {
  // æ ¸å¿ƒèµ„æºï¼ˆå¿…é¡»ç¼“å­˜ï¼‰
  critical: [
    '/',
    '/index.html',
    '/app.js',
    '/styles.css',
    '/offline.html'
  ],
  
  // é‡è¦èµ„æºï¼ˆå°½é‡ç¼“å­˜ï¼‰
  important: [
    '/logo.png',
    '/fonts/main.woff2'
  ],
  
  // å¯é€‰èµ„æºï¼ˆç©ºé—´å……è¶³æ—¶ç¼“å­˜ï¼‰
  optional: [
    '/images/',
    '/api/cache'
  ],
  
  // ä¸ç¼“å­˜
  neverCache: [
    '/api/realtime',
    '/videos/',
    '/downloads/'
  ]
};
```

---

## ğŸ“‹ æ€»ç»“

### é…é¢è®¡ç®—æ€»ç»“è¡¨

| ç¼“å­˜ç±»å‹ | å­˜å‚¨ä½ç½® | å¤§å° | è®¡å…¥é…é¢ï¼Ÿ | ç®¡ç†æ–¹å¼ |
|---------|---------|------|-----------|---------|
| **Memory Cache** | å†…å­˜ | ~50-200MB | âŒ å¦ | æµè§ˆå™¨è‡ªåŠ¨ |
| **Disk Cacheï¼ˆå¼ºç¼“å­˜ï¼‰** | ç£ç›˜ | ~300-500MB | âŒ å¦ | æµè§ˆå™¨è‡ªåŠ¨ |
| **åå•†ç¼“å­˜** | ç£ç›˜ | åŒä¸Š | âŒ å¦ | æµè§ˆå™¨è‡ªåŠ¨ |
| **Cache Storage (SW)** | ç‹¬ç«‹ç©ºé—´ | å–å†³äºé…é¢ | âœ… æ˜¯ | å¼€å‘è€…æ§åˆ¶ |
| **IndexedDB** | ç‹¬ç«‹ç©ºé—´ | å–å†³äºé…é¢ | âœ… æ˜¯ | å¼€å‘è€…æ§åˆ¶ |
| **LocalStorage** | ç‹¬ç«‹ç©ºé—´ | ~10MB | âœ… æ˜¯ | å¼€å‘è€…æ§åˆ¶ |

### å…³é”®ç‚¹

1. **HTTP ç¼“å­˜ï¼ˆå¼ºç¼“å­˜ã€åå•†ç¼“å­˜ï¼‰**
   - âŒ ä¸è®¡å…¥ Storage API é…é¢
   - æµè§ˆå™¨è‡ªåŠ¨ç®¡ç†
   - çº¦ 300-500MB
   - ç”¨æˆ·æ¸…ç†"æµè§ˆå™¨ç¼“å­˜"æ—¶ä¼šè¢«æ¸…é™¤

2. **Service Worker ç¼“å­˜ï¼ˆCache Storageï¼‰**
   - âœ… è®¡å…¥ Storage API é…é¢
   - å¼€å‘è€…é€šè¿‡ä»£ç æ§åˆ¶
   - ä¸ IndexedDB å…±äº«é…é¢
   - ç”¨æˆ·éœ€è¦ä¸“é—¨æ¸…ç†"ç½‘ç«™æ•°æ®"æ‰ä¼šè¢«æ¸…é™¤

3. **å®ƒä»¬æ˜¯åˆ†å¼€çš„**
   - å¯ä»¥åŒæ—¶å­˜åœ¨
   - é…é¢ç‹¬ç«‹è®¡ç®—
   - æŸ¥æ‰¾é¡ºåºï¼šService Worker â†’ HTTP Cache â†’ ç½‘ç»œ

### æœ€ä½³å®è·µ

- âœ… åˆç†è®¾ç½® HTTP ç¼“å­˜ï¼ˆå‡è½» Service Worker å‹åŠ›ï¼‰
- âœ… Service Worker åªç¼“å­˜æ ¸å¿ƒèµ„æºï¼ˆ< 500MBï¼‰
- âœ… å®ç°é…é¢ç›‘æ§å’Œè‡ªåŠ¨æ¸…ç†
- âœ… æä¾›é™çº§æ–¹æ¡ˆ

**ç»“è®º**ï¼šä¸è¦æ‹…å¿ƒ 30GB çš„é—®é¢˜ï¼Œå®é™…ä¸Šæµè§ˆå™¨ä¸ä¼šè®©ä½ ç¼“å­˜é‚£ä¹ˆå¤šï¼Œè€Œä¸” HTTP ç¼“å­˜å’Œ Service Worker ç¼“å­˜æ˜¯åˆ†å¼€ç®¡ç†çš„ï¼ğŸ¯

