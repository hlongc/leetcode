<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>åŠ å¯†ä¼ è¾“æ”¹é€  - å®Œæ•´ç¤ºä¾‹</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 { color: #333; margin-bottom: 20px; }
    h2 { color: #666; margin: 30px 0 15px; font-size: 18px; }
    .section {
      margin-bottom: 30px;
      padding: 20px;
      background: #f9f9f9;
      border-radius: 4px;
    }
    .status {
      padding: 10px;
      margin: 10px 0;
      border-radius: 4px;
      font-family: monospace;
      font-size: 12px;
    }
    .success { background: #d4edda; color: #155724; }
    .error { background: #f8d7da; color: #721c24; }
    .info { background: #d1ecf1; color: #0c5460; }
    button {
      padding: 10px 20px;
      margin: 5px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }
    button:hover { background: #0056b3; }
    button:active { transform: scale(0.98); }
    input {
      padding: 8px;
      margin: 5px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
    }
    .log {
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 15px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      max-height: 300px;
      overflow-y: auto;
      margin-top: 10px;
    }
    .log-entry {
      margin: 5px 0;
      padding: 3px 0;
      border-bottom: 1px solid #333;
    }
    .highlight { color: #4EC9B0; }
    .warning { color: #CE9178; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ” ç½‘ç»œåŠ å¯†ä¼ è¾“æ”¹é€  - å®Œæ•´æ¼”ç¤º</h1>
    
    <div class="status info">
      <strong>âœ… åŠ å¯†æ‹¦æˆªå™¨å·²æ¿€æ´»</strong><br>
      æ‰€æœ‰å‘å¾€ /api/ çš„è¯·æ±‚éƒ½ä¼šè‡ªåŠ¨åŠ å¯†/è§£å¯†<br>
      ç¬¬ä¸‰æ–¹åº“ï¼ˆaxiosã€jQueryï¼‰æ— éœ€ä¿®æ”¹å³å¯ä½¿ç”¨
    </div>
    
    <!-- ========================================== -->
    <!-- æµ‹è¯•1ï¼šåŸç”Ÿ Fetch API -->
    <!-- ========================================== -->
    <div class="section">
      <h2>æµ‹è¯•1ï¼šåŸç”Ÿ Fetch API</h2>
      <button onclick="testFetch()">æµ‹è¯• Fetch åŠ å¯†</button>
      <div id="fetch-result"></div>
    </div>
    
    <!-- ========================================== -->
    <!-- æµ‹è¯•2ï¼šXMLHttpRequest -->
    <!-- ========================================== -->
    <div class="section">
      <h2>æµ‹è¯•2ï¼šåŸç”Ÿ XMLHttpRequest</h2>
      <button onclick="testXHR()">æµ‹è¯• XHR åŠ å¯†</button>
      <div id="xhr-result"></div>
    </div>
    
    <!-- ========================================== -->
    <!-- æµ‹è¯•3ï¼šAxiosï¼ˆç¬¬ä¸‰æ–¹åº“ï¼‰ -->
    <!-- ========================================== -->
    <div class="section">
      <h2>æµ‹è¯•3ï¼šAxiosï¼ˆç¬¬ä¸‰æ–¹åº“ - æ— éœ€ä¿®æ”¹ï¼‰</h2>
      <button onclick="testAxios()">æµ‹è¯• Axios åŠ å¯†</button>
      <div id="axios-result"></div>
    </div>
    
    <!-- ========================================== -->
    <!-- æµ‹è¯•4ï¼šjQueryï¼ˆç¬¬ä¸‰æ–¹åº“ï¼‰ -->
    <!-- ========================================== -->
    <div class="section">
      <h2>æµ‹è¯•4ï¼šjQueryï¼ˆç¬¬ä¸‰æ–¹åº“ - æ— éœ€ä¿®æ”¹ï¼‰</h2>
      <button onclick="testJQuery()">æµ‹è¯• jQuery åŠ å¯†</button>
      <div id="jquery-result"></div>
    </div>
    
    <!-- ========================================== -->
    <!-- æµ‹è¯•5ï¼šç™»å½•è¡¨å•ï¼ˆå®é™…åœºæ™¯ï¼‰ -->
    <!-- ========================================== -->
    <div class="section">
      <h2>æµ‹è¯•5ï¼šç™»å½•è¡¨å•ï¼ˆå®é™…ä¸šåŠ¡åœºæ™¯ï¼‰</h2>
      <input type="text" id="username" placeholder="ç”¨æˆ·å" value="admin">
      <input type="password" id="password" placeholder="å¯†ç " value="secret">
      <button onclick="login()">ç™»å½•ï¼ˆè‡ªåŠ¨åŠ å¯†ï¼‰</button>
      <div id="login-result"></div>
    </div>
    
    <!-- ========================================== -->
    <!-- æµ‹è¯•6ï¼šå¹¶å‘è¯·æ±‚ -->
    <!-- ========================================== -->
    <div class="section">
      <h2>æµ‹è¯•6ï¼šå¹¶å‘è¯·æ±‚ï¼ˆå‹åŠ›æµ‹è¯•ï¼‰</h2>
      <button onclick="testConcurrent()">å‘é€10ä¸ªå¹¶å‘è¯·æ±‚</button>
      <div id="concurrent-result"></div>
    </div>
    
    <!-- ========================================== -->
    <!-- æ—¥å¿—è¾“å‡º -->
    <!-- ========================================== -->
    <div class="section">
      <h2>ğŸ“‹ è¯·æ±‚æ—¥å¿—</h2>
      <button onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
      <div class="log" id="log-container"></div>
    </div>
  </div>
  
  <!-- 
    âš ï¸ å…³é”®ï¼šåŠ å¯†æ‹¦æˆªå™¨å¿…é¡»æœ€å…ˆåŠ è½½ï¼
    æ”¾åœ¨æ‰€æœ‰ç¬¬ä¸‰æ–¹åº“ä¹‹å‰
  -->
  <script src="crypto-interceptor.js" 
          data-key="your-secret-key-2024" 
          data-urls="/api/"
          data-debug="true"></script>
  
  <!-- ç¬¬ä¸‰æ–¹åº“ï¼ˆåœ¨æ‹¦æˆªå™¨ä¹‹ååŠ è½½ï¼‰ -->
  <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
  
  <!-- æµ‹è¯•è„šæœ¬ -->
  <script>
    // ============================================
    // æ—¥å¿—å·¥å…·
    // ============================================
    function addLog(message, type = 'info') {
      const logContainer = document.getElementById('log-container');
      const entry = document.createElement('div');
      entry.className = 'log-entry';
      
      const timestamp = new Date().toLocaleTimeString();
      const color = type === 'success' ? '#4EC9B0' : 
                    type === 'error' ? '#CE9178' : '#D4D4D4';
      
      entry.innerHTML = `<span style="color: #808080">[${timestamp}]</span> ` +
                       `<span style="color: ${color}">${message}</span>`;
      
      logContainer.insertBefore(entry, logContainer.firstChild);
      
      // é™åˆ¶æ—¥å¿—æ¡æ•°
      while (logContainer.children.length > 50) {
        logContainer.removeChild(logContainer.lastChild);
      }
    }
    
    function clearLog() {
      document.getElementById('log-container').innerHTML = '';
    }
    
    function showResult(elementId, message, isSuccess = true) {
      const el = document.getElementById(elementId);
      el.className = `status ${isSuccess ? 'success' : 'error'}`;
      el.innerHTML = message;
    }
    
    // ============================================
    // æµ‹è¯•1ï¼šåŸç”Ÿ Fetch
    // ============================================
    async function testFetch() {
      addLog('å¼€å§‹æµ‹è¯• Fetch API', 'info');
      
      try {
        const response = await fetch('/api/user/1', {
          method: 'POST',
          body: JSON.stringify({
            name: 'John Doe',
            email: 'john@example.com',
            sensitive: 'è¿™æ˜¯æ•æ„Ÿæ•°æ®'
          })
        });
        
        const data = await response.json();
        
        addLog('âœ… Fetch è¯·æ±‚æˆåŠŸï¼Œæ•°æ®å·²è‡ªåŠ¨è§£å¯†', 'success');
        showResult('fetch-result', 
          `<strong>æˆåŠŸï¼</strong><br>` +
          `å“åº”æ•°æ®ï¼š${JSON.stringify(data, null, 2)}`
        );
      } catch (error) {
        addLog('âŒ Fetch è¯·æ±‚å¤±è´¥: ' + error.message, 'error');
        showResult('fetch-result', `<strong>å¤±è´¥ï¼š</strong>${error.message}`, false);
      }
    }
    
    // ============================================
    // æµ‹è¯•2ï¼šXMLHttpRequest
    // ============================================
    function testXHR() {
      addLog('å¼€å§‹æµ‹è¯• XMLHttpRequest', 'info');
      
      const xhr = new XMLHttpRequest();
      
      xhr.open('POST', '/api/user/2');
      xhr.setRequestHeader('Content-Type', 'application/json');
      
      xhr.onload = function() {
        if (xhr.status === 200) {
          const data = JSON.parse(xhr.responseText);
          addLog('âœ… XHR è¯·æ±‚æˆåŠŸï¼Œæ•°æ®å·²è‡ªåŠ¨è§£å¯†', 'success');
          showResult('xhr-result', 
            `<strong>æˆåŠŸï¼</strong><br>` +
            `å“åº”æ•°æ®ï¼š${JSON.stringify(data, null, 2)}`
          );
        } else {
          addLog('âŒ XHR è¯·æ±‚å¤±è´¥: ' + xhr.status, 'error');
          showResult('xhr-result', `<strong>å¤±è´¥ï¼š</strong>HTTP ${xhr.status}`, false);
        }
      };
      
      xhr.onerror = function() {
        addLog('âŒ XHR ç½‘ç»œé”™è¯¯', 'error');
        showResult('xhr-result', '<strong>ç½‘ç»œé”™è¯¯</strong>', false);
      };
      
      xhr.send(JSON.stringify({
        name: 'Jane Doe',
        email: 'jane@example.com'
      }));
    }
    
    // ============================================
    // æµ‹è¯•3ï¼šAxiosï¼ˆç¬¬ä¸‰æ–¹åº“ï¼‰
    // ============================================
    async function testAxios() {
      addLog('å¼€å§‹æµ‹è¯• Axiosï¼ˆç¬¬ä¸‰æ–¹åº“ï¼‰', 'info');
      
      try {
        // å®Œå…¨ä¸éœ€è¦ä¿®æ”¹ axios çš„ä½¿ç”¨æ–¹å¼ï¼
        const response = await axios.post('/api/user/3', {
          name: 'Alice',
          email: 'alice@example.com',
          preferences: {
            theme: 'dark',
            language: 'zh-CN'
          }
        });
        
        addLog('âœ… Axios è¯·æ±‚æˆåŠŸï¼ˆç¬¬ä¸‰æ–¹åº“è‡ªåŠ¨åŠ å¯†ï¼‰', 'success');
        showResult('axios-result', 
          `<strong>æˆåŠŸï¼Axios æ— éœ€ä¿®æ”¹ï¼</strong><br>` +
          `å“åº”æ•°æ®ï¼š${JSON.stringify(response.data, null, 2)}`
        );
      } catch (error) {
        addLog('âŒ Axios è¯·æ±‚å¤±è´¥: ' + error.message, 'error');
        showResult('axios-result', `<strong>å¤±è´¥ï¼š</strong>${error.message}`, false);
      }
    }
    
    // ============================================
    // æµ‹è¯•4ï¼šjQueryï¼ˆç¬¬ä¸‰æ–¹åº“ï¼‰
    // ============================================
    function testJQuery() {
      addLog('å¼€å§‹æµ‹è¯• jQueryï¼ˆç¬¬ä¸‰æ–¹åº“ï¼‰', 'info');
      
      // å®Œå…¨ä¸éœ€è¦ä¿®æ”¹ jQuery çš„ä½¿ç”¨æ–¹å¼ï¼
      $.ajax({
        url: '/api/user/4',
        method: 'POST',
        contentType: 'application/json',
        data: JSON.stringify({
          name: 'Bob',
          email: 'bob@example.com'
        }),
        success: function(data) {
          addLog('âœ… jQuery è¯·æ±‚æˆåŠŸï¼ˆç¬¬ä¸‰æ–¹åº“è‡ªåŠ¨åŠ å¯†ï¼‰', 'success');
          showResult('jquery-result', 
            `<strong>æˆåŠŸï¼jQuery æ— éœ€ä¿®æ”¹ï¼</strong><br>` +
            `å“åº”æ•°æ®ï¼š${JSON.stringify(data, null, 2)}`
          );
        },
        error: function(xhr, status, error) {
          addLog('âŒ jQuery è¯·æ±‚å¤±è´¥: ' + error, 'error');
          showResult('jquery-result', `<strong>å¤±è´¥ï¼š</strong>${error}`, false);
        }
      });
    }
    
    // ============================================
    // æµ‹è¯•5ï¼šç™»å½•è¡¨å•
    // ============================================
    async function login() {
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;
      
      addLog(`å°è¯•ç™»å½•: ${username}`, 'info');
      
      try {
        // ä½¿ç”¨ fetchï¼Œå¯†ç ä¼šè‡ªåŠ¨åŠ å¯†
        const response = await fetch('/api/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username, password })
        });
        
        const result = await response.json();
        
        if (result.success) {
          addLog('âœ… ç™»å½•æˆåŠŸï¼ŒToken: ' + result.token, 'success');
          showResult('login-result', 
            `<strong>âœ… ç™»å½•æˆåŠŸï¼</strong><br>` +
            `ç”¨æˆ·ï¼š${result.user.username}<br>` +
            `Tokenï¼š${result.token}<br>` +
            `<em>å¯†ç åœ¨ä¼ è¾“ä¸­å·²åŠ å¯†ä¿æŠ¤</em>`
          );
        } else {
          addLog('âŒ ç™»å½•å¤±è´¥: ' + result.message, 'error');
          showResult('login-result', 
            `<strong>âŒ ç™»å½•å¤±è´¥</strong><br>${result.message}`,
            false
          );
        }
      } catch (error) {
        addLog('âŒ ç™»å½•è¯·æ±‚å¤±è´¥: ' + error.message, 'error');
        showResult('login-result', `<strong>é”™è¯¯ï¼š</strong>${error.message}`, false);
      }
    }
    
    // ============================================
    // æµ‹è¯•6ï¼šå¹¶å‘è¯·æ±‚
    // ============================================
    async function testConcurrent() {
      addLog('å¼€å§‹å¹¶å‘æµ‹è¯•ï¼ˆ10ä¸ªè¯·æ±‚ï¼‰', 'info');
      
      const promises = [];
      for (let i = 0; i < 10; i++) {
        promises.push(
          fetch('/api/user/' + i, {
            method: 'POST',
            body: JSON.stringify({ id: i, test: 'å¹¶å‘æµ‹è¯•' })
          })
          .then(res => res.json())
        );
      }
      
      try {
        const startTime = Date.now();
        const results = await Promise.all(promises);
        const elapsed = Date.now() - startTime;
        
        addLog(`âœ… å¹¶å‘æµ‹è¯•å®Œæˆï¼Œè€—æ—¶ ${elapsed}ms`, 'success');
        showResult('concurrent-result', 
          `<strong>âœ… å¹¶å‘æµ‹è¯•æˆåŠŸï¼</strong><br>` +
          `å®Œæˆ10ä¸ªåŠ å¯†è¯·æ±‚ï¼Œè€—æ—¶ï¼š${elapsed}ms<br>` +
          `å¹³å‡æ¯ä¸ªè¯·æ±‚ï¼š${(elapsed/10).toFixed(2)}ms`
        );
      } catch (error) {
        addLog('âŒ å¹¶å‘æµ‹è¯•å¤±è´¥: ' + error.message, 'error');
        showResult('concurrent-result', `<strong>å¤±è´¥ï¼š</strong>${error.message}`, false);
      }
    }
    
    // ============================================
    // é¡µé¢åŠ è½½å®Œæˆ
    // ============================================
    window.addEventListener('load', () => {
      addLog('é¡µé¢åŠ è½½å®Œæˆ', 'success');
      addLog('åŠ å¯†æ‹¦æˆªå™¨é…ç½®: ' + JSON.stringify(CryptoInterceptor.config), 'info');
      
      // æ£€æŸ¥ä¾èµ–
      if (typeof axios !== 'undefined') {
        addLog('âœ… Axios å·²åŠ è½½', 'success');
      }
      if (typeof jQuery !== 'undefined') {
        addLog('âœ… jQuery å·²åŠ è½½', 'success');
      }
    });
    
    // å…¨å±€é”™è¯¯æ•è·
    window.addEventListener('error', (e) => {
      addLog('âŒ é”™è¯¯: ' + e.message, 'error');
    });
  </script>
</body>
</html>

