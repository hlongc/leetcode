<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æµ‹è¯•é€šçŸ¥Actions</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
      }
      .container {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 15px;
        padding: 20px;
        margin: 10px 0;
        border: 1px solid rgba(255, 255, 255, 0.2);
      }
      button {
        background: linear-gradient(45deg, #ff6b6b, #ee5a24);
        color: white;
        border: none;
        padding: 12px 24px;
        margin: 8px;
        border-radius: 25px;
        cursor: pointer;
        font-weight: bold;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      }
      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
      }
      .status {
        margin: 10px 0;
        padding: 12px;
        border-radius: 8px;
        font-weight: 500;
      }
      .success {
        background: rgba(46, 204, 113, 0.2);
        color: #2ecc71;
      }
      .error {
        background: rgba(231, 76, 60, 0.2);
        color: #e74c3c;
      }
      .warning {
        background: rgba(241, 196, 15, 0.2);
        color: #f1c40f;
      }
      .info {
        background: rgba(52, 152, 219, 0.2);
        color: #3498db;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ğŸ§ª æµ‹è¯•é€šçŸ¥Actions</h1>
      <p>æµ‹è¯•æ¨é€é€šçŸ¥çš„actionsæŒ‰é’®æ˜¯å¦æ­£å¸¸å·¥ä½œ</p>
      <div class="status warning">
        <strong>âš ï¸ é‡è¦æç¤ºï¼š</strong>Actionsåªèƒ½åœ¨é€šè¿‡Service
        Workeræ˜¾ç¤ºçš„é€šçŸ¥ä¸­ä½¿ç”¨ï¼Œä¸èƒ½ç›´æ¥åœ¨<code>new Notification()</code
        >ä¸­ä½¿ç”¨ã€‚
      </div>
      <div class="status info">
        <strong>ğŸ’¡ å…³äºActionsé™åˆ¶ï¼š</strong>
        <ul style="margin: 8px 0; padding-left: 20px">
          <li>å¤§å¤šæ•°æµè§ˆå™¨æœ€å¤šæ”¯æŒ <strong>2ä¸ª</strong> actionæŒ‰é’®</li>
          <li>Chrome/Edge: æœ€å¤š2ä¸ªactions</li>
          <li>Firefox: æœ€å¤š2ä¸ªactions</li>
          <li>Safari: æœ€å¤š2ä¸ªactions</li>
          <li>actionå€¼å¯ä»¥è‡ªå®šä¹‰ï¼Œä¸æ˜¯å›ºå®šå€¼</li>
        </ul>
      </div>
    </div>

    <div class="container">
      <h2>ğŸ“‹ ç³»ç»Ÿä¿¡æ¯</h2>
      <div id="systemInfo">æ£€æµ‹ä¸­...</div>
    </div>

    <div class="container">
      <h2>ğŸ”” é€šçŸ¥æµ‹è¯•</h2>
      <button id="requestPermission">è¯·æ±‚é€šçŸ¥æƒé™</button>
      <button id="testBasicNotification">æµ‹è¯•åŸºç¡€é€šçŸ¥</button>
      <button id="testNotificationWithActions">æµ‹è¯•å¸¦Actionsçš„é€šçŸ¥</button>
      <button id="testTwoActions">æµ‹è¯•2ä¸ªActions</button>
      <button id="testOneAction">æµ‹è¯•1ä¸ªAction</button>
      <button id="testActionDetection">æµ‹è¯•Actionç‚¹å‡»æ£€æµ‹</button>
      <button id="testMultipleNotifications">æµ‹è¯•å¤šä¸ªé€šçŸ¥</button>
    </div>

    <div class="container">
      <h2>ğŸ“ æµ‹è¯•æ—¥å¿—</h2>
      <div id="log"></div>
    </div>

    <script>
      // æ£€æŸ¥é€šçŸ¥æ”¯æŒ
      function checkNotificationSupport() {
        const systemInfo = document.getElementById("systemInfo");

        if (!("Notification" in window)) {
          systemInfo.innerHTML = "âŒ æ­¤æµè§ˆå™¨ä¸æ”¯æŒé€šçŸ¥";
          return false;
        }

        systemInfo.innerHTML = `
                <p>âœ… æµè§ˆå™¨æ”¯æŒé€šçŸ¥</p>
                <p><strong>é€šçŸ¥æƒé™:</strong> ${Notification.permission}</p>
                <p><strong>ç”¨æˆ·ä»£ç†:</strong> ${navigator.userAgent}</p>
                <p><strong>Actionsæ”¯æŒ:</strong> ${
                  Notification.permission === "granted"
                    ? "éœ€è¦æµ‹è¯•"
                    : "éœ€è¦æƒé™"
                }</p>
            `;
        return true;
      }

      // è¯·æ±‚é€šçŸ¥æƒé™
      async function requestNotificationPermission() {
        try {
          const permission = await Notification.requestPermission();
          updateLog(
            `é€šçŸ¥æƒé™: ${permission}`,
            permission === "granted" ? "success" : "warning"
          );
          return permission === "granted";
        } catch (error) {
          updateLog("è¯·æ±‚é€šçŸ¥æƒé™å¤±è´¥: " + error.message, "error");
          return false;
        }
      }

      // æµ‹è¯•åŸºç¡€é€šçŸ¥
      function testBasicNotification() {
        if (Notification.permission !== "granted") {
          updateLog("è¯·å…ˆè¯·æ±‚é€šçŸ¥æƒé™", "warning");
          return;
        }

        const notification = new Notification("åŸºç¡€é€šçŸ¥æµ‹è¯•", {
          body: "è¿™æ˜¯ä¸€ä¸ªæ²¡æœ‰actionsçš„åŸºç¡€é€šçŸ¥",
          tag: "basic-test" + Math.random().toString(36).substr(2, 9),
        });

        notification.onclick = function () {
          updateLog("åŸºç¡€é€šçŸ¥è¢«ç‚¹å‡»", "info");
          notification.close();
        };

        updateLog("åŸºç¡€é€šçŸ¥å·²æ˜¾ç¤º", "success");
      }

      // æµ‹è¯•å¸¦Actionsçš„é€šçŸ¥
      async function testNotificationWithActions() {
        if (Notification.permission !== "granted") {
          updateLog("è¯·å…ˆè¯·æ±‚é€šçŸ¥æƒé™", "warning");
          return;
        }

        try {
          // æ£€æŸ¥Service Workeræ”¯æŒ
          if (!("serviceWorker" in navigator)) {
            updateLog(
              "âŒ æ­¤æµè§ˆå™¨ä¸æ”¯æŒService Workerï¼Œæ— æ³•æ˜¾ç¤ºå¸¦actionsçš„é€šçŸ¥",
              "error"
            );
            updateLog("ğŸ’¡ æç¤ºï¼šActionsåªèƒ½åœ¨Service Workeré€šçŸ¥ä¸­ä½¿ç”¨", "info");
            return;
          }

          // æ³¨å†ŒService Worker
          const registration = await navigator.serviceWorker.register(
            "sw-fixed.js"
          );
          updateLog("âœ… Service Workerå·²æ³¨å†Œ", "success");

          // ç­‰å¾…Service Workeræ¿€æ´»
          await navigator.serviceWorker.ready;
          updateLog("âœ… Service Workerå·²å‡†å¤‡å°±ç»ª", "success");

          // é€šè¿‡Service Workeræ˜¾ç¤ºå¸¦actionsçš„é€šçŸ¥
          const notificationOptions = {
            body: "è¿™æ˜¯ä¸€ä¸ªå¸¦æœ‰actionsæŒ‰é’®çš„é€šçŸ¥ï¼Œè¯·ç‚¹å‡»æŒ‰é’®æµ‹è¯•",
            tag: "actions-test" + Math.random().toString(36).substr(2, 9),
            requireInteraction: true,
            actions: [
              {
                action: "open",
                title: "æ‰“å¼€1",
              },
              {
                action: "close",
                title: "å…³é—­2",
              },
              {
                action: "reply",
                title: "å›å¤3",
              },
            ],
            data: {
              url: "/",
              timestamp: Date.now(),
            },
          };

          updateLog(
            `ğŸ“‹ é€šçŸ¥é…ç½®: ${JSON.stringify(notificationOptions, null, 2)}`,
            "info"
          );
          updateLog(
            `ğŸ”¢ Actionsæ•°é‡: ${notificationOptions.actions.length}`,
            "info"
          );

          await registration.showNotification(
            "Actionsé€šçŸ¥æµ‹è¯•",
            notificationOptions
          );

          updateLog("âœ… å¸¦Actionsçš„é€šçŸ¥å·²é€šè¿‡Service Workeræ˜¾ç¤º", "success");
          updateLog("ğŸ’¡ è¯·ç‚¹å‡»é€šçŸ¥ä¸­çš„æŒ‰é’®æµ‹è¯•actionsåŠŸèƒ½", "info");
        } catch (error) {
          updateLog("âŒ æ˜¾ç¤ºå¸¦actionsçš„é€šçŸ¥å¤±è´¥: " + error.message, "error");
          updateLog("ğŸ’¡ è¯·ç¡®ä¿sw-fixed.jsæ–‡ä»¶å­˜åœ¨ä¸”å¯è®¿é—®", "warning");
        }
      }

      // æµ‹è¯•2ä¸ªActions
      async function testTwoActions() {
        if (Notification.permission !== "granted") {
          updateLog("è¯·å…ˆè¯·æ±‚é€šçŸ¥æƒé™", "warning");
          return;
        }

        try {
          if (!("serviceWorker" in navigator)) {
            updateLog("âŒ æ­¤æµè§ˆå™¨ä¸æ”¯æŒService Worker", "error");
            return;
          }

          const registration = await navigator.serviceWorker.register(
            "sw-fixed.js"
          );
          await navigator.serviceWorker.ready;

          const notificationOptions = {
            title: "2ä¸ªActionsæµ‹è¯•",
            body: "æµ‹è¯•åªæ˜¾ç¤º2ä¸ªactionæŒ‰é’®",
            tag: "two-actions-test" + Math.random().toString(36).substr(2, 9),
            requireInteraction: true,
            actions: [
              {
                action: "action1",
                title: "æ“ä½œ1",
              },
              {
                action: "action2",
                title: "æ“ä½œ2",
              },
            ],
            data: {
              testType: "two-actions",
              timestamp: Date.now(),
            },
          };

          updateLog(
            `ğŸ”¢ æµ‹è¯•2ä¸ªActions: ${JSON.stringify(notificationOptions.actions)}`,
            "info"
          );
          await registration.showNotification(
            notificationOptions.title,
            notificationOptions
          );
          updateLog("âœ… 2ä¸ªActionsé€šçŸ¥å·²æ˜¾ç¤º", "success");
        } catch (error) {
          updateLog("âŒ 2ä¸ªActionsæµ‹è¯•å¤±è´¥: " + error.message, "error");
        }
      }

      // æµ‹è¯•1ä¸ªAction
      async function testOneAction() {
        if (Notification.permission !== "granted") {
          updateLog("è¯·å…ˆè¯·æ±‚é€šçŸ¥æƒé™", "warning");
          return;
        }

        try {
          if (!("serviceWorker" in navigator)) {
            updateLog("âŒ æ­¤æµè§ˆå™¨ä¸æ”¯æŒService Worker", "error");
            return;
          }

          const registration = await navigator.serviceWorker.register(
            "sw-fixed.js"
          );
          await navigator.serviceWorker.ready;

          const notificationOptions = {
            title: "1ä¸ªActionæµ‹è¯•",
            body: "æµ‹è¯•åªæ˜¾ç¤º1ä¸ªactionæŒ‰é’®",
            tag: "one-action-test" + Math.random().toString(36).substr(2, 9),
            requireInteraction: true,
            actions: [
              {
                action: "single_action",
                title: "å”¯ä¸€æ“ä½œ",
              },
            ],
            data: {
              testType: "one-action",
              timestamp: Date.now(),
            },
          };

          updateLog(
            `ğŸ”¢ æµ‹è¯•1ä¸ªAction: ${JSON.stringify(notificationOptions.actions)}`,
            "info"
          );
          await registration.showNotification(
            notificationOptions.title,
            notificationOptions
          );
          updateLog("âœ… 1ä¸ªActioné€šçŸ¥å·²æ˜¾ç¤º", "success");
        } catch (error) {
          updateLog("âŒ 1ä¸ªActionæµ‹è¯•å¤±è´¥: " + error.message, "error");
        }
      }

      // æµ‹è¯•Actionç‚¹å‡»æ£€æµ‹
      async function testActionDetection() {
        if (Notification.permission !== "granted") {
          updateLog("è¯·å…ˆè¯·æ±‚é€šçŸ¥æƒé™", "warning");
          return;
        }

        try {
          if (!("serviceWorker" in navigator)) {
            updateLog("âŒ æ­¤æµè§ˆå™¨ä¸æ”¯æŒService Worker", "error");
            return;
          }

          const registration = await navigator.serviceWorker.register(
            "sw-fixed.js"
          );
          await navigator.serviceWorker.ready;

          const notificationOptions = {
            title: "Actionç‚¹å‡»æ£€æµ‹æµ‹è¯•",
            body: "ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®ï¼ŒæŸ¥çœ‹é¡µé¢æ—¥å¿—ä¸­çš„actionæ£€æµ‹ç»“æœ",
            tag:
              "action-detection-test" + Math.random().toString(36).substr(2, 9),
            requireInteraction: true,
            actions: [
              {
                action: "like",
                title: "ğŸ‘ ç‚¹èµ",
              },
              {
                action: "share",
                title: "ğŸ“¤ åˆ†äº«",
              },
            ],
            data: {
              testType: "action-detection",
              message: "è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•actionç‚¹å‡»æ£€æµ‹çš„é€šçŸ¥",
              timestamp: Date.now(),
            },
          };

          updateLog("ğŸ” å‘é€Actionæ£€æµ‹æµ‹è¯•é€šçŸ¥...", "info");
          updateLog(
            `ğŸ“‹ æµ‹è¯•Actions: ${JSON.stringify(notificationOptions.actions)}`,
            "info"
          );

          await registration.showNotification(
            notificationOptions.title,
            notificationOptions
          );

          updateLog("âœ… Actionæ£€æµ‹æµ‹è¯•é€šçŸ¥å·²æ˜¾ç¤º", "success");
          updateLog(
            "ğŸ’¡ è¯·ç‚¹å‡»é€šçŸ¥ä¸­çš„æŒ‰é’®ï¼Œè§‚å¯Ÿé¡µé¢æ—¥å¿—ä¸­çš„actionæ£€æµ‹ç»“æœ",
            "info"
          );
        } catch (error) {
          updateLog("âŒ Actionæ£€æµ‹æµ‹è¯•å¤±è´¥: " + error.message, "error");
        }
      }

      // æµ‹è¯•å¤šä¸ªé€šçŸ¥
      async function testMultipleNotifications() {
        if (Notification.permission !== "granted") {
          updateLog("è¯·å…ˆè¯·æ±‚é€šçŸ¥æƒé™", "warning");
          return;
        }

        try {
          // æ£€æŸ¥Service Workeræ”¯æŒ
          if (!("serviceWorker" in navigator)) {
            updateLog(
              "âŒ æ­¤æµè§ˆå™¨ä¸æ”¯æŒService Workerï¼Œæ— æ³•æ˜¾ç¤ºå¸¦actionsçš„é€šçŸ¥",
              "error"
            );
            return;
          }

          // æ³¨å†ŒService Worker
          const registration = await navigator.serviceWorker.register(
            "sw-fixed.js"
          );
          await navigator.serviceWorker.ready;

          for (let i = 1; i <= 3; i++) {
            setTimeout(async () => {
              try {
                await registration.showNotification(`å¤šé€šçŸ¥æµ‹è¯• ${i}`, {
                  body: `è¿™æ˜¯ç¬¬ ${i} ä¸ªé€šçŸ¥ï¼Œæµ‹è¯•å¤šä¸ªé€šçŸ¥çš„æ˜¾ç¤º`,
                  tag: `multi-test-${i}`,
                  requireInteraction: true,
                  actions: [
                    {
                      action: "view",
                      title: "æŸ¥çœ‹",
                    },
                    {
                      action: "dismiss",
                      title: "å¿½ç•¥",
                    },
                  ],
                  data: {
                    index: i,
                    timestamp: Date.now(),
                  },
                });

                updateLog(`âœ… é€šçŸ¥ ${i} å·²é€šè¿‡Service Workeræ˜¾ç¤º`, "success");
              } catch (error) {
                updateLog(`âŒ æ˜¾ç¤ºé€šçŸ¥ ${i} å¤±è´¥: ${error.message}`, "error");
              }
            }, i * 1000);
          }
        } catch (error) {
          updateLog("âŒ å¤šé€šçŸ¥æµ‹è¯•å¤±è´¥: " + error.message, "error");
        }
      }

      // æ›´æ–°æ—¥å¿—
      function updateLog(message, type = "info") {
        const log = document.getElementById("log");
        const timestamp = new Date().toLocaleTimeString();
        log.innerHTML += `<div class="status ${type}">[${timestamp}] ${message}</div>`;
        log.scrollTop = log.scrollHeight;
      }

      // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
      function setupEventListeners() {
        document
          .getElementById("requestPermission")
          .addEventListener("click", requestNotificationPermission);
        document
          .getElementById("testBasicNotification")
          .addEventListener("click", testBasicNotification);
        document
          .getElementById("testNotificationWithActions")
          .addEventListener("click", testNotificationWithActions);
        document
          .getElementById("testTwoActions")
          .addEventListener("click", testTwoActions);
        document
          .getElementById("testOneAction")
          .addEventListener("click", testOneAction);
        document
          .getElementById("testActionDetection")
          .addEventListener("click", testActionDetection);
        document
          .getElementById("testMultipleNotifications")
          .addEventListener("click", testMultipleNotifications);
      }

      // ç›‘å¬Service Workeræ¶ˆæ¯
      function setupServiceWorkerMessageListener() {
        if ("serviceWorker" in navigator) {
          navigator.serviceWorker.addEventListener("message", (event) => {
            console.log("æ”¶åˆ°Service Workeræ¶ˆæ¯:", event.data);

            if (event.data.type === "NOTIFICATION_ACTION_CLICKED") {
              const { action, notificationData, timestamp } = event.data;
              const time = new Date(timestamp).toLocaleTimeString();

              updateLog(`ğŸ¯ ç”¨æˆ·ç‚¹å‡»äº†Action: "${action}"`, "success");
              updateLog(
                `ğŸ“Š é€šçŸ¥æ•°æ®: ${JSON.stringify(notificationData)}`,
                "info"
              );
              updateLog(`â° ç‚¹å‡»æ—¶é—´: ${time}`, "info");

              // æ ¹æ®ä¸åŒçš„actionæ˜¾ç¤ºä¸åŒçš„æ¶ˆæ¯
              switch (action) {
                case "open":
                  updateLog("âœ… ç”¨æˆ·é€‰æ‹©æ‰“å¼€åº”ç”¨", "success");
                  break;
                case "close":
                  updateLog("âŒ ç”¨æˆ·é€‰æ‹©å…³é—­é€šçŸ¥", "info");
                  break;
                case "reply":
                  updateLog("ğŸ’¬ ç”¨æˆ·é€‰æ‹©å›å¤", "success");
                  break;
                case "action1":
                  updateLog("ğŸ”˜ ç”¨æˆ·ç‚¹å‡»äº†æ“ä½œ1", "success");
                  break;
                case "action2":
                  updateLog("ğŸ”˜ ç”¨æˆ·ç‚¹å‡»äº†æ“ä½œ2", "success");
                  break;
                case "single_action":
                  updateLog("ğŸ”˜ ç”¨æˆ·ç‚¹å‡»äº†å”¯ä¸€æ“ä½œ", "success");
                  break;
                case "like":
                  updateLog("ğŸ‘ ç”¨æˆ·ç‚¹å‡»äº†ç‚¹èµ", "success");
                  break;
                case "share":
                  updateLog("ğŸ“¤ ç”¨æˆ·ç‚¹å‡»äº†åˆ†äº«", "success");
                  break;
                default:
                  updateLog(`â“ ç”¨æˆ·ç‚¹å‡»äº†æœªçŸ¥æ“ä½œ: ${action}`, "warning");
              }
            }
          });
        }
      }

      // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
      window.onload = function () {
        checkNotificationSupport();
        setupEventListeners();
        setupServiceWorkerMessageListener();
        updateLog("é€šçŸ¥Actionsæµ‹è¯•é¡µé¢å·²åŠ è½½", "info");
      };
    </script>
  </body>
</html>
