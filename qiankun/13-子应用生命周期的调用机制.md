# é—®é¢˜13ï¼šå­åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼ˆbootstrapã€mountã€unmountï¼‰æ˜¯å¦‚ä½•è¢«è°ƒç”¨çš„ï¼Ÿ

## ğŸ“Œ å­åº”ç”¨å¿…é¡»å¯¼å‡ºçš„ç”Ÿå‘½å‘¨æœŸ

```javascript
// å­åº”ç”¨å…¥å£æ–‡ä»¶ï¼ˆå¦‚ main.jsï¼‰
export async function bootstrap(props) {
    console.log('[react app] bootstraped', props);
}

export async function mount(props) {
    console.log('[react app] mounted', props);
    ReactDOM.render(<App />, props.container);
}

export async function unmount(props) {
    console.log('[react app] unmounted', props);
    ReactDOM.unmountComponentAtNode(props.container);
}

// å¯é€‰çš„ update ç”Ÿå‘½å‘¨æœŸ
export async function update(props) {
    console.log('[react app] updated', props);
}
```

## ğŸ”„ å®Œæ•´çš„è°ƒç”¨æµç¨‹

### é˜¶æ®µ1: åŠ è½½åº”ç”¨å¹¶è·å–ç”Ÿå‘½å‘¨æœŸ

```typescript
// packages/qiankun/src/core/loadApp.ts: 95-117
const lifecyclesPromise = loadEntry<MicroAppLifeCycles>(entry, microAppDOMContainer, containerOpts);

// æ‰§è¡Œ beforeLoad é’©å­
await execHooksChain(toArray(beforeLoad), app, global);

// ç­‰å¾…ç”Ÿå‘½å‘¨æœŸåŠ è½½å®Œæˆ
const lifecycles = await lifecyclesPromise;
if (!lifecycles) {
    throw new QiankunError(`${appName} entry ${entry} load failed as it not export lifecycles`);
}

// â­ ä»å¯¼å‡ºå¯¹è±¡ä¸­æå–ç”Ÿå‘½å‘¨æœŸå‡½æ•°
const { bootstrap, mount, unmount, update } = getLifecyclesFromExports(
    lifecycles,
    appName,
    global,
    sandboxInstance?.latestSetProp,
);
```

### é˜¶æ®µ2: æå–ç”Ÿå‘½å‘¨æœŸå‡½æ•°

```typescript
// packages/qiankun/src/core/loadApp.ts: 232-271
function getLifecyclesFromExports(
    scriptExports: MicroAppLifeCycles,
    appName: string,
    globalContext: WindowProxy,
    globalLatestSetProp?: PropertyKey,
): MicroAppLifeCycles {
    // éªŒè¯å¯¼å‡ºçš„ç”Ÿå‘½å‘¨æœŸæ˜¯å¦åˆæ³•
    const validateExportLifecycle = (exports: ObjectType | undefined): boolean => {
        const { bootstrap, mount, unmount } = exports ?? {};
        return isFunction(bootstrap) && isFunction(mount) && isFunction(unmount);
    };

    // â­ æ–¹å¼1: ç›´æ¥ä»è„šæœ¬å¯¼å‡ºå¯¹è±¡è·å–
    if (validateExportLifecycle(scriptExports)) {
        return scriptExports;
    }

    // â­ æ–¹å¼2: ä»æ²™ç®±çš„æœ€åä¸€ä¸ªè®¾ç½®çš„å±æ€§è·å–
    if (globalLatestSetProp) {
        const lifecycles = (globalContext as unknown as ObjectType)[globalLatestSetProp as never] as MicroAppLifeCycles;
        if (validateExportLifecycle(lifecycles)) {
            return lifecycles;
        }
    }

    if (process.env.NODE_ENV === 'development') {
        warn(`lifecycle not found from ${appName} entry exports, fallback to get from window['${appName}']`);
    }

    // â­ æ–¹å¼3: ä» window[appName] è·å–ï¼ˆå…œåº•ï¼‰
    const globalVariableExports = (globalContext as unknown as ObjectType)[appName as never] as MicroAppLifeCycles;

    if (validateExportLifecycle(globalVariableExports)) {
        return globalVariableExports;
    }

    throw new QiankunError(
        `You need to export lifecycle functions in ${appName} entry as neither globalLatestSetProp ${String(
            globalLatestSetProp,
        )} nor window['${appName}'] export correctly`,
    );
}
```

**ä¸‰ç§å¯¼å‡ºæ–¹å¼ä¼˜å…ˆçº§ï¼š**

1. **ES Module å¯¼å‡º**ï¼ˆæ¨èï¼‰
2. **æ²™ç®±æœ€åè®¾ç½®çš„å±æ€§**
3. **window[appName] å…¨å±€å˜é‡**ï¼ˆå…œåº•ï¼‰

### é˜¶æ®µ3: åŒ…è£…å¹¶è¿”å›é…ç½®

```typescript
// packages/qiankun/src/core/loadApp.ts: 119-189
return (mountContainer) => {
    const parcelConfig: ParcelConfigObject = {
        name: appName,

        // â­ bootstrapï¼šsingle-spa ä¼šåœ¨é¦–æ¬¡æŒ‚è½½å‰è°ƒç”¨
        bootstrap,

        // â­ mountï¼šåŒ…è£…ä¸ºæ•°ç»„ï¼Œæ·»åŠ å‰ç½®å’Œåç½®é’©å­
        mount: [
            async () => { /* æ€§èƒ½æ ‡è®° */ },
            async () => {
                microAppDOMContainer = mountContainer;
                
                // é‡æ–°æŒ‚è½½æ—¶ï¼Œéœ€è¦é‡æ–°åŠ è½½ HTML
                if (mountTimes > 1) {
                    initContainer(mountContainer, appName, { sandboxCfg: sandbox, mountTimes, instanceId });
                    const htmlString = await getPureHTMLStringWithoutScripts(entry, enhancedFetch);
                    await loadEntry(
                        { url: entry, res: new Response(htmlString, { status: 200, statusText: 'OK' }) },
                        mountContainer,
                        containerOpts,
                    );
                }
            },
            async () => {
                // æ¿€æ´»æ²™ç®±
                await mountSandbox(mountContainer);
            },
            async () => execHooksChain(toArray(beforeMount), app, global),
            // â­ è°ƒç”¨å­åº”ç”¨çš„ mount
            async (props) => mount({ ...props, container: mountContainer }),
            async () => execHooksChain(toArray(afterMount), app, global),
            async () => { /* æ€§èƒ½æµ‹é‡ */ },
            async () => {
                mountTimes++;
            },
        ],

        // â­ unmountï¼šåŒ…è£…ä¸ºæ•°ç»„ï¼Œæ·»åŠ å‰ç½®å’Œåç½®é’©å­
        unmount: [
            async () => execHooksChain(toArray(beforeUnmount), app, global),
            // â­ è°ƒç”¨å­åº”ç”¨çš„ unmount
            async (props) => unmount({ ...props, container: mountContainer }),
            unmountSandbox,
            async () => execHooksChain(toArray(afterUnmount), app, global),
            async () => {
                clearContainer(mountContainer);
            },
        ],
    };

    // â­ updateï¼šå¦‚æœå­åº”ç”¨å¯¼å‡ºäº† updateï¼Œåˆ™æ·»åŠ åˆ°é…ç½®ä¸­
    if (typeof update === 'function') {
        parcelConfig.update = update;
    }

    return parcelConfig;
};
```

### é˜¶æ®µ4: single-spa è°ƒç”¨ç”Ÿå‘½å‘¨æœŸ

```javascript
// single-spa å†…éƒ¨è°ƒç”¨é€»è¾‘ï¼ˆç®€åŒ–ç‰ˆï¼‰

// é¦–æ¬¡æŒ‚è½½åº”ç”¨
async function bootstrapApp(app) {
    // è°ƒç”¨ bootstrapï¼ˆåªæ‰§è¡Œä¸€æ¬¡ï¼‰
    if (Array.isArray(app.bootstrap)) {
        for (const fn of app.bootstrap) {
            await fn();
        }
    } else {
        await app.bootstrap();
    }
    app.bootstrapped = true;
}

async function mountApp(app) {
    // è°ƒç”¨ mount æ•°ç»„ä¸­çš„æ¯ä¸ªå‡½æ•°
    if (Array.isArray(app.mount)) {
        for (const fn of app.mount) {
            await fn(app.customProps);
        }
    } else {
        await app.mount(app.customProps);
    }
}

async function unmountApp(app) {
    // è°ƒç”¨ unmount æ•°ç»„ä¸­çš„æ¯ä¸ªå‡½æ•°
    if (Array.isArray(app.unmount)) {
        for (const fn of app.unmount) {
            await fn(app.customProps);
        }
    } else {
        await app.unmount(app.customProps);
    }
}
```

## ğŸ“Š å­åº”ç”¨å¯¼å‡ºçš„ä¸‰ç§æ–¹å¼

### æ–¹å¼1: ES Module å¯¼å‡ºï¼ˆæ¨èï¼‰

```javascript
// å­åº”ç”¨ src/index.js

// ç‹¬ç«‹è¿è¡Œ
if (!window.__POWERED_BY_QIANKUN__) {
    ReactDOM.render(<App />, document.getElementById('root'));
}

// â­ å¯¼å‡ºç”Ÿå‘½å‘¨æœŸç»™ qiankun
export async function bootstrap(props) {
    console.log('[react app] bootstrap', props);
}

export async function mount(props) {
    console.log('[react app] mount', props);
    ReactDOM.render(<App />, props.container);
}

export async function unmount(props) {
    console.log('[react app] unmount', props);
    ReactDOM.unmountComponentAtNode(props.container);
}
```

**webpack é…ç½®ï¼š**

```javascript
// webpack.config.js
module.exports = {
    output: {
        library: 'reactApp',
        libraryTarget: 'umd',  // â­ å¿…é¡»æ˜¯ umd æ ¼å¼
        umdNamedDefine: true,
    },
};
```

**ä¸ºä»€ä¹ˆæ˜¯ UMD æ ¼å¼ï¼Ÿ**

```javascript
// UMD æ ¼å¼ä¼šå°†å¯¼å‡ºæŒ‚è½½åˆ° window ä¸Š
(function (root, factory) {
    if (typeof exports === 'object' && typeof module === 'object') {
        // CommonJS
        module.exports = factory();
    } else if (typeof define === 'function' && define.amd) {
        // AMD
        define([], factory);
    } else {
        // Browser globals
        root.reactApp = factory();  // â­ æŒ‚è½½åˆ° window.reactApp
    }
})(window, function() {
    return {
        bootstrap: async function(props) { /* ... */ },
        mount: async function(props) { /* ... */ },
        unmount: async function(props) { /* ... */ }
    };
});
```

### æ–¹å¼2: å…¨å±€å˜é‡ï¼ˆä¸æ¨èï¼‰

```javascript
// å­åº”ç”¨ src/index.js

// â­ ç›´æ¥æŒ‚è½½åˆ° window ä¸Š
window.reactApp = {
    async bootstrap(props) {
        console.log('bootstrap', props);
    },
    async mount(props) {
        console.log('mount', props);
        ReactDOM.render(<App />, props.container);
    },
    async unmount(props) {
        console.log('unmount', props);
        ReactDOM.unmountComponentAtNode(props.container);
    }
};
```

**ç¼ºç‚¹ï¼š**
- æ±¡æŸ“å…¨å±€å‘½åç©ºé—´
- å®¹æ˜“äº§ç”Ÿå‘½åå†²çª
- ä¸æ”¯æŒ Tree Shaking

### æ–¹å¼3: æ²™ç®±æœ€åè®¾ç½®çš„å±æ€§

```javascript
// qiankun ä¼šè‡ªåŠ¨æ£€æµ‹æ²™ç®±ä¸­æœ€åä¸€ä¸ªæ–°å¢çš„å…¨å±€å±æ€§

// å­åº”ç”¨ä»£ç 
const microAppLifecycles = {
    async bootstrap(props) {
        console.log('bootstrap', props);
    },
    async mount(props) {
        console.log('mount', props);
        ReactDOM.render(<App />, props.container);
    },
    async unmount(props) {
        console.log('unmount', props);
        ReactDOM.unmountComponentAtNode(props.container);
    }
};

// â­ è®¾ç½®åˆ°å…¨å±€ï¼ˆè¿™æ˜¯ä»£ç ä¸­æœ€åä¸€ä¸ªå…¨å±€èµ‹å€¼ï¼‰
window.microAppLifecycles = microAppLifecycles;

// qiankun ä¼šé€šè¿‡ sandbox.latestSetProp æ‰¾åˆ°è¿™ä¸ªå±æ€§
```

## ğŸ¯ ç”Ÿå‘½å‘¨æœŸå‡½æ•°çš„å‚æ•°ï¼ˆpropsï¼‰

```typescript
// props çš„ç»“æ„
{
    name: string;          // åº”ç”¨åç§°
    container: HTMLElement; // æŒ‚è½½å®¹å™¨
    // ä¸»åº”ç”¨ä¼ é€’çš„è‡ªå®šä¹‰æ•°æ®
    ...customProps
}
```

**ä½¿ç”¨ç¤ºä¾‹ï¼š**

```javascript
// ä¸»åº”ç”¨
registerMicroApps([
    {
        name: 'react-app',
        entry: '//localhost:8080',
        container: '#subapp-viewport',
        activeRule: '/react-app',
        props: {
            // â­ è‡ªå®šä¹‰æ•°æ®
            data: {
                user: getCurrentUser(),
                permissions: getUserPermissions()
            },
            // â­ è‡ªå®šä¹‰æ–¹æ³•
            onGlobalStateChange: (state) => {
                console.log('global state changed', state);
            }
        }
    }
]);

// å­åº”ç”¨
export async function mount(props) {
    const { container, data, onGlobalStateChange } = props;
    
    console.log('ç”¨æˆ·ä¿¡æ¯:', data.user);
    console.log('æƒé™åˆ—è¡¨:', data.permissions);
    
    // ä½¿ç”¨ä¸»åº”ç”¨ä¼ é€’çš„æ–¹æ³•
    onGlobalStateChange({ count: 1 });
    
    // æŒ‚è½½åº”ç”¨
    ReactDOM.render(<App />, container);
}
```

## ğŸ” ç”Ÿå‘½å‘¨æœŸè°ƒç”¨çš„å®Œæ•´æ—¶åºå›¾

```
ç”¨æˆ·è®¿é—® /react-app
    â†“
single-spa æ£€æµ‹åˆ°è·¯ç”±åŒ¹é…
    â†“
è°ƒç”¨ app() å‡½æ•°ï¼ˆregisterApplication æ—¶å®šä¹‰çš„ï¼‰
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. beforeLoad (ä¸»åº”ç”¨é’©å­)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 2. loadEntry (åŠ è½½ HTML/JS/CSS)         â”‚
â”‚    - è§£æ HTML                           â”‚
â”‚    - ä¸‹è½½ JS/CSS                         â”‚
â”‚    - åœ¨æ²™ç®±ä¸­æ‰§è¡Œ JS                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 3. getLifecyclesFromExports             â”‚
â”‚    - ä»å¯¼å‡ºå¯¹è±¡æå–ç”Ÿå‘½å‘¨æœŸå‡½æ•°          â”‚
â”‚    - éªŒè¯å¿…éœ€çš„å‡½æ•°å­˜åœ¨                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 4. single-spa.bootstrap (ä»…é¦–æ¬¡)        â”‚
â”‚    è°ƒç”¨ â†’ bootstrap(props)              â”‚
â”‚           â†“                             â”‚
â”‚    å­åº”ç”¨åˆå§‹åŒ–ï¼ˆåªæ‰§è¡Œä¸€æ¬¡ï¼‰             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 5. beforeMount (ä¸»åº”ç”¨é’©å­)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 6. mountSandbox (æ¿€æ´»æ²™ç®±)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 7. single-spa.mount                     â”‚
â”‚    è°ƒç”¨ â†’ mount(props)                  â”‚
â”‚           â†“                             â”‚
â”‚    å­åº”ç”¨æŒ‚è½½DOMï¼Œæ¸²æŸ“å†…å®¹               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 8. afterMount (ä¸»åº”ç”¨é’©å­)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
åº”ç”¨è¿è¡Œä¸­...
    â†“
ç”¨æˆ·ç¦»å¼€ /react-app
    â†“
single-spa æ£€æµ‹åˆ°è·¯ç”±ä¸åŒ¹é…
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 9. beforeUnmount (ä¸»åº”ç”¨é’©å­)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 10. single-spa.unmount                  â”‚
â”‚     è°ƒç”¨ â†’ unmount(props)               â”‚
â”‚            â†“                            â”‚
â”‚     å­åº”ç”¨å¸è½½DOMï¼Œæ¸…ç†èµ„æº              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 11. unmountSandbox (å¸è½½æ²™ç®±)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 12. afterUnmount (ä¸»åº”ç”¨é’©å­)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 13. clearContainer (æ¸…ç©ºå®¹å™¨)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ’¡ å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### é—®é¢˜1: ç”Ÿå‘½å‘¨æœŸå‡½æ•°æœªå¯¼å‡º

```javascript
// âŒ é”™è¯¯ï¼šæ²¡æœ‰å¯¼å‡ºç”Ÿå‘½å‘¨æœŸ
function bootstrap() { /* ... */ }
function mount() { /* ... */ }
function unmount() { /* ... */ }

// é”™è¯¯ä¿¡æ¯ï¼š
// [qiankun]: You need to export lifecycle functions in reactApp entry

// âœ“ æ­£ç¡®ï¼šå¿…é¡»å¯¼å‡º
export async function bootstrap() { /* ... */ }
export async function mount() { /* ... */ }
export async function unmount() { /* ... */ }
```

### é—®é¢˜2: webpack é…ç½®ä¸æ­£ç¡®

```javascript
// âŒ é”™è¯¯ï¼šæ²¡æœ‰é…ç½® library
output: {
    filename: 'bundle.js',
    path: path.resolve(__dirname, 'dist')
}

// âœ“ æ­£ç¡®ï¼šé…ç½® UMD æ ¼å¼
output: {
    library: 'reactApp',
    libraryTarget: 'umd',
    filename: 'bundle.js',
    path: path.resolve(__dirname, 'dist')
}
```

### é—®é¢˜3: bootstrap ä¸­æ‰§è¡Œäº†æŒ‚è½½æ“ä½œ

```javascript
// âŒ é”™è¯¯ï¼šbootstrap ä¸­æŒ‚è½½äº† DOM
export async function bootstrap(props) {
    // bootstrap åªæ‰§è¡Œä¸€æ¬¡ï¼Œä¸åº”è¯¥æŒ‚è½½ DOM
    ReactDOM.render(<App />, props.container); // âŒ
}

// âœ“ æ­£ç¡®ï¼šåœ¨ mount ä¸­æŒ‚è½½
export async function bootstrap(props) {
    // bootstrap åªåšåˆå§‹åŒ–å·¥ä½œ
    console.log('app bootstraped');
}

export async function mount(props) {
    // mount ä¸­æŒ‚è½½ DOM
    ReactDOM.render(<App />, props.container); // âœ“
}
```

### é—®é¢˜4: unmount ä¸­æ²¡æœ‰æ¸…ç†èµ„æº

```javascript
// âŒ é”™è¯¯ï¼šæ²¡æœ‰æ¸…ç†
export async function unmount(props) {
    // ä»€ä¹ˆéƒ½ä¸åš âŒ
}

// âœ“ æ­£ç¡®ï¼šå½»åº•æ¸…ç†
export async function unmount(props) {
    // 1. å¸è½½ React ç»„ä»¶
    ReactDOM.unmountComponentAtNode(props.container);
    
    // 2. æ¸…ç†å…¨å±€äº‹ä»¶ç›‘å¬
    window.removeEventListener('resize', handleResize);
    
    // 3. æ¸…ç†å®šæ—¶å™¨
    clearInterval(timer);
    
    // 4. å–æ¶ˆæœªå®Œæˆçš„è¯·æ±‚
    abortController.abort();
    
    // 5. æ¸…ç† WebSocket
    ws.close();
}
```

## ğŸ“ é¢è¯•è¦ç‚¹

### è°ƒç”¨æµç¨‹

1. **åŠ è½½é˜¶æ®µ**ï¼šloadEntry æ‰§è¡Œè„šæœ¬ï¼Œè·å–å¯¼å‡ºå¯¹è±¡
2. **æå–é˜¶æ®µ**ï¼šgetLifecyclesFromExports æå–ç”Ÿå‘½å‘¨æœŸå‡½æ•°
3. **åŒ…è£…é˜¶æ®µ**ï¼šå°†ç”Ÿå‘½å‘¨æœŸå‡½æ•°åŒ…è£…æˆ single-spa é…ç½®
4. **è°ƒç”¨é˜¶æ®µ**ï¼šsingle-spa åœ¨åˆé€‚çš„æ—¶æœºè°ƒç”¨ç”Ÿå‘½å‘¨æœŸ

### ä¸‰ç§å¯¼å‡ºæ–¹å¼

1. **ES Module + UMD**ï¼šæ¨èæ–¹å¼
2. **å…¨å±€å˜é‡**ï¼šå…œåº•æ–¹æ¡ˆ
3. **æ²™ç®±æœ€åè®¾ç½®çš„å±æ€§**ï¼šè‡ªåŠ¨æ£€æµ‹

### ç”Ÿå‘½å‘¨æœŸèŒè´£

1. **bootstrap**ï¼šä¸€æ¬¡æ€§åˆå§‹åŒ–ï¼ˆå…¨å±€çŠ¶æ€ã€æ’ä»¶ç­‰ï¼‰
2. **mount**ï¼šæŒ‚è½½ DOMï¼Œæ¸²æŸ“å†…å®¹
3. **unmount**ï¼šå¸è½½ DOMï¼Œæ¸…ç†èµ„æº
4. **update**ï¼šæ›´æ–° propsï¼ˆå¯é€‰ï¼‰

### å…³é”®è®¾è®¡

1. **æ•°ç»„åŒ…è£…**ï¼šåœ¨å­åº”ç”¨ç”Ÿå‘½å‘¨æœŸå‰åæ·»åŠ é’©å­
2. **å®¹é”™æœºåˆ¶**ï¼šä¸‰ç§å¯¼å‡ºæ–¹å¼çš„é™çº§å¤„ç†
3. **Props ä¼ é€’**ï¼šä¸»åº”ç”¨å‘å­åº”ç”¨ä¼ é€’æ•°æ®å’Œæ–¹æ³•
4. **single-spa å§”æ‰˜**ï¼šåˆ©ç”¨ single-spa çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†

## ğŸ’¡ ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ

### 1. ä¸ºä»€ä¹ˆéœ€è¦ UMD æ ¼å¼ï¼Ÿ

```javascript
// é—®é¢˜ï¼šES Module å¯¼å‡ºåœ¨æµè§ˆå™¨ä¸­ä¸èƒ½ç›´æ¥è®¿é—®
export function mount() { /* ... */ }
// æµè§ˆå™¨æ— æ³•é€šè¿‡ window.xxx è®¿é—®

// UMD è§£å†³ï¼šæ—¢æ”¯æŒæ¨¡å—åŒ–ï¼Œåˆèƒ½æŒ‚è½½åˆ° window
(function (root, factory) {
    root.reactApp = factory();  // æŒ‚è½½åˆ° window
})(window, function() {
    return { mount, unmount, bootstrap };
});

// qiankun å¯ä»¥é€šè¿‡ window.reactApp è®¿é—®ç”Ÿå‘½å‘¨æœŸ
```

### 2. ä¸ºä»€ä¹ˆæœ‰ä¸‰ç§å¯¼å‡ºæ–¹å¼ï¼Ÿ

```javascript
// ä¼˜å…ˆçº§1: ç›´æ¥å¯¼å‡ºï¼ˆæœ€ä¼˜é›…ï¼‰
export { bootstrap, mount, unmount };

// ä¼˜å…ˆçº§2: æ²™ç®±å±æ€§ï¼ˆè‡ªåŠ¨æ£€æµ‹ï¼‰
window.xxx = { bootstrap, mount, unmount };

// ä¼˜å…ˆçº§3: åº”ç”¨åå…¨å±€å˜é‡ï¼ˆå…œåº•ï¼‰
window[appName] = { bootstrap, mount, unmount };

// çµæ´»æ€§ + å®¹é”™æ€§
```

### 3. ä¸ºä»€ä¹ˆ mount/unmount åŒ…è£…ä¸ºæ•°ç»„ï¼Ÿ

```javascript
// åŒ…è£…å‰ï¼šåªæœ‰å­åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸ
mount: async (props) => { /* å­åº”ç”¨é€»è¾‘ */ }

// åŒ…è£…åï¼šå¯ä»¥æ·»åŠ å‰ç½®å’Œåç½®é€»è¾‘
mount: [
    async () => { /* å‰ç½®ï¼šæ¿€æ´»æ²™ç®± */ },
    async () => { /* å‰ç½®ï¼šbeforeMount é’©å­ */ },
    async (props) => { /* å­åº”ç”¨é€»è¾‘ */ },
    async () => { /* åç½®ï¼šafterMount é’©å­ */ },
]

// éä¾µå…¥å¼å¢å¼º
```

qiankun é€šè¿‡å·§å¦™çš„ç”Ÿå‘½å‘¨æœŸæå–å’ŒåŒ…è£…æœºåˆ¶ï¼Œå®ç°äº†ä¸»åº”ç”¨å¯¹å­åº”ç”¨ç”Ÿå‘½å‘¨æœŸçš„å®Œå…¨æ§åˆ¶ï¼ŒåŒæ—¶ä¿æŒäº†å­åº”ç”¨çš„ç‹¬ç«‹æ€§ï¼

