# é—®é¢˜12ï¼šqiankun çš„ç”Ÿå‘½å‘¨æœŸæœ‰å“ªäº›ï¼ŸbeforeLoadã€beforeMountã€afterMount ç­‰é’©å­çš„æ‰§è¡Œæ—¶æœºå’Œç”¨é€”æ˜¯ä»€ä¹ˆï¼Ÿ

## ğŸ“Œ ç”Ÿå‘½å‘¨æœŸé’©å­å®šä¹‰

```typescript
// packages/qiankun/src/types.ts: 49-56
export type LifeCycleFn<T extends ObjectType> = (
    app: LoadableApp<T>, 
    global: WindowProxy
) => Promise<void>;

export type LifeCycles<T extends ObjectType> = {
    beforeLoad?: LifeCycleFn<T> | Array<LifeCycleFn<T>>;      // åŠ è½½å‰
    beforeMount?: LifeCycleFn<T> | Array<LifeCycleFn<T>>;     // æŒ‚è½½å‰
    afterMount?: LifeCycleFn<T> | Array<LifeCycleFn<T>>;      // æŒ‚è½½å
    beforeUnmount?: LifeCycleFn<T> | Array<LifeCycleFn<T>>;   // å¸è½½å‰
    afterUnmount?: LifeCycleFn<T> | Array<LifeCycleFn<T>>;    // å¸è½½å
};
```

## ğŸ¯ ä¸¤ç±»ç”Ÿå‘½å‘¨æœŸ

### 1. ä¸»åº”ç”¨ç”Ÿå‘½å‘¨æœŸï¼ˆqiankun æä¾›ï¼‰

**æ³¨å†Œä½ç½®ï¼š**

```javascript
// å…¨å±€ç”Ÿå‘½å‘¨æœŸï¼ˆé€‚ç”¨äºæ‰€æœ‰åº”ç”¨ï¼‰
registerMicroApps(
    [ /* åº”ç”¨é…ç½® */ ],
    {
        beforeLoad: app => console.log('before load', app.name),
        beforeMount: app => console.log('before mount', app.name),
        afterMount: app => console.log('after mount', app.name),
        beforeUnmount: app => console.log('before unmount', app.name),
        afterUnmount: app => console.log('after unmount', app.name),
    }
);

// å•ä¸ªåº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸ
loadMicroApp(
    { /* åº”ç”¨é…ç½® */ },
    { /* å…¶ä»–é…ç½® */ },
    {
        beforeLoad: app => console.log('before load', app.name),
        beforeMount: app => console.log('before mount', app.name),
        afterMount: app => console.log('after mount', app.name),
        beforeUnmount: app => console.log('before unmount', app.name),
        afterUnmount: app => console.log('after unmount', app.name),
    }
);
```

### 2. å­åº”ç”¨ç”Ÿå‘½å‘¨æœŸï¼ˆå­åº”ç”¨å¯¼å‡ºï¼‰

```javascript
// å­åº”ç”¨å¿…é¡»å¯¼å‡ºçš„ç”Ÿå‘½å‘¨æœŸ
export async function bootstrap(props) {
    console.log('å­åº”ç”¨ bootstrap', props);
}

export async function mount(props) {
    console.log('å­åº”ç”¨ mount', props);
    ReactDOM.render(<App />, props.container);
}

export async function unmount(props) {
    console.log('å­åº”ç”¨ unmount', props);
    ReactDOM.unmountComponentAtNode(props.container);
}

// å¯é€‰çš„ update ç”Ÿå‘½å‘¨æœŸ
export async function update(props) {
    console.log('å­åº”ç”¨ update', props);
}
```

## ğŸ”„ å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸæ‰§è¡Œæµç¨‹

```javascript
// åº”ç”¨é¦–æ¬¡åŠ è½½å¹¶æŒ‚è½½
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. beforeLoad (ä¸»åº”ç”¨é’©å­)                   â”‚
â”‚    - åº”ç”¨åŠ è½½å‰çš„å‡†å¤‡å·¥ä½œ                      â”‚
â”‚    - æ­¤æ—¶è¿˜æ²¡æœ‰ä¸‹è½½ä»»ä½•èµ„æº                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 2. ä¸‹è½½ HTMLã€JSã€CSS                        â”‚
â”‚    - import-html-entry è§£æå…¥å£               â”‚
â”‚    - ä¸‹è½½æ‰€æœ‰èµ„æº                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 3. æ‰§è¡Œ JSï¼Œè·å–ç”Ÿå‘½å‘¨æœŸå‡½æ•°                  â”‚
â”‚    - åœ¨æ²™ç®±ä¸­æ‰§è¡Œè„šæœ¬                         â”‚
â”‚    - è·å– bootstrapã€mountã€unmount           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 4. bootstrap (å­åº”ç”¨) - ä»…é¦–æ¬¡               â”‚
â”‚    - å­åº”ç”¨åˆå§‹åŒ–                             â”‚
â”‚    - åªæ‰§è¡Œä¸€æ¬¡                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 5. beforeMount (ä¸»åº”ç”¨é’©å­)                  â”‚
â”‚    - æŒ‚è½½å‰çš„å‡†å¤‡å·¥ä½œ                         â”‚
â”‚    - æ­¤æ—¶ HTML å·²æ¸²æŸ“ï¼Œè„šæœ¬å·²æ‰§è¡Œ              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 6. mount (å­åº”ç”¨)                            â”‚
â”‚    - å­åº”ç”¨æŒ‚è½½åˆ°å®¹å™¨                         â”‚
â”‚    - æ¸²æŸ“åº”ç”¨å†…å®¹                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 7. afterMount (ä¸»åº”ç”¨é’©å­)                   â”‚
â”‚    - æŒ‚è½½å®Œæˆåçš„å¤„ç†                         â”‚
â”‚    - æ­¤æ—¶å­åº”ç”¨å·²å®Œå…¨å±•ç¤º                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

// åº”ç”¨å¸è½½
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. beforeUnmount (ä¸»åº”ç”¨é’©å­)                â”‚
â”‚    - å¸è½½å‰çš„æ¸…ç†å‡†å¤‡                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 9. unmount (å­åº”ç”¨)                          â”‚
â”‚    - å­åº”ç”¨å¸è½½                               â”‚
â”‚    - æ¸…ç†äº‹ä»¶ã€å®šæ—¶å™¨ç­‰                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 10. afterUnmount (ä¸»åº”ç”¨é’©å­)                â”‚
â”‚     - å¸è½½å®Œæˆåçš„æ¸…ç†                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

// åº”ç”¨å†æ¬¡æŒ‚è½½ï¼ˆå·² bootstrap è¿‡ï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. beforeMount (ä¸»åº”ç”¨é’©å­)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 6. mount (å­åº”ç”¨)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 7. afterMount (ä¸»åº”ç”¨é’©å­)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“‹ å„é’©å­è¯¦è§£

### 1. beforeLoad

**æ‰§è¡Œæ—¶æœºï¼š** åº”ç”¨åŠ è½½å‰ï¼Œåœ¨ä¸‹è½½èµ„æºä¹‹å‰

**æºç ä½ç½®ï¼š**

```typescript
// packages/qiankun/src/core/loadApp.ts: 103-108
const {
    beforeLoad = [],
    // ...
} = mergeWith({}, getAddOns(global, assetPublicPath), lifeCycles, ...);

await execHooksChain(toArray(beforeLoad), app, global);
```

**å…¸å‹ç”¨é€”ï¼š**

```javascript
{
    beforeLoad: async (app, global) => {
        // 1. æ˜¾ç¤ºå…¨å±€ loading
        showGlobalLoading(`æ­£åœ¨åŠ è½½ ${app.name}...`);
        
        // 2. è®°å½•åŠ è½½å¼€å§‹æ—¶é—´ï¼ˆæ€§èƒ½ç›‘æ§ï¼‰
        window.performanceMonitor?.mark(`${app.name}-load-start`);
        
        // 3. é¢„å¤„ç†ï¼šæ³¨å…¥å…¨å±€é…ç½®
        global.APP_CONFIG = {
            apiBase: process.env.API_BASE,
            appName: app.name
        };
        
        // 4. æƒé™æ£€æŸ¥
        const hasPermission = await checkUserPermission(app.name);
        if (!hasPermission) {
            throw new Error('æ— æƒé™è®¿é—®æ­¤åº”ç”¨');
        }
        
        // 5. åŸ‹ç‚¹ä¸ŠæŠ¥
        analytics.track('micro_app_load_start', {
            appName: app.name,
            entry: app.entry
        });
    }
}
```

### 2. beforeMount

**æ‰§è¡Œæ—¶æœºï¼š** åº”ç”¨æŒ‚è½½å‰ï¼Œæ­¤æ—¶ HTML å·²æ¸²æŸ“ï¼Œè„šæœ¬å·²æ‰§è¡Œï¼Œä½†å­åº”ç”¨è¿˜æœªæŒ‚è½½

**æºç ä½ç½®ï¼š**

```typescript
// packages/qiankun/src/core/loadApp.ts: 155-156
mount: [
    // ... å…¶ä»–æ­¥éª¤
    async () => execHooksChain(toArray(beforeMount), app, global),
    async (props) => mount({ ...props, container: mountContainer }),
    // ...
]
```

**å…¸å‹ç”¨é€”ï¼š**

```javascript
{
    beforeMount: async (app, global) => {
        // 1. æ³¨å…¥è¿è¡Œæ—¶æ•°æ®
        global.__RUNTIME_CONFIG__ = {
            userInfo: getCurrentUser(),
            permissions: getUserPermissions(),
            theme: getTheme()
        };
        
        // 2. å‡†å¤‡å®¹å™¨
        const container = document.querySelector(app.container);
        container.classList.add('micro-app-container');
        container.setAttribute('data-app-name', app.name);
        
        // 3. åˆå§‹åŒ–å­åº”ç”¨éœ€è¦çš„å…¨å±€æœåŠ¡
        if (app.name === 'chat-app') {
            await initializeWebSocket();
        }
        
        // 4. ä¿®æ”¹å…¨å±€çŠ¶æ€
        store.dispatch({ type: 'SET_CURRENT_APP', payload: app.name });
        
        // 5. éšè—åŠ è½½çŠ¶æ€ï¼Œå‡†å¤‡æ˜¾ç¤ºå†…å®¹
        hideGlobalLoading();
    }
}
```

### 3. afterMount

**æ‰§è¡Œæ—¶æœºï¼š** åº”ç”¨æŒ‚è½½åï¼Œå­åº”ç”¨å·²å®Œå…¨æ¸²æŸ“

**æºç ä½ç½®ï¼š**

```typescript
// packages/qiankun/src/core/loadApp.ts: 159
mount: [
    // ...
    async (props) => mount({ ...props, container: mountContainer }),
    async () => execHooksChain(toArray(afterMount), app, global),
    // ...
]
```

**å…¸å‹ç”¨é€”ï¼š**

```javascript
{
    afterMount: async (app, global) => {
        // 1. æ€§èƒ½ç›‘æ§
        window.performanceMonitor?.measure(
            `${app.name}-mount-time`,
            `${app.name}-load-start`
        );
        
        // 2. é¡µé¢æ ‡é¢˜è®¾ç½®
        document.title = `${app.name} - æˆ‘çš„åº”ç”¨`;
        
        // 3. ä¸ŠæŠ¥æŒ‚è½½æˆåŠŸ
        analytics.track('micro_app_mounted', {
            appName: app.name,
            mountTime: Date.now()
        });
        
        // 4. åˆå§‹åŒ–åº”ç”¨é—´é€šä¿¡
        if (app.name === 'main-app') {
            initializeAppCommunication();
        }
        
        // 5. è‡ªåŠ¨èšç„¦
        const container = document.querySelector(app.container);
        const firstInput = container.querySelector('input, textarea');
        firstInput?.focus();
        
        // 6. é€šçŸ¥å…¶ä»–ç³»ç»Ÿ
        window.dispatchEvent(new CustomEvent('microAppMounted', {
            detail: { appName: app.name }
        }));
    }
}
```

### 4. beforeUnmount

**æ‰§è¡Œæ—¶æœºï¼š** åº”ç”¨å¸è½½å‰ï¼Œå­åº”ç”¨è¿˜åœ¨è¿è¡Œ

**æºç ä½ç½®ï¼š**

```typescript
// packages/qiankun/src/core/loadApp.ts: 172
unmount: [
    async () => execHooksChain(toArray(beforeUnmount), app, global),
    async (props) => unmount({ ...props, container: mountContainer }),
    // ...
]
```

**å…¸å‹ç”¨é€”ï¼š**

```javascript
{
    beforeUnmount: async (app, global) => {
        // 1. ä¿å­˜åº”ç”¨çŠ¶æ€ï¼ˆç”¨äºä¸‹æ¬¡æ¢å¤ï¼‰
        const appState = global.store?.getState();
        localStorage.setItem(`${app.name}-state`, JSON.stringify(appState));
        
        // 2. æ˜¾ç¤ºå¸è½½æç¤º
        showNotification(`${app.name} æ­£åœ¨å¸è½½...`);
        
        // 3. æš‚åœåº”ç”¨ä¸­çš„å¼‚æ­¥ä»»åŠ¡
        global.pauseAsyncTasks?.();
        
        // 4. æ–­å¼€ WebSocket è¿æ¥
        if (app.name === 'chat-app') {
            global.ws?.close();
        }
        
        // 5. ä¸ŠæŠ¥å¸è½½äº‹ä»¶
        analytics.track('micro_app_unmount_start', {
            appName: app.name
        });
    }
}
```

### 5. afterUnmount

**æ‰§è¡Œæ—¶æœºï¼š** åº”ç”¨å¸è½½åï¼Œå­åº”ç”¨å·²å®Œå…¨å¸è½½

**æºç ä½ç½®ï¼š**

```typescript
// packages/qiankun/src/core/loadApp.ts: 175
unmount: [
    // ...
    async (props) => unmount({ ...props, container: mountContainer }),
    unmountSandbox,
    async () => execHooksChain(toArray(afterUnmount), app, global),
    // ...
]
```

**å…¸å‹ç”¨é€”ï¼š**

```javascript
{
    afterUnmount: async (app, global) => {
        // 1. æ¸…ç†å®¹å™¨
        const container = document.querySelector(app.container);
        container.classList.remove('micro-app-container');
        container.removeAttribute('data-app-name');
        
        // 2. æ¸…ç†å…¨å±€çŠ¶æ€
        delete global.__RUNTIME_CONFIG__;
        store.dispatch({ type: 'CLEAR_CURRENT_APP' });
        
        // 3. ä¸ŠæŠ¥å¸è½½å®Œæˆ
        analytics.track('micro_app_unmounted', {
            appName: app.name,
            unmountTime: Date.now()
        });
        
        // 4. é‡Šæ”¾èµ„æº
        if (app.name === 'heavy-app') {
            // æ‰‹åŠ¨è§¦å‘åƒåœ¾å›æ”¶æç¤ºï¼ˆè™½ç„¶ä¸ä¸€å®šæœ‰æ•ˆï¼‰
            global = null;
        }
        
        // 5. é€šçŸ¥å…¶ä»–ç³»ç»Ÿ
        window.dispatchEvent(new CustomEvent('microAppUnmounted', {
            detail: { appName: app.name }
        }));
    }
}
```

## ğŸ¨ å†…ç½®é’©å­ï¼ˆAddonsï¼‰

qiankun æä¾›äº†ä¸¤ä¸ªå†…ç½®çš„ç”Ÿå‘½å‘¨æœŸé’©å­ï¼š

### 1. engineFlag Addon

```typescript
// packages/qiankun/src/addons/engineFlag.ts
export default function getAddOn(global: Window): LifeCycles<ObjectType> {
    return {
        async beforeLoad() {
            global.__POWERED_BY_QIANKUN__ = true;
        },

        async beforeMount() {
            global.__POWERED_BY_QIANKUN__ = true;
        },

        async beforeUnmount() {
            delete global.__POWERED_BY_QIANKUN__;
        },
    };
}
```

**ä½œç”¨ï¼š** è®¾ç½® `__POWERED_BY_QIANKUN__` æ ‡è®°ï¼Œè®©å­åº”ç”¨çŸ¥é“è‡ªå·±è¿è¡Œåœ¨ qiankun ç¯å¢ƒä¸­ã€‚

**å­åº”ç”¨ä½¿ç”¨ï¼š**

```javascript
// å­åº”ç”¨ä¸­åˆ¤æ–­è¿è¡Œç¯å¢ƒ
if (window.__POWERED_BY_QIANKUN__) {
    // åœ¨ qiankun ä¸­è¿è¡Œ
    // ä½¿ç”¨ qiankun æä¾›çš„ container
} else {
    // ç‹¬ç«‹è¿è¡Œ
    // ä½¿ç”¨è‡ªå·±çš„æ ¹å…ƒç´ 
    ReactDOM.render(<App />, document.getElementById('root'));
}
```

### 2. runtimePublicPath Addon

```typescript
// packages/qiankun/src/addons/runtimePublicPath.ts
export default function getAddOn(global: Window, publicPath = '/'): LifeCycles<ObjectType> {
    let hasMountedOnce = false;

    return {
        async beforeLoad() {
            global.__INJECTED_PUBLIC_PATH_BY_QIANKUN__ = publicPath;
        },

        async beforeMount() {
            if (hasMountedOnce) {
                global.__INJECTED_PUBLIC_PATH_BY_QIANKUN__ = publicPath;
            }
        },

        async beforeUnmount() {
            if (rawPublicPath === undefined) {
                delete global.__INJECTED_PUBLIC_PATH_BY_QIANKUN__;
            } else {
                global.__INJECTED_PUBLIC_PATH_BY_QIANKUN__ = rawPublicPath;
            }
            hasMountedOnce = true;
        },
    };
}
```

**ä½œç”¨ï¼š** æ³¨å…¥ `publicPath`ï¼Œè®©å­åº”ç”¨èƒ½æ­£ç¡®åŠ è½½èµ„æºã€‚

**å­åº”ç”¨ä½¿ç”¨ï¼š**

```javascript
// webpack é…ç½®
module.exports = {
    output: {
        publicPath: window.__INJECTED_PUBLIC_PATH_BY_QIANKUN__ || '/'
    }
};

// æˆ–åœ¨è¿è¡Œæ—¶è®¾ç½®
if (window.__POWERED_BY_QIANKUN__) {
    __webpack_public_path__ = window.__INJECTED_PUBLIC_PATH_BY_QIANKUN__;
}
```

## ğŸ”— é’©å­åˆå¹¶æœºåˆ¶

```typescript
// packages/qiankun/src/core/loadApp.ts: 99-106
const {
    beforeUnmount = [],
    afterUnmount = [],
    afterMount = [],
    beforeMount = [],
    beforeLoad = [],
} = mergeWith(
    {},
    getAddOns(global, assetPublicPath),  // å†…ç½®é’©å­
    lifeCycles,                           // ç”¨æˆ·è‡ªå®šä¹‰é’©å­
    (v1, v2) => concat((v1 ?? []) as LifeCycleFn<T>, (v2 ?? []) as LifeCycleFn<T>)
);
```

**åˆå¹¶è§„åˆ™ï¼š**
1. å†…ç½®é’©å­ä¼˜å…ˆ
2. ç”¨æˆ·é’©å­è¿½åŠ 
3. æŒ‰é¡ºåºæ‰§è¡Œ

**æ‰§è¡Œé¡ºåºç¤ºä¾‹ï¼š**

```javascript
// å†…ç½®é’©å­
const addons = {
    beforeLoad: [engineFlag.beforeLoad, runtimePublicPath.beforeLoad]
};

// ç”¨æˆ·é’©å­
const userLifeCycles = {
    beforeLoad: [userHook1, userHook2]
};

// åˆå¹¶å
beforeLoad = [
    engineFlag.beforeLoad,           // 1
    runtimePublicPath.beforeLoad,    // 2
    userHook1,                        // 3
    userHook2                         // 4
];

// æ‰§è¡Œæ—¶æŒ‰é¡ºåºè°ƒç”¨
for (const hook of beforeLoad) {
    await hook(app, global);
}
```

## ğŸ¯ å®é™…åº”ç”¨åœºæ™¯

### åœºæ™¯1: å…¨å±€ Loading

```javascript
let loadingInstance = null;

registerMicroApps(apps, {
    beforeLoad: async (app) => {
        loadingInstance = showLoading(`åŠ è½½ ${app.name}...`);
    },
    afterMount: async (app) => {
        loadingInstance?.hide();
    },
    beforeUnmount: async (app) => {
        loadingInstance = showLoading(`å¸è½½ ${app.name}...`);
    },
    afterUnmount: async (app) => {
        loadingInstance?.hide();
    }
});
```

### åœºæ™¯2: æ€§èƒ½ç›‘æ§

```javascript
const performanceMonitor = {};

registerMicroApps(apps, {
    beforeLoad: async (app) => {
        performanceMonitor[app.name] = {
            loadStart: Date.now()
        };
    },
    afterMount: async (app) => {
        const monitor = performanceMonitor[app.name];
        monitor.loadEnd = Date.now();
        monitor.loadTime = monitor.loadEnd - monitor.loadStart;
        
        // ä¸ŠæŠ¥æ€§èƒ½æ•°æ®
        reportPerformance({
            appName: app.name,
            loadTime: monitor.loadTime,
            timestamp: Date.now()
        });
        
        console.log(`${app.name} åŠ è½½è€—æ—¶: ${monitor.loadTime}ms`);
    }
});
```

### åœºæ™¯3: çŠ¶æ€åŒæ­¥

```javascript
registerMicroApps(apps, {
    beforeMount: async (app, global) => {
        // ä»ä¸»åº”ç”¨åŒæ­¥çŠ¶æ€åˆ°å­åº”ç”¨
        global.sharedState = {
            user: store.getState().user,
            theme: store.getState().theme
        };
    },
    beforeUnmount: async (app, global) => {
        // ä»å­åº”ç”¨åŒæ­¥çŠ¶æ€å›ä¸»åº”ç”¨
        if (global.appState) {
            store.dispatch({
                type: 'SAVE_APP_STATE',
                payload: {
                    appName: app.name,
                    state: global.appState
                }
            });
        }
    }
});
```

### åœºæ™¯4: æƒé™æ§åˆ¶

```javascript
registerMicroApps(apps, {
    beforeLoad: async (app) => {
        // æ£€æŸ¥æƒé™
        const hasPermission = await checkPermission(app.name);
        
        if (!hasPermission) {
            // è·³è½¬åˆ°æ— æƒé™é¡µé¢
            window.location.href = '/403';
            throw new Error('æ— æƒé™è®¿é—®');
        }
    }
});
```

### åœºæ™¯5: æ•°æ®é¢„åŠ è½½

```javascript
registerMicroApps(apps, {
    beforeLoad: async (app, global) => {
        // é¢„åŠ è½½å­åº”ç”¨éœ€è¦çš„æ•°æ®
        if (app.name === 'dashboard') {
            const dashboardData = await fetchDashboardData();
            global.__PRELOADED_DATA__ = dashboardData;
        }
    }
});
```

## ğŸ“ é¢è¯•è¦ç‚¹

### ç”Ÿå‘½å‘¨æœŸåˆ†ç±»

1. **ä¸»åº”ç”¨é’©å­**ï¼ˆ5ä¸ªï¼‰ï¼š
   - beforeLoadã€beforeMountã€afterMountã€beforeUnmountã€afterUnmount
   - åœ¨ä¸»åº”ç”¨ä¸­æ³¨å†Œ
   - å¯ä»¥æ˜¯å•ä¸ªå‡½æ•°æˆ–æ•°ç»„

2. **å­åº”ç”¨ç”Ÿå‘½å‘¨æœŸ**ï¼ˆ3ä¸ªå¿…éœ€ + 1ä¸ªå¯é€‰ï¼‰ï¼š
   - bootstrapï¼ˆå¿…éœ€ï¼Œä»…é¦–æ¬¡ï¼‰
   - mountï¼ˆå¿…éœ€ï¼Œæ¯æ¬¡æŒ‚è½½ï¼‰
   - unmountï¼ˆå¿…éœ€ï¼Œæ¯æ¬¡å¸è½½ï¼‰
   - updateï¼ˆå¯é€‰ï¼Œæ›´æ–°propsæ—¶ï¼‰

### æ‰§è¡Œé¡ºåº

```
é¦–æ¬¡åŠ è½½ï¼š
beforeLoad â†’ åŠ è½½èµ„æº â†’ æ‰§è¡Œè„šæœ¬ â†’ bootstrap â†’ 
beforeMount â†’ mount â†’ afterMount

å¸è½½ï¼š
beforeUnmount â†’ unmount â†’ afterUnmount

å†æ¬¡æŒ‚è½½ï¼š
beforeMount â†’ mount â†’ afterMount
```

### å…¸å‹ç”¨é€”

1. **beforeLoad**: æƒé™æ£€æŸ¥ã€æ€§èƒ½ç›‘æ§å¼€å§‹ã€æ˜¾ç¤º loading
2. **beforeMount**: æ³¨å…¥æ•°æ®ã€å‡†å¤‡å®¹å™¨ã€åˆå§‹åŒ–æœåŠ¡
3. **afterMount**: æ€§èƒ½ä¸ŠæŠ¥ã€è®¾ç½®æ ‡é¢˜ã€é€šçŸ¥å…¶ä»–ç³»ç»Ÿ
4. **beforeUnmount**: ä¿å­˜çŠ¶æ€ã€æš‚åœä»»åŠ¡ã€æ˜¾ç¤ºæç¤º
5. **afterUnmount**: æ¸…ç†èµ„æºã€ä¸ŠæŠ¥äº‹ä»¶ã€æ¢å¤ç¯å¢ƒ

### å†…ç½®é’©å­

1. **engineFlag**: è®¾ç½® `__POWERED_BY_QIANKUN__` æ ‡è®°
2. **runtimePublicPath**: æ³¨å…¥ `__INJECTED_PUBLIC_PATH_BY_QIANKUN__`
3. **è‡ªåŠ¨åˆå¹¶**: å†…ç½®é’©å­ + ç”¨æˆ·é’©å­

## ğŸ’¡ ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ

### 1. ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¹ˆå¤šé’©å­ï¼Ÿ

```javascript
// ä¸åŒé˜¶æ®µæœ‰ä¸åŒçš„éœ€æ±‚

// beforeLoad: èµ„æºè¿˜æ²¡ä¸‹è½½
// - é€‚åˆåšæƒé™æ£€æŸ¥ï¼ˆå¯ä»¥é˜»æ­¢åŠ è½½ï¼‰
// - æ€§èƒ½ç›‘æ§çš„èµ·ç‚¹

// beforeMount: èµ„æºå·²ä¸‹è½½ï¼Œä½†æœªæŒ‚è½½
// - é€‚åˆæ³¨å…¥è¿è¡Œæ—¶æ•°æ®
// - å‡†å¤‡å®¹å™¨

// afterMount: å·²å®Œå…¨æŒ‚è½½
// - é€‚åˆä¸ŠæŠ¥æˆåŠŸäº‹ä»¶
// - åç»­å¤„ç†

// ç»†ç²’åº¦çš„æ§åˆ¶ = æ›´å¤§çš„çµæ´»æ€§
```

### 2. ä¸ºä»€ä¹ˆé’©å­å¯ä»¥æ˜¯æ•°ç»„ï¼Ÿ

```javascript
// å•ä¸ªå‡½æ•°ï¼šç®€å•åœºæ™¯
beforeLoad: async (app) => {
    console.log('loading', app.name);
}

// æ•°ç»„ï¼šç»„åˆå¤šä¸ªåŠŸèƒ½
beforeLoad: [
    performanceMonitor.beforeLoad,  // æ€§èƒ½ç›‘æ§
    permissionCheck.beforeLoad,     // æƒé™æ£€æŸ¥
    loadingIndicator.beforeLoad     // åŠ è½½æç¤º
]

// æ¨¡å—åŒ–ã€å¯å¤ç”¨ã€æ˜“ç»´æŠ¤
```

### 3. ä¸ºä»€ä¹ˆæœ‰å†…ç½®é’©å­ï¼Ÿ

```javascript
// å†…ç½®é’©å­æä¾›åŸºç¡€åŠŸèƒ½
// 1. __POWERED_BY_QIANKUN__: è®©å­åº”ç”¨çŸ¥é“è¿è¡Œç¯å¢ƒ
// 2. __INJECTED_PUBLIC_PATH_BY_QIANKUN__: è§£å†³èµ„æºè·¯å¾„é—®é¢˜

// è¿™äº›æ˜¯å¾®å‰ç«¯çš„åŸºç¡€éœ€æ±‚
// å†…ç½®å®ç°ï¼Œå¼€å‘è€…æ— éœ€å…³å¿ƒ
// ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘
```

qiankun çš„ç”Ÿå‘½å‘¨æœŸè®¾è®¡ç²¾å·§ï¼Œæä¾›äº†è¶³å¤Ÿçš„æ§åˆ¶ç‚¹ï¼Œè®©å¼€å‘è€…èƒ½åœ¨åº”ç”¨åŠ è½½çš„å„ä¸ªé˜¶æ®µæ’å…¥è‡ªå·±çš„é€»è¾‘ï¼Œå®ç°å„ç§å¤æ‚çš„éœ€æ±‚ï¼

