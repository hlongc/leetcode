# é—®é¢˜7ï¼šimport-html-entry çš„ç¼“å­˜æœºåˆ¶æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿå¦‚ä½•é¿å…é‡å¤åŠ è½½ç›¸åŒçš„èµ„æºï¼Ÿ

## ğŸ“Œ ä¸‰å±‚ç¼“å­˜ç»“æ„

import-html-entry ä½¿ç”¨äº†**ä¸‰å±‚ç¼“å­˜**æ¥ä¼˜åŒ–èµ„æºåŠ è½½ï¼š

```javascript
// src/index.js: 19-21
const styleCache = {};      // æ ·å¼ç¼“å­˜
const scriptCache = {};     // è„šæœ¬ç¼“å­˜  
const embedHTMLCache = {};  // HTML ç¼“å­˜
```

## ğŸ¯ 1. embedHTMLCacheï¼ˆHTML ç¼“å­˜ï¼‰

### ä½œç”¨èŒƒå›´
ç¼“å­˜æ•´ä¸ª HTML å…¥å£çš„è§£æç»“æœï¼ŒåŒ…æ‹¬ templateã€scriptsã€styles ç­‰å®Œæ•´ä¿¡æ¯ã€‚

### å®ç°åŸç†

```javascript
// src/index.js: 335-358
export default function importHTML(url, opts = {}) {
    // ... å‚æ•°å¤„ç†
    
    // â­ æ ¸å¿ƒï¼šä½¿ç”¨ URL ä½œä¸º key ç¼“å­˜ Promise
    return embedHTMLCache[url] || (embedHTMLCache[url] = fetch(url)
        .then(response => readResAsString(response, autoDecodeResponse))
        .then(html => {
            const assetPublicPath = getPublicPath(url);
            const { template, scripts, entry, styles } = processTpl(
                getTemplate(html), 
                assetPublicPath, 
                postProcessTemplate
            );

            return getEmbedHTML(template, styles, { fetch }).then(embedHTML => ({
                template: embedHTML,
                assetPublicPath,
                getExternalScripts: () => getExternalScripts(scripts, fetch),
                getExternalStyleSheets: () => getExternalStyleSheets(styles, fetch),
                execScripts: (proxy, strictGlobal, opts = {}) => {
                    // ...
                },
            }));
        }));
}
```

### å…³é”®è®¾è®¡

#### 1. Promise ç¼“å­˜è€Œéç»“æœç¼“å­˜

```javascript
// âŒ é”™è¯¯åšæ³•ï¼šç¼“å­˜ç»“æœ
if (embedHTMLCache[url]) {
    return Promise.resolve(embedHTMLCache[url]);
}
const result = await fetch(url).then(...);
embedHTMLCache[url] = result;
return result;

// âœ… æ­£ç¡®åšæ³•ï¼šç¼“å­˜ Promise
return embedHTMLCache[url] || (embedHTMLCache[url] = fetch(url).then(...));
```

**ä¸ºä»€ä¹ˆç¼“å­˜ Promiseï¼Ÿ**

```javascript
// åœºæ™¯ï¼šå‡ ä¹åŒæ—¶åŠ è½½åŒä¸€ä¸ªåº”ç”¨
const promise1 = importHTML('http://app.com/index.html');  // ç¬¬ä¸€æ¬¡è°ƒç”¨
const promise2 = importHTML('http://app.com/index.html');  // ç¬¬äºŒæ¬¡è°ƒç”¨ï¼ˆåœ¨ç¬¬ä¸€æ¬¡å®Œæˆå‰ï¼‰

// ç¼“å­˜ç»“æœçš„é—®é¢˜ï¼š
// promise1 å‘èµ·è¯·æ±‚
// promise2 å‘ç°ç¼“å­˜ä¸ºç©ºï¼Œå†æ¬¡å‘èµ·è¯·æ±‚ âŒ
// ä¸¤ä¸ªè¯·æ±‚åŒæ—¶è¿›è¡Œï¼Œæµªè´¹èµ„æº

// ç¼“å­˜ Promise çš„ä¼˜åŠ¿ï¼š
// promise1 åˆ›å»º Promise å¹¶ç¼“å­˜
// promise2 å¤ç”¨ promise1 çš„ Promise âœ“
// åªæœ‰ä¸€ä¸ªç½‘ç»œè¯·æ±‚
console.log(promise1 === promise2);  // true
```

#### 2. çŸ­è·¯æ±‚å€¼ç¼“å­˜æ¨¡å¼

```javascript
embedHTMLCache[url] || (embedHTMLCache[url] = fetch(...))
```

**å·¥ä½œåŸç†ï¼š**
```javascript
// ç¬¬ä¸€æ¬¡è°ƒç”¨
embedHTMLCache['app.html']  // undefined (falsy)
// æ‰§è¡Œå³ä¾§ï¼šembedHTMLCache['app.html'] = fetch(...).then(...)
// è¿”å› Promise

// ç¬¬äºŒæ¬¡è°ƒç”¨  
embedHTMLCache['app.html']  // Promise (truthy)
// ç›´æ¥è¿”å›ï¼Œä¸æ‰§è¡Œå³ä¾§
```

### å®é™…æ•ˆæœç¤ºä¾‹

```javascript
// åœºæ™¯1: å¤šä¸ªå¾®åº”ç”¨å…±äº«åŒä¸€ä¸ªå…¥å£
const app1 = await importHTML('http://localhost:8080/index.html');
const app2 = await importHTML('http://localhost:8080/index.html');  // å¤ç”¨ç¼“å­˜
const app3 = await importHTML('http://localhost:8080/index.html');  // å¤ç”¨ç¼“å­˜

// åªå‘èµ· 1 æ¬¡ç½‘ç»œè¯·æ±‚
// app1ã€app2ã€app3 å¾—åˆ°ç›¸åŒçš„ç»“æœ

// åœºæ™¯2: åº”ç”¨å¸è½½åé‡æ–°åŠ è½½
await loadMicroApp({ entry: 'http://localhost:8080/index.html' });
// ... å¸è½½
await loadMicroApp({ entry: 'http://localhost:8080/index.html' });  // ç›´æ¥ä»ç¼“å­˜è¯»å–

// ä¸éœ€è¦é‡æ–°ä¸‹è½½å’Œè§£æ HTML
```

### ç¼“å­˜çš„ç”Ÿå‘½å‘¨æœŸ

**æ°¸ä¹…ç¼“å­˜ï¼Œä¸ä¼šè‡ªåŠ¨æ¸…é™¤ã€‚**

```javascript
// embedHTMLCache æ˜¯å…¨å±€å˜é‡ï¼Œé¡µé¢ä¸åˆ·æ–°å°±ä¸€ç›´å­˜åœ¨
// ä¼˜ç‚¹ï¼šæ€§èƒ½æœ€ä¼˜
// ç¼ºç‚¹ï¼šæ— æ³•æ›´æ–°ï¼ˆéœ€æ‰‹åŠ¨å¤„ç†ï¼‰

// è§£å†³æ–¹æ¡ˆï¼šç‰ˆæœ¬åŒ– URL
const entry = `http://localhost:8080/index.html?v=${Date.now()}`;
await importHTML(entry);  // æ¯æ¬¡éƒ½æ˜¯æ–°çš„ URLï¼Œä¸ä¼šå‘½ä¸­ç¼“å­˜
```

## ğŸ¨ 2. scriptCacheï¼ˆè„šæœ¬ç¼“å­˜ï¼‰

### ä½œç”¨èŒƒå›´
ç¼“å­˜å¤–é“¾è„šæœ¬çš„å†…å®¹ï¼ˆä»£ç å­—ç¬¦ä¸²ï¼‰ã€‚

### å®ç°åŸç†

```javascript
// src/index.js: 126-144
export function getExternalScripts(scripts, fetch = defaultFetch, entry) {
    const fetchScript = (scriptUrl, opts) => scriptCache[scriptUrl] ||
        (scriptCache[scriptUrl] = fetch(scriptUrl, opts).then(response => {
            if (response.status >= 400) {
                throw new Error(`${scriptUrl} load failed with status ${response.status}`);
            }
            return response.text();
        }).catch(e => {
            try {
                if (e.message.indexOf(scriptUrl) === -1) {
                    e.message = `${scriptUrl} ${e.message}`;
                }
            } catch (_) {
                // e.message å¯èƒ½æ˜¯ readonly
            }
            throw e;
        }));

    // ... ä½¿ç”¨ fetchScript ä¸‹è½½è„šæœ¬
}
```

### ç¼“å­˜ç²’åº¦

```javascript
// ç¼“å­˜ key: è„šæœ¬çš„å®Œæ•´ URL
scriptCache['http://localhost:8080/vendor.js'] = Promise<string>
scriptCache['http://localhost:8080/main.js'] = Promise<string>
scriptCache['https://cdn.com/react.min.js'] = Promise<string>
```

### ä½¿ç”¨åœºæ™¯

```javascript
// åœºæ™¯1: åŒä¸€ä¸ªå¾®åº”ç”¨å¤šæ¬¡åŠ è½½
const scripts = ['vendor.js', 'main.js'];

// ç¬¬ä¸€æ¬¡åŠ è½½
await getExternalScripts(scripts, fetch);
// vendor.js: å‘èµ·è¯·æ±‚ï¼Œç¼“å­˜ç»“æœ
// main.js: å‘èµ·è¯·æ±‚ï¼Œç¼“å­˜ç»“æœ

// ç¬¬äºŒæ¬¡åŠ è½½ï¼ˆåº”ç”¨é‡æ–°æŒ‚è½½ï¼‰
await getExternalScripts(scripts, fetch);
// vendor.js: ä»ç¼“å­˜è¯»å– âœ“
// main.js: ä»ç¼“å­˜è¯»å– âœ“

// åœºæ™¯2: å¤šä¸ªå¾®åº”ç”¨å…±äº«ä¾èµ–
// åº”ç”¨A
scripts: ['https://cdn.com/react.min.js', 'appA.js']

// åº”ç”¨B
scripts: ['https://cdn.com/react.min.js', 'appB.js']

// react.min.js åªä¸‹è½½ä¸€æ¬¡ï¼Œä¸¤ä¸ªåº”ç”¨å…±äº«ç¼“å­˜
```

### å†…è”è„šæœ¬ä¸ç¼“å­˜

```javascript
// src/index.js: 148-157
return allSettledButCanBreak(scripts.map(async script => {
    if (typeof script === 'string') {
        if (isInlineCode(script)) {
            // å†…è”è„šæœ¬ï¼šç›´æ¥æå–ï¼Œä¸ç¼“å­˜
            return getInlineCode(script);
        } else {
            // å¤–é“¾è„šæœ¬ï¼šä¸‹è½½å¹¶ç¼“å­˜
            return fetchScript(script);
        }
    }
    // ...
}));
```

**ä¸ºä»€ä¹ˆå†…è”è„šæœ¬ä¸ç¼“å­˜ï¼Ÿ**

```javascript
// å†…è”è„šæœ¬å·²ç»åœ¨ HTML ä¸­
const inlineScript = '<script>console.log("hello")</script>';

// æå–å†…å®¹
const code = getInlineCode(inlineScript);  // 'console.log("hello")'

// ç¼“å­˜æ˜¯å¤šä½™çš„ï¼š
// 1. å†…å®¹å·²åœ¨å†…å­˜ä¸­ï¼ˆä» HTML æå–ï¼‰
// 2. æå–æ“ä½œå¾ˆå¿«ï¼ˆå­—ç¬¦ä¸²æˆªå–ï¼‰
// 3. ä¸æ¶‰åŠç½‘ç»œè¯·æ±‚
```

## ğŸ’… 3. styleCacheï¼ˆæ ·å¼ç¼“å­˜ï¼‰

### ä½œç”¨èŒƒå›´
ç¼“å­˜å¤–é“¾æ ·å¼çš„å†…å®¹ï¼ˆCSS å­—ç¬¦ä¸²ï¼‰ã€‚

### å®ç°åŸç†

```javascript
// src/index.js: 80-103
export function getExternalStyleSheets(styles, fetch = defaultFetch) {
    return allSettledButCanBreak(styles.map(async styleLink => {
        if (isInlineCode(styleLink)) {
            // å†…è”æ ·å¼ï¼šä¸ç¼“å­˜
            return getInlineCode(styleLink);
        } else {
            // å¤–é“¾æ ·å¼ï¼šç¼“å­˜
            return styleCache[styleLink] ||
                (styleCache[styleLink] = fetch(styleLink).then(response => {
                    if (response.status >= 400) {
                        throw new Error(`${styleLink} load failed with status ${response.status}`);
                    }
                    return response.text();
                }).catch(e => {
                    try {
                        if (e.message.indexOf(styleLink) === -1) {
                            e.message = `${styleLink} ${e.message}`;
                        }
                    } catch (_) {
                        // e.message å¯èƒ½æ˜¯ readonly
                    }
                    throw e;
                }));
        }
    }))
    // ...
}
```

### ç¼“å­˜æ•ˆæœ

```javascript
// åœºæ™¯ï¼šå¤šä¸ªå¾®åº”ç”¨ä½¿ç”¨ç›¸åŒçš„ UI åº“æ ·å¼
// åº”ç”¨A
styles: ['https://cdn.com/antd.min.css', 'appA.css']

// åº”ç”¨B  
styles: ['https://cdn.com/antd.min.css', 'appB.css']

// åº”ç”¨C
styles: ['https://cdn.com/antd.min.css', 'appC.css']

// antd.min.css åªä¸‹è½½ä¸€æ¬¡ï¼Œä¸‰ä¸ªåº”ç”¨å…±äº«
// èŠ‚çœ: 2 æ¬¡ç½‘ç»œè¯·æ±‚ + å¸¦å®½
```

## ğŸ“Š ä¸‰å±‚ç¼“å­˜çš„åä½œå…³ç³»

```javascript
// å®Œæ•´æµç¨‹ç¤ºä¾‹
const entry = 'http://localhost:8080/index.html';

// ===== ç¬¬ä¸€æ¬¡åŠ è½½ =====
const result1 = await importHTML(entry);
/*
æ­¥éª¤ï¼š
1. embedHTMLCache[entry] ä¸ºç©ºï¼Œå‘èµ·è¯·æ±‚
2. ä¸‹è½½ HTML: <link href="main.css"><script src="main.js">
3. è°ƒç”¨ getExternalStyleSheets(['main.css'])
   - styleCache['main.css'] ä¸ºç©ºï¼Œä¸‹è½½æ ·å¼
4. è°ƒç”¨ getExternalScripts(['main.js'])  
   - scriptCache['main.js'] ä¸ºç©ºï¼Œä¸‹è½½è„šæœ¬
5. ç¼“å­˜å®Œæ•´ç»“æœåˆ° embedHTMLCache[entry]

ç¼“å­˜çŠ¶æ€ï¼š
embedHTMLCache = {
  'http://localhost:8080/index.html': Promise<ç»“æœå¯¹è±¡>
}
styleCache = {
  'http://localhost:8080/main.css': Promise<CSSå†…å®¹>
}
scriptCache = {
  'http://localhost:8080/main.js': Promise<JSå†…å®¹>
}
*/

// ===== ç¬¬äºŒæ¬¡åŠ è½½ï¼ˆå®Œå…¨ç›¸åŒçš„å…¥å£ï¼‰=====
const result2 = await importHTML(entry);
/*
æ­¥éª¤ï¼š
1. embedHTMLCache[entry] å‘½ä¸­ï¼Œç›´æ¥è¿”å› âœ“
2. ä¸éœ€è¦è§£æ HTML
3. ä¸éœ€è¦ä¸‹è½½æ ·å¼å’Œè„šæœ¬

ç½‘ç»œè¯·æ±‚ï¼š0 æ¬¡
è§£ææ“ä½œï¼š0 æ¬¡
*/

// ===== ç¬¬ä¸‰æ¬¡åŠ è½½ï¼ˆä¸åŒå…¥å£ï¼Œä½†å…±äº«èµ„æºï¼‰=====
const entry2 = 'http://localhost:8080/app2.html';
const result3 = await importHTML(entry2);
/*
å‡è®¾ app2.html ä¹Ÿå¼•ç”¨äº† main.css å’Œ main.js

æ­¥éª¤ï¼š
1. embedHTMLCache[entry2] ä¸ºç©ºï¼Œä¸‹è½½ HTML
2. è§£æå¾—åˆ° scripts=['main.js'] styles=['main.css']
3. getExternalStyleSheets(['main.css'])
   - styleCache['main.css'] å‘½ä¸­ âœ“
4. getExternalScripts(['main.js'])
   - scriptCache['main.js'] å‘½ä¸­ âœ“

ç½‘ç»œè¯·æ±‚ï¼š1 æ¬¡ï¼ˆåªä¸‹è½½ app2.htmlï¼‰
å¤ç”¨ç¼“å­˜ï¼šmain.cssã€main.js
*/
```

## ğŸ”„ ç¼“å­˜å¤ç”¨çš„åœºæ™¯

### åœºæ™¯1: åº”ç”¨é‡æ–°æŒ‚è½½

```javascript
// qiankun åº”ç”¨åˆ‡æ¢
// ç”¨æˆ·ä» /app1 åˆ‡æ¢åˆ° /app2ï¼Œå†åˆ‡æ¢å› /app1

// ç¬¬ä¸€æ¬¡åŠ è½½ app1
await loadMicroApp({ entry: 'http://localhost:8080/app1.html' });
// ç¼“å­˜å»ºç«‹

// å¸è½½ app1ï¼ŒåŠ è½½ app2
// ...

// å†æ¬¡åŠ è½½ app1
await loadMicroApp({ entry: 'http://localhost:8080/app1.html' });
// ç›´æ¥ä½¿ç”¨ç¼“å­˜ï¼Œç§’å¼€ ğŸš€
```

### åœºæ™¯2: é¢„åŠ è½½ä¼˜åŒ–

```javascript
// qiankun çš„é¢„åŠ è½½åŠŸèƒ½
function prefetchApps(apps) {
    apps.forEach(async app => {
        // ç©ºé—²æ—¶é¢„åŠ è½½
        requestIdleCallback(async () => {
            const { getExternalScripts, getExternalStyleSheets } = await importHTML(app.entry);
            // è§¦å‘ä¸‹è½½ï¼Œå¡«å……ç¼“å­˜
            await getExternalScripts();
            await getExternalStyleSheets();
        });
    });
}

// é¢„åŠ è½½
prefetchApps([
    { entry: 'http://localhost:8080/app1.html' },
    { entry: 'http://localhost:8080/app2.html' }
]);

// ç”¨æˆ·è®¿é—®æ—¶ï¼Œç›´æ¥ä»ç¼“å­˜è¯»å–
// ä½“éªŒï¼šå³æ—¶åŠ è½½ âš¡
```

### åœºæ™¯3: å¤šå®ä¾‹åº”ç”¨

```javascript
// åŒæ—¶å±•ç¤ºå¤šä¸ªç›¸åŒåº”ç”¨çš„å®ä¾‹
loadMicroApp({ 
    name: 'app1-instance1',
    entry: 'http://localhost:8080/app.html',
    container: '#container1'
});

loadMicroApp({ 
    name: 'app1-instance2',
    entry: 'http://localhost:8080/app.html',
    container: '#container2'
});

// ä¸¤ä¸ªå®ä¾‹å…±äº«ç¼“å­˜
// åªä¸‹è½½ä¸€æ¬¡ HTML/CSS/JS
```

### åœºæ™¯4: å…±äº«ä¾èµ–

```javascript
// å¤šä¸ªå¾®åº”ç”¨ä½¿ç”¨ç›¸åŒçš„åŸºç¡€åº“
// app1.html
<script src="https://cdn.com/react.min.js"></script>
<script src="https://cdn.com/react-dom.min.js"></script>
<script src="app1.js"></script>

// app2.html
<script src="https://cdn.com/react.min.js"></script>
<script src="https://cdn.com/react-dom.min.js"></script>
<script src="app2.js"></script>

// React åº“åªä¸‹è½½ä¸€æ¬¡
// èŠ‚çœ: ~200KB * (åº”ç”¨æ•° - 1)
```

## ğŸš¨ ç¼“å­˜çš„æ³¨æ„äº‹é¡¹

### 1. ç¼“å­˜æ°¸ä¸è¿‡æœŸ

```javascript
// é—®é¢˜ï¼šHTML å†…å®¹æ›´æ–°äº†ï¼Œä½†ç¼“å­˜è¿˜æ˜¯æ—§çš„
// éƒ¨ç½²æ–°ç‰ˆæœ¬ï¼šapp.html å†…å®¹å˜åŒ–
// ç”¨æˆ·åˆ·æ–°å‰ï¼Œä»ç„¶ä½¿ç”¨æ—§ç¼“å­˜

// è§£å†³æ–¹æ¡ˆ1: ç‰ˆæœ¬åŒ– URL
const entry = `http://localhost:8080/app.html?v=${buildVersion}`;

// è§£å†³æ–¹æ¡ˆ2: æ‰‹åŠ¨æ¸…é™¤ç¼“å­˜
delete embedHTMLCache['http://localhost:8080/app.html'];
delete scriptCache['http://localhost:8080/main.js'];
delete styleCache['http://localhost:8080/main.css'];

// è§£å†³æ–¹æ¡ˆ3: ä½¿ç”¨ CDN çš„ç¼“å­˜ç­–ç•¥
// index.html: Cache-Control: no-cache
// main.js: Cache-Control: max-age=31536000 (æ–‡ä»¶åå¸¦ hash)
```

### 2. è·¨åº”ç”¨ç¼“å­˜æ±¡æŸ“

```javascript
// é—®é¢˜ï¼šä¸åŒåº”ç”¨ä½¿ç”¨ç›¸åŒçš„æ–‡ä»¶å
// app1: http://localhost:8080/app1/main.js
// app2: http://localhost:8080/app2/main.js

// è¿™æ˜¯ä¸¤ä¸ªä¸åŒçš„æ–‡ä»¶ï¼Œä¸ä¼šå†²çª âœ“
// å› ä¸ºç¼“å­˜ key æ˜¯å®Œæ•´ URL

// ä½†å¦‚æœæ˜¯ï¼š
// app1: http://localhost:8080/main.js  (ç‰ˆæœ¬1)
// app2: http://localhost:8080/main.js  (ç‰ˆæœ¬2ï¼Œä½†æ–‡ä»¶è¢«è¦†ç›–)

// ç¬¬ä¸€æ¬¡åŠ è½½ app1ï¼Œç¼“å­˜äº†ç‰ˆæœ¬1
// éƒ¨ç½² app2ï¼Œè¦†ç›–äº† main.js ä¸ºç‰ˆæœ¬2
// åŠ è½½ app2ï¼Œä»ç„¶ä½¿ç”¨ç‰ˆæœ¬1 çš„ç¼“å­˜ âŒ

// è§£å†³æ–¹æ¡ˆï¼šæ–‡ä»¶å hash
// app1: main.abc123.js
// app2: main.def456.js
```

### 3. å†…å­˜å ç”¨

```javascript
// ç¼“å­˜ä¼šä¸€ç›´å ç”¨å†…å­˜
// å¦‚æœåŠ è½½äº†å¤§é‡å¾®åº”ç”¨ï¼Œå†…å­˜å ç”¨ä¼šå¢åŠ 

// ç›‘æ§ç¼“å­˜å¤§å°
function getCacheSize() {
    const htmlSize = Object.keys(embedHTMLCache).length;
    const scriptSize = Object.keys(scriptCache).length;
    const styleSize = Object.keys(styleCache).length;
    
    console.log('ç¼“å­˜æ¡ç›®æ•°ï¼š', {
        html: htmlSize,
        script: scriptSize,
        style: styleSize
    });
}

// å¿…è¦æ—¶æ¸…ç†ç¼“å­˜
function clearCache() {
    Object.keys(embedHTMLCache).forEach(key => delete embedHTMLCache[key]);
    Object.keys(scriptCache).forEach(key => delete scriptCache[key]);
    Object.keys(styleCache).forEach(key => delete styleCache[key]);
}
```

### 4. å¼€å‘ç¯å¢ƒçš„é—®é¢˜

```javascript
// å¼€å‘æ—¶é¢‘ç¹ä¿®æ”¹ä»£ç ï¼Œä½†ç¼“å­˜ä¸æ›´æ–°

// è§£å†³æ–¹æ¡ˆ1: ç¦ç”¨ç¼“å­˜ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
if (process.env.NODE_ENV === 'development') {
    const entry = `${baseUrl}?_t=${Date.now()}`;
}

// è§£å†³æ–¹æ¡ˆ2: è‡ªå®šä¹‰ fetchï¼ˆæ·»åŠ  no-cacheï¼‰
importHTML(entry, {
    fetch: (url, opts) => {
        return window.fetch(url, {
            ...opts,
            cache: 'no-cache'
        });
    }
});

// è§£å†³æ–¹æ¡ˆ3: å¼€å‘å·¥å…·æ¸…é™¤ç¼“å­˜
// Chrome DevTools -> Network -> Disable cache
```

## ğŸ“ é¢è¯•è¦ç‚¹

### ç¼“å­˜ç»“æ„

1. **ä¸‰å±‚ç¼“å­˜**ï¼šembedHTMLCacheï¼ˆHTMLï¼‰ã€scriptCacheï¼ˆè„šæœ¬ï¼‰ã€styleCacheï¼ˆæ ·å¼ï¼‰
2. **Promise ç¼“å­˜**ï¼šç¼“å­˜ Promise è€Œéç»“æœï¼Œé¿å…é‡å¤è¯·æ±‚
3. **URL ä¸º key**ï¼šä½¿ç”¨å®Œæ•´ URL ä½œä¸ºç¼“å­˜é”®
4. **æ°¸ä¹…ç¼“å­˜**ï¼šä¸è‡ªåŠ¨è¿‡æœŸï¼Œéœ€æ‰‹åŠ¨æ¸…ç†

### è®¾è®¡ä¼˜åŠ¿

1. **æ€§èƒ½ä¼˜åŒ–**ï¼šé¿å…é‡å¤ä¸‹è½½å’Œè§£æ
2. **å¹¶å‘æ§åˆ¶**ï¼šåŒæ—¶è¯·æ±‚å¤ç”¨åŒä¸€ä¸ª Promise
3. **ä¾èµ–å…±äº«**ï¼šå¤šåº”ç”¨å…±äº«ç›¸åŒèµ„æº
4. **é¢„åŠ è½½æ”¯æŒ**ï¼šæå‰å¡«å……ç¼“å­˜ï¼ŒåŠ é€Ÿåç»­è®¿é—®

### å®é™…é—®é¢˜

1. **ç‰ˆæœ¬æ›´æ–°**ï¼šéœ€è¦ç‰ˆæœ¬åŒ– URL æˆ–æ¸…é™¤ç¼“å­˜
2. **å¼€å‘ä½“éªŒ**ï¼šå¼€å‘æ—¶éœ€è¦ç¦ç”¨ç¼“å­˜
3. **å†…å­˜ç®¡ç†**ï¼šé•¿æœŸè¿è¡Œéœ€è¦æ¸…ç†ç­–ç•¥
4. **ç¼“å­˜ä¸€è‡´æ€§**ï¼šç¡®ä¿æ–‡ä»¶åå”¯ä¸€æ€§

## ğŸ’¡ ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ

### 1. ä¸ºä»€ä¹ˆç¼“å­˜ Promise è€Œä¸æ˜¯ç»“æœï¼Ÿ

```javascript
// æ—¶é—´çº¿ç¤ºä¾‹
// t=0ms: è¯·æ±‚1 å‘èµ·
// t=1ms: è¯·æ±‚2 å‘èµ·ï¼ˆåœ¨è¯·æ±‚1å®Œæˆå‰ï¼‰

// ç¼“å­˜ç»“æœï¼ˆé”™è¯¯ï¼‰
// t=0ms: cache ä¸ºç©ºï¼Œå‘èµ·è¯·æ±‚1
// t=1ms: cache ä»ä¸ºç©ºï¼Œå‘èµ·è¯·æ±‚2 âŒ
// ç»“æœï¼š2 ä¸ªç½‘ç»œè¯·æ±‚

// ç¼“å­˜ Promiseï¼ˆæ­£ç¡®ï¼‰
// t=0ms: cache ä¸ºç©ºï¼Œåˆ›å»º Promise å¹¶ç¼“å­˜
// t=1ms: cache æœ‰ Promiseï¼Œå¤ç”¨ âœ“
// ç»“æœï¼š1 ä¸ªç½‘ç»œè¯·æ±‚
```

### 2. ä¸ºä»€ä¹ˆå†…è”èµ„æºä¸ç¼“å­˜ï¼Ÿ

```javascript
// å†…è”èµ„æºå·²åœ¨ HTML ä¸­
const html = `
<style>.app { color: red; }</style>
<script>console.log('hello')</script>
`;

// æå–æ“ä½œå¾ˆå¿«ï¼ˆæ¯«ç§’çº§ï¼‰
const style = getInlineCode('<style>.app { color: red; }</style>');
// æ¯”ç¼“å­˜æŸ¥æ‰¾è¿˜å¿«

// ç¼“å­˜åè€Œå¢åŠ å¼€é”€ï¼š
// 1. ç”Ÿæˆç¼“å­˜ key
// 2. æŸ¥æ‰¾ç¼“å­˜
// 3. å­˜å‚¨ç¼“å­˜
// ä¸å¦‚ç›´æ¥æå–
```

### 3. ä¸ºä»€ä¹ˆä¸è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Ÿ

```javascript
// å¾®å‰ç«¯åœºæ™¯çš„ç‰¹ç‚¹ï¼š
// 1. åº”ç”¨é¢‘ç¹åˆ‡æ¢
// 2. èµ„æºé‡å¤ç‡é«˜
// 3. ç”¨æˆ·ä¼šè¯æ—¶é—´é•¿

// æ°¸ä¹…ç¼“å­˜çš„å¥½å¤„ï¼š
// - ç”¨æˆ·åœ¨åº”ç”¨é—´åˆ‡æ¢ï¼Œç§’å¼€
// - é¢„åŠ è½½çš„èµ„æºé•¿æœŸæœ‰æ•ˆ
// - ç®€åŒ–å®ç°ï¼ˆæ— éœ€å®šæ—¶å™¨ï¼‰

// ç¼ºç‚¹ï¼š
// - æ— æ³•è‡ªåŠ¨æ›´æ–°
// - è§£å†³æ–¹æ¡ˆï¼šç‰ˆæœ¬åŒ– URLï¼ˆwebpack hashï¼‰
```

è¿™ç§ç¼“å­˜è®¾è®¡åœ¨å¾®å‰ç«¯åœºæ™¯ä¸‹å®ç°äº†æ€§èƒ½å’Œç®€æ´æ€§çš„å®Œç¾å¹³è¡¡ï¼

